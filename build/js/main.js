"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function o(s,a,u){function c(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return c(s[t][1][e]||e)},i,i.exports,o,s,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,f,t){!function(){function s(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function o(n,r,i){var o,e=new Promise(function(e,t){s(o=n[r].apply(n,i)).then(e,t)});return e.request=o,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return o(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=o(e,n,arguments)).then(function(e){if(e)return new a(e,t.request)});var e,t})})}function i(e){this._index=e}function a(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function h(e){this._db=e}e(i,"_index",["name","keyPath","multiEntry","unique"]),t(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(a,"_cursor",["direction","key","primaryKey","value"]),t(a,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(a.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),s(t._request).then(function(e){if(e)return new a(e,t._request)})})})}),u.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(u,"_store",["name","keyPath","indexNames","autoIncrement"]),t(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),h.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(h,"_db",["name","version","objectStoreNames"]),n(h,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[u,i].forEach(function(e){o in e.prototype&&(e.prototype[o.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[o].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});var d={open:function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new l(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new h(e)})},delete:function(e){return o(indexedDB,"deleteDatabase",[e])}};void 0!==f?(f.exports=d,f.exports.default=f.exports):self.idb=d}()},{}],2:[function(e,t,n){function r(e){var r=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.select=document.querySelector(e),this.select.setAttribute("aria-label",i.label),this.select.setAttribute("tabindex","0"),this.select.setAttribute("role","listbox"),this.select){this.onChange=i.onChange||function(){};var t=document.createElement("span");t.className="custom-select__dropdown",this.selectedValueBlock=document.createElement("span"),this.selectedValueBlock.className="custom-select__selected-item-value",this.selectedValueBlock.setAttribute("data-value",i.initialValue.value),this.selectedValueBlock.innerText=i.initialValue.name||"",t.append(this.selectedValueBlock);var n=document.createElement("span");n.className="custom-select__dropdown-button",n.setAttribute("role","button"),n.setAttribute("aria-label","open dropdown list"),t.append(n),this.select.append(t),this.itemsList=document.createElement("ul"),this.itemsList.className="custom-select__list";var o=i.values||[],s=document.createElement("li");s.setAttribute("tabindex","0"),s.setAttribute("role","option"),s.setAttribute("id",i.name+"_elem"),s.innerHTML=i.initialValue.name,s.setAttribute("data-value",i.initialValue.value),s.addEventListener("click",function(e){r.onListElementClick.bind(r)(e)}),this.itemsList.append(s),this.setSelectedElement(s),o.forEach(function(e,t){var n=document.createElement("li");n.setAttribute("tabindex","0"),n.setAttribute("role","option"),n.setAttribute("id",i.name+"_elem_"+t),n.innerHTML=e,n.setAttribute("data-value",e),n.addEventListener("click",r.onListElementClick.bind(r)),r.itemsList.append(n)}),this.select.append(this.itemsList),this.activeItemIdx=0,n.addEventListener("click",this.toggleDropDown.bind(this)),this.selectedValueBlock.addEventListener("click",this.toggleDropDown.bind(this)),this.select.addEventListener("keydown",this.handleKeyDown.bind(this))}}r.prototype={toggleDropDown:function(){this.itemsList.classList.contains("open")?this.itemsList.classList.remove("open"):this.itemsList.classList.add("open")},openDropDown:function(){this.itemsList.classList.add("open")},closeDropDown:function(){this.itemsList.classList.remove("open")},onListElementClick:function(e){var t=Array.prototype.indexOf.call(this.itemsList.children,e.target);-1!==!t&&(this.activeItemIdx=t,this.setSelectedElement(this.itemsList.children[this.activeItemIdx],!0),this.closeDropDown())},setSelectedElement:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e){var n=e.getAttribute("data-value");this.selectedValueBlock.setAttribute("data-value",n),this.select.setAttribute("data-value",n),this.selectedValueBlock.innerText=e.innerText;var r=!0,i=!1,o=void 0;try{for(var s,a=this.itemsList.children[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){s.value.setAttribute("aria-selected","")}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}e.setAttribute("aria-selected","true"),this.select.setAttribute("aria-activedescendant",e.id),t&&this.onChange()}},handleKeyDown:function(e){var t=13,n=27,r=32,i=37,o=38,s=39,a=40;if(-1!==[a,o,r,t,i,s,n].indexOf(e.keyCode))switch(e.preventDefault(),e.keyCode){case a:case s:this.nextActiveListItem();break;case o:case i:this.previousActiveListItem();break;case r:this.openDropDown(),this.itemsList.children[this.activeItemIdx].focus();break;case t:var u=this.itemsList.children[this.activeItemIdx];if(!u)break;this.setSelectedElement(u),this.closeDropDown(),this.select.focus();break;case n:this.closeDropDown(),this.select.focus()}},nextActiveListItem:function(){var e=this.activeItemIdx>=this.itemsList.children.length-1?0:this.activeItemIdx+1;this.itemsList.children[e].focus(),this.activeItemIdx=e},previousActiveListItem:function(){var e=0===this.activeItemIdx?this.itemsList.children.length-1:this.activeItemIdx-1;this.itemsList.children[e].focus(),this.activeItemIdx=e}},t.exports=r},{}],3:[function(e,t,n){var r=e("idb"),i="restaurants",o=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(){var t=this;return fetch(o.DATABASE_URL+"/restaurants").then(function(e){return e.json()}).then(function(e){return t.putRestaurantsIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return o.fetchRestaurantsFromIndexedDb().then(function(e){if(e.length)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurantWithReviews",value:function(t){var i=this;return Promise.all([this.fetchRestaurant(t),this.fetchRestaurantReviews(t)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return n.reviews=r,i.putRestaurantIntoIndexedDb(n).then(function(){return n})}).catch(function(e){return o.fetchRestaurantFromIndexedDb(t).then(function(e){if(e)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(e){return fetch(o.DATABASE_URL+"/restaurants/"+e).then(function(e){return e.json()})}},{key:"fetchRestaurantReviews",value:function(e){return fetch(o.DATABASE_URL+"/reviews/?restaurant_id="+e).then(function(e){return e.json()})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return o.openDatabase().then(function(e){return e.transaction(i).objectStore(i).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(t){return o.openDatabase().then(function(e){return e.transaction(i).objectStore(i).get(+t)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return o.clearRestaurantsInIndexedDb().then(function(){return o.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return n.forEach(function(e){return t.objectStore(i).put(e)}),t.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return o.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return t.objectStore(i).put(n),t.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return o.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return t.objectStore(i).clear(),t.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore(i,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(e){return o.fetchRestaurantWithReviews(e)}},{key:"fetchRestaurantByCuisine",value:function(t,e){o.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return o.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return o.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoodsAndCuisines",value:function(){return o.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood}),i=n.map(function(e,t){return n[t].cuisine_type});return{neighborhoods:r.filter(function(e,t){return r.indexOf(e)==t}),cuisines:i.filter(function(e,t){return i.indexOf(e)==t}),restaurants:n}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.id+"_small.jpg"}},{key:"imageSrcSetForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),o}();t.exports=o},{idb:1}],4:[function(e,t,n){var u=e("./dbhelper"),i=e("./accessibility-select"),r=e("./process"),o=!1;function s(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.getAttribute("data-value"),r=t.getAttribute("data-value");u.fetchRestaurantByCuisineAndNeighborhood(n,r).then(function(e){!function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.setMap(null)});self.markers=[],self.restaurants=e}(e),a(e)}).catch(function(e){console.error(e)})}function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(function(e){var t=document.createElement("li");t.setAttribute("tabindex",0);var n=document.createElement("img");n.className="restaurant-img",n.src=u.imageUrlForRestaurant(e),n.setAttribute("alt","An image from the restaurant "+e.name),t.append(n);var r=document.createElement("div");r.className="restaurant-info";var i=document.createElement("h2");i.className="restaurant-card-name",i.setAttribute("tabindex","0"),i.innerHTML=e.name,r.append(i);var o=document.createElement("p");o.setAttribute("tabindex",0),o.innerHTML=e.neighborhood,r.append(o);var s=document.createElement("p");s.setAttribute("tabindex",0),s.innerHTML=e.address,r.append(s);var a=document.createElement("a");return a.innerHTML="View Details",a.href=u.urlForRestaurant(e),r.append(a),t.append(r),t}(e))}),function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=u.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers||(self.markers=[]),self.markers.push(t)})}(e)}document.addEventListener("DOMContentLoaded",function(e){console.log("DOMContentLoaded"),r.registerServiceWorker(),u.fetchNeighborhoodsAndCuisines().then(function(e){var t=e.restaurants,n=e.neighborhoods,r=e.cuisines;return function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,new i("#neighborhoods-select",{name:"Neighborhood",label:"Neighborhood",initialValue:{name:"All Neighborhoods",value:"all"},values:self.neighborhoods,onChange:s})}(self.neighborhoods=n),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines;new i("#cuisines-select",{name:"Cuisines",label:"Cuisines",initialValue:{name:"All Cuisines",value:"all"},values:e,onChange:s})}(self.cuisines=r),t}).catch(function(e){console.error(e)}).then(function(e){a(e)})}),window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),window.addEventListener("scroll",function(){o||(o=!0)}),setTimeout(function(){document.getElementById("map").querySelector("iframe").setAttribute("title","Google map")},200)}},{"./accessibility-select":2,"./dbhelper":3,"./process":5}],5:[function(e,t,n){t.exports={registerServiceWorker:function(){}}},{}]},{},[4]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvYWNjZXNzaWJpbGl0eS1zZWxlY3QuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9wcm9jZXNzLmpzIl0sIm5hbWVzIjpbInJlc3VsdCIsImVycm9yIiwicmVxdWVzdCIsImFyZ3MiLCJyZWplY3QiLCJwIiwicHJvcCIsInZhbCIsImFyZ3VtZW50cyIsImluZGV4IiwiY3Vyc29yIiwic3RvcmUiLCJpZGJUcmFuc2FjdGlvbiIsInJlc29sdmUiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsInRoaXMiLCJfcmVxdWVzdCIsImFyciIsIl9pbmRleCIsInZhbHVlIiwiY29udGludWUiLCJpdGVtcyIsInZlcnNpb24iLCJuYW1lIiwiZXhwIiwiZXhwb3J0cyIsIkFjY2Vzc2liaWxpdHlTZWxlY3QiLCJzZWxlY3RvciIsIl90aGlzIiwib3B0aW9ucyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInNldEF0dHJpYnV0ZSIsImxhYmVsIiwib25DaGFuZ2UiLCJkcm9wZG93biIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJzZWxlY3RlZFZhbHVlQmxvY2siLCJpbml0aWFsVmFsdWUiLCJpbm5lclRleHQiLCJhcHBlbmQiLCJkcm9wZG93bkJ1dHRvbiIsIml0ZW1zTGlzdCIsIm5laWdoYm9yaG9vZHMiLCJ2YWx1ZXMiLCJvcHRpb24iLCJpbm5lckhUTUwiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsIm9uTGlzdEVsZW1lbnRDbGljayIsImJpbmQiLCJzZXRTZWxlY3RlZEVsZW1lbnQiLCJmb3JFYWNoIiwibmVpZ2hib3Job29kIiwiYWN0aXZlSXRlbUlkeCIsInRvZ2dsZURyb3BEb3duIiwiaGFuZGxlS2V5RG93biIsInByb3RvdHlwZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiYWRkIiwic2VsZWN0ZWRFbGVtZW50SW5kZXgiLCJBcnJheSIsImluZGV4T2YiLCJjYWxsIiwiY2hpbGRyZW4iLCJ0YXJnZXQiLCJjbG9zZURyb3BEb3duIiwiZWxlbWVudCIsInRyaWdnZXJFdmVudCIsImdldEF0dHJpYnV0ZSIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwibmV4dCIsImRvbmUiLCJpZCIsIlZLX0VOVEVSIiwiVktfRVNDIiwiVktfU1BBQ0UiLCJWS19MRUZUIiwiVktfVVAiLCJWS19SSUdIVCIsIlZLX0RPV04iLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJuZXh0QWN0aXZlTGlzdEl0ZW0iLCJwcmV2aW91c0FjdGl2ZUxpc3RJdGVtIiwib3BlbkRyb3BEb3duIiwiZm9jdXMiLCJhY3RpdmUiLCJuZXh0RWxlbWVudEluZGV4IiwicHJldkVsZW1lbnRJbmRleCIsIm1vZHVsZSIsImlkYiIsInJlcXVpcmUiLCJEQl9SRVNUQVVSQU5UU19UQUJMRSIsIkRCSGVscGVyIiwiX3RoaXMyIiwiREFUQUJBU0VfVVJMIiwidGhlbiIsImRhdGEiLCJqc29uIiwicmVzdGF1cmFudHMiLCJwdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIiLCJjYXRjaCIsImVyciIsImZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiIiwiRXJyb3IiLCJfdGhpczMiLCJhbGwiLCJmZXRjaFJlc3RhdXJhbnQiLCJmZXRjaFJlc3RhdXJhbnRSZXZpZXdzIiwiX3JlZiIsIl9yZWYyIiwiX3NsaWNlZFRvQXJyYXkiLCJyZXN0YXVyYW50IiwicmV2aWV3cyIsInB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiIiwiZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYiIsInJlc3RhdXJhbnRJZCIsIm9wZW5EYXRhYmFzZSIsIm9iamVjdFN0b3JlIiwiZ2V0QWxsIiwiZ2V0IiwiY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiIiwidHgiLCJwdXQiLCJjb21wbGV0ZSIsImNsZWFyIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MiLCJjdWlzaW5lIiwiY2FsbGJhY2siLCJmZXRjaFJlc3RhdXJhbnRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsInJlc3VsdHMiLCJtYXAiLCJ2IiwiaSIsImN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJsYXRsbmciLCJ1cmxGb3JSZXN0YXVyYW50IiwiQW5pbWF0aW9uIiwiRFJPUCIsInByb2Nlc3MiLCJzY3JvbGxlZCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiblNlbGVjdCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInNlbGYiLCJtYXJrZXJzIiwibSIsInNldE1hcCIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJ1bCIsImxpIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJpbmZvQmxvY2siLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJldmVudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJ1cmwiLCJwdXNoIiwibG9nIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwiZmV0Y2hOZWlnaGJvcmhvb2RzQW5kQ3Vpc2luZXMiLCJfcmVmMyIsIndpbmRvdyIsImluaXRNYXAiLCJNYXAiXSwibWFwcGluZ3MiOiJvc0NBQUEsMkdDV0FBLGtDQUlBQyxnQ0FNQUMsK0NBRUFDLFdBQ0FDLHNCQUdBRixFQUNBRyw2R0FlQUMsK0JBR0FDLGlIQVVBQyxzSUFTQUEs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MEcsRUFBQSxFQUFBbkosVUFBQXdCLGFBQUFDLElBQUF6QixVQUFBLEdBQUFBLFVBQUEsR0FBV21LLEtBQXJDaEIsU0FFUSxJQUFTL0gsRUFBQSxtQkFBQSxNQUViLGlCQUFBLHdCQUdnQixDQUFDSCxLQUFELGVBQXVCSixNQUh2QyxjQUFBc0ksV0FGRlcsVUFmRVgsU0FBQUEsR0FHQTNDLElBUktFLE1BVUUsU0FBQWpILFdBQ1BBLE1BQUFBLEtBckNGNEcsS0FBcUMsU0FBQUcsS0FDbkNBLE9BNERKcUYsT0FBQUMsUUFBaUIsZ0JBTWY5QyxJQUFBLElBQWVLLE9BQUFDLEtBQUp5QyxJQUFvQnBLLFNBQUFxSSxlQUFwQixPQUFBLE1BQW9ELFVBSjNELEtBQU0sZUFBVix3QkFJQSxXQU1BbkgsaUJBQUEsU0FBa0MsV0FDaENnSCxPQUNFLGdCQUtPLG9CQUNURyxlQUFBLE9BQUFwSSxjQUFBLFVBQUFDLGFBQUEsUUFBQSxlQURGLHFGQ1hGaUUsRUFBQTNFLFFBQUEsQ0FBQXVLLHNCQXJGQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsIlxuZnVuY3Rpb24gQWNjZXNzaWJpbGl0eVNlbGVjdChzZWxlY3Rvciwgb3B0aW9ucyA9IHt9KSB7XG4gIHRoaXMuc2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIG9wdGlvbnMubGFiZWwpO1xuICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpc3Rib3gnKTtcblxuICBpZiAoIXRoaXMuc2VsZWN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5vbkNoYW5nZSA9IG9wdGlvbnMub25DaGFuZ2UgfHwgKCgpID0+IHt9KTtcblxuICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgZHJvcGRvd24uY2xhc3NOYW1lID0gJ2N1c3RvbS1zZWxlY3RfX2Ryb3Bkb3duJztcblxuICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suY2xhc3NOYW1lID0gJ2N1c3RvbS1zZWxlY3RfX3NlbGVjdGVkLWl0ZW0tdmFsdWUnO1xuICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jay5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBvcHRpb25zLmluaXRpYWxWYWx1ZS52YWx1ZSk7XG4gIHRoaXMuc2VsZWN0ZWRWYWx1ZUJsb2NrLmlubmVyVGV4dCA9IG9wdGlvbnMuaW5pdGlhbFZhbHVlLm5hbWUgfHwgJyc7XG4gIGRyb3Bkb3duLmFwcGVuZCh0aGlzLnNlbGVjdGVkVmFsdWVCbG9jayk7XG5cbiAgY29uc3QgZHJvcGRvd25CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIGRyb3Bkb3duQnV0dG9uLmNsYXNzTmFtZSA9ICdjdXN0b20tc2VsZWN0X19kcm9wZG93bi1idXR0b24nO1xuICBkcm9wZG93bkJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIGRyb3Bkb3duQnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdvcGVuIGRyb3Bkb3duIGxpc3QnKTtcblxuICBkcm9wZG93bi5hcHBlbmQoZHJvcGRvd25CdXR0b24pO1xuICB0aGlzLnNlbGVjdC5hcHBlbmQoZHJvcGRvd24pO1xuXG4gIHRoaXMuaXRlbXNMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcbiAgdGhpcy5pdGVtc0xpc3QuY2xhc3NOYW1lID0gJ2N1c3RvbS1zZWxlY3RfX2xpc3QnO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZHMgPSBvcHRpb25zLnZhbHVlcyB8fCBbXTtcblxuICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBvcHRpb24uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XG4gIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgb3B0aW9ucy5uYW1lICsgJ19lbGVtJyk7XG4gIG9wdGlvbi5pbm5lckhUTUwgPSBvcHRpb25zLmluaXRpYWxWYWx1ZS5uYW1lO1xuICBvcHRpb24uc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgb3B0aW9ucy5pbml0aWFsVmFsdWUudmFsdWUpO1xuICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIHRoaXMub25MaXN0RWxlbWVudENsaWNrLmJpbmQodGhpcykoZSk7XG4gIH0pO1xuICB0aGlzLml0ZW1zTGlzdC5hcHBlbmQob3B0aW9uKTtcbiAgdGhpcy5zZXRTZWxlY3RlZEVsZW1lbnQob3B0aW9uKTtcblxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goKG5laWdoYm9yaG9vZCwgaW5kZXgpID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ29wdGlvbicpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgb3B0aW9ucy5uYW1lICsgJ19lbGVtXycgKyBpbmRleCk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgbmVpZ2hib3Job29kKTtcbiAgICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uTGlzdEVsZW1lbnRDbGljay5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLml0ZW1zTGlzdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG5cbiAgdGhpcy5zZWxlY3QuYXBwZW5kKHRoaXMuaXRlbXNMaXN0KTtcblxuICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSAwO1xuXG4gIGRyb3Bkb3duQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy50b2dnbGVEcm9wRG93bi5iaW5kKHRoaXMpKTtcbiAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnRvZ2dsZURyb3BEb3duLmJpbmQodGhpcykpO1xuXG4gIHRoaXMuc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmhhbmRsZUtleURvd24uYmluZCh0aGlzKSk7XG59XG5cbkFjY2Vzc2liaWxpdHlTZWxlY3QucHJvdG90eXBlID0ge1xuXG4gIHRvZ2dsZURyb3BEb3duKCkge1xuICAgIGlmICh0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkge1xuICAgICAgdGhpcy5pdGVtc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XG4gICAgfVxuICB9LFxuXG4gIG9wZW5Ecm9wRG93bigpIHtcbiAgICB0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XG4gIH0sXG5cbiAgY2xvc2VEcm9wRG93bigpIHtcbiAgICB0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7XG4gIH0sXG5cbiAgb25MaXN0RWxlbWVudENsaWNrKGUpIHtcbiAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnRJbmRleCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwodGhpcy5pdGVtc0xpc3QuY2hpbGRyZW4sIGUudGFyZ2V0KTtcbiAgICBpZiAoIXNlbGVjdGVkRWxlbWVudEluZGV4ID09PSAtMSlcbiAgICAgIHJldHVybjtcblxuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IHNlbGVjdGVkRWxlbWVudEluZGV4O1xuICAgIHRoaXMuc2V0U2VsZWN0ZWRFbGVtZW50KHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW3RoaXMuYWN0aXZlSXRlbUlkeF0sIHRydWUpO1xuICAgIHRoaXMuY2xvc2VEcm9wRG93bigpO1xuICB9LFxuXG4gIHNldFNlbGVjdGVkRWxlbWVudChlbGVtZW50LCB0cmlnZ2VyRXZlbnQgPSBmYWxzZSkge1xuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTtcbiAgICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jay5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCB2YWx1ZSk7XG4gICAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgdmFsdWUpO1xuICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZUJsb2NrLmlubmVyVGV4dCA9IGVsZW1lbnQuaW5uZXJUZXh0O1xuICAgIGZvciAoY29uc3QgZWwgb2YgdGhpcy5pdGVtc0xpc3QuY2hpbGRyZW4pIHtcbiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICcnKTtcbiAgICB9XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCAndHJ1ZScpO1xuICAgIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50JywgZWxlbWVudC5pZCk7XG4gICAgaWYgKHRyaWdnZXJFdmVudCkge1xuICAgICAgdGhpcy5vbkNoYW5nZSgpO1xuICAgIH1cbiAgfSxcblxuICBoYW5kbGVLZXlEb3duKGUpIHtcbiAgICAvLyBEZWZpbmUgdmFsdWVzIGZvciBrZXljb2Rlc1xuICAgIGNvbnN0IFZLX0VOVEVSID0gMTM7XG4gICAgY29uc3QgVktfRVNDID0gMjc7XG4gICAgY29uc3QgVktfU1BBQ0UgPSAzMjtcbiAgICBjb25zdCBWS19MRUZUID0gMzc7XG4gICAgY29uc3QgVktfVVAgPSAzODtcbiAgICBjb25zdCBWS19SSUdIVCA9IDM5O1xuICAgIGNvbnN0IFZLX0RPV04gPSA0MDtcblxuICAgIGlmIChbVktfRE9XTiwgVktfVVAsIFZLX1NQQUNFLCBWS19FTlRFUiwgVktfTEVGVCwgVktfUklHSFQsIFZLX0VTQ10uaW5kZXhPZihlLmtleUNvZGUpID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgIGNhc2UgVktfRE9XTjpcbiAgICAgIGNhc2UgVktfUklHSFQ6XG4gICAgICAgIHRoaXMubmV4dEFjdGl2ZUxpc3RJdGVtKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19VUDpcbiAgICAgIGNhc2UgVktfTEVGVDpcbiAgICAgICAgdGhpcy5wcmV2aW91c0FjdGl2ZUxpc3RJdGVtKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19TUEFDRTpcbiAgICAgICAgdGhpcy5vcGVuRHJvcERvd24oKTtcbiAgICAgICAgdGhpcy5pdGVtc0xpc3QuY2hpbGRyZW5bdGhpcy5hY3RpdmVJdGVtSWR4XS5mb2N1cygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfRU5URVI6XG4gICAgICAgIGNvbnN0IGFjdGl2ZSA9IHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW3RoaXMuYWN0aXZlSXRlbUlkeF07XG4gICAgICAgIGlmICghYWN0aXZlKVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGVkRWxlbWVudChhY3RpdmUpO1xuICAgICAgICB0aGlzLmNsb3NlRHJvcERvd24oKTtcbiAgICAgICAgdGhpcy5zZWxlY3QuZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFZLX0VTQzpcbiAgICAgICAgdGhpcy5jbG9zZURyb3BEb3duKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0LmZvY3VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybjtcbiAgfSxcbiAgbmV4dEFjdGl2ZUxpc3RJdGVtKCkge1xuICAgIGNvbnN0IG5leHRFbGVtZW50SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSWR4ID49IHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuLmxlbmd0aCAtIDEpID8gMCA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggKyAxKTtcbiAgICB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlbltuZXh0RWxlbWVudEluZGV4XS5mb2N1cygpO1xuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IG5leHRFbGVtZW50SW5kZXg7XG5cbiAgfSxcbiAgcHJldmlvdXNBY3RpdmVMaXN0SXRlbSgpIHtcbiAgICBjb25zdCBwcmV2RWxlbWVudEluZGV4ID0gKHRoaXMuYWN0aXZlSXRlbUlkeCA9PT0gMCkgPyB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlbi5sZW5ndGggLSAxIDogKHRoaXMuYWN0aXZlSXRlbUlkeCAtIDEpO1xuICAgIHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW3ByZXZFbGVtZW50SW5kZXhdLmZvY3VzKCk7XG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gcHJldkVsZW1lbnRJbmRleDtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBBY2Nlc3NpYmlsaXR5U2VsZWN0OyIsImNvbnN0IGlkYiA9IHJlcXVpcmUoJ2lkYicpO1xyXG5jb25zdCBBUFBfREJfTkFNRSA9ICdyZXN0YXVyYW50cy1kYic7XHJcbmNvbnN0IERCX1JFU1RBVVJBTlRTX1RBQkxFID0gJ3Jlc3RhdXJhbnRzJztcclxuY29uc3QgQVBQX0RCX1ZFUiA9IDE7XHJcblxyXG4vKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCArICcvcmVzdGF1cmFudHMnKVxyXG4gICAgICAudGhlbihkYXRhID0+IGRhdGEuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnRzKS50aGVuKCgpID0+IHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgICAgICBpZiAoIXJlc3RhdXJhbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZldGNoIGVycm9yJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnQgYnkgaWQgd2l0aCByZXZpZXdzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRXaXRoUmV2aWV3cyhpZCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtcclxuICAgICAgdGhpcy5mZXRjaFJlc3RhdXJhbnQoaWQpLFxyXG4gICAgICB0aGlzLmZldGNoUmVzdGF1cmFudFJldmlld3MoaWQpXHJcbiAgICBdKS50aGVuKChbIHJlc3RhdXJhbnQsIHJldmlld3MgXSkgPT4ge1xyXG4gICAgICByZXN0YXVyYW50LnJldmlld3MgPSByZXZpZXdzO1xyXG4gICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50SW50b0luZGV4ZWREYihyZXN0YXVyYW50KS50aGVuKCgpID0+IHJlc3RhdXJhbnQpO1xyXG4gICAgfSkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEZyb21JbmRleGVkRGIoaWQpLnRoZW4ocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZldGNoIGVycm9yJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZXN0YXVyYW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jlc3RhdXJhbnRzLyR7aWR9YClcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50UmV2aWV3cyhyZXN0YXVyYW50SWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JHtyZXN0YXVyYW50SWR9YClcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKClcclxuICAgICAgLnRoZW4oZGIgPT4gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXRBbGwoKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYihpZCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT5cclxuICAgICAgZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXQoK2lkKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnRzKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIuY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiKCkudGhlbigoKSA9PiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCkpO1xyXG4gICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgIHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuY2xlYXIoKTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgb3BlbkRhdGFiYXNlKCkge1xyXG4gICAgcmV0dXJuIGlkYi5vcGVuKEFQUF9EQl9OQU1FLCBBUFBfREJfVkVSLCAodXBncmFkZURiKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcclxuICAgICAgICBjYXNlIDAgOlxyXG4gICAgICAgICAgY29uc3QgcmVzdGF1cmFudFN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFLCB7a2V5UGF0aDogJ2lkJ30pO1xyXG4gICAgICAgICAgcmVzdGF1cmFudFN0b3JlLmNyZWF0ZUluZGV4KCdzdGF0dXMnLCAnc3RhdHVzJyk7XHJcbiAgICAgICAgLy8gYnJlYWsgb21pdHRlZFxyXG4gICAgICAgIGRlZmF1bHQgOlxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MoaWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIHJldHVybiByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XHJcblxyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuXHJcbiAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kc0FuZEN1aXNpbmVzKCkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xyXG4gICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG5cclxuICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbmVpZ2hib3Job29kczogbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKSxcclxuICAgICAgICBjdWlzaW5lczogY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpLFxyXG4gICAgICAgIHJlc3RhdXJhbnRzLFxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAvaW1nLyR7cmVzdGF1cmFudC5pZH1fc21hbGwuanBnYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVNyY1NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gREJIZWxwZXI7IiwiY29uc3QgREJIZWxwZXIgPSByZXF1aXJlKCcuL2RiaGVscGVyJyk7XHJcbmNvbnN0IEFjY2Vzc2liaWxpdHlTZWxlY3QgPSByZXF1aXJlKCcuL2FjY2Vzc2liaWxpdHktc2VsZWN0Jyk7XHJcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKCcuL3Byb2Nlc3MnKTtcclxuXHJcbmxldCByZXN0YXVyYW50cyxcclxuICBuZWlnaGJvcmhvb2RzLFxyXG4gIGN1aXNpbmVzO1xyXG52YXIgbWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG52YXIgc2Nyb2xsZWQgPSBmYWxzZTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcclxuICBjb25zb2xlLmxvZygnRE9NQ29udGVudExvYWRlZCcpO1xyXG4gIHByb2Nlc3MucmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzQW5kQ3Vpc2luZXMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xyXG4gICAgZmlsbFJlc3RhdXJhbnRzSFRNTChyZXN0YXVyYW50cyk7XHJcbiAgfSlcclxufSk7XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxOZWlnaGJvcmhvb2RzSFRNTChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gbmV3IEFjY2Vzc2liaWxpdHlTZWxlY3QoXHJcbiAgICAnI25laWdoYm9yaG9vZHMtc2VsZWN0JyxcclxuICAgIHtcclxuICAgICAgbmFtZTogJ05laWdoYm9yaG9vZCcsXHJcbiAgICAgIGxhYmVsOiAnTmVpZ2hib3Job29kJyxcclxuICAgICAgaW5pdGlhbFZhbHVlOiB7bmFtZTogJ0FsbCBOZWlnaGJvcmhvb2RzJywgdmFsdWU6ICdhbGwnfSxcclxuICAgICAgdmFsdWVzOiBzZWxmLm5laWdoYm9yaG9vZHMsXHJcbiAgICAgIG9uQ2hhbmdlOiB1cGRhdGVSZXN0YXVyYW50c1xyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZldGNoTmVpZ2hib3Job29kc0FuZEN1aXNpbmVzKCkge1xyXG4gIHJldHVybiBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpLnRoZW4oKHsgcmVzdGF1cmFudHMsIG5laWdoYm9yaG9vZHMsIGN1aXNpbmVzIH0pID0+IHtcclxuXHJcbiAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKG5laWdoYm9yaG9vZHMpO1xyXG5cclxuICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgIGZpbGxDdWlzaW5lc0hUTUwoY3Vpc2luZXMpO1xyXG5cclxuICAgIHJldHVybiByZXN0YXVyYW50cztcclxuXHJcbiAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxDdWlzaW5lc0hUTUwoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSB7XHJcblxyXG4gIGNvbnN0IHNlbGVjdCA9IG5ldyBBY2Nlc3NpYmlsaXR5U2VsZWN0KFxyXG4gICAgJyNjdWlzaW5lcy1zZWxlY3QnLFxyXG4gICAge1xyXG4gICAgICBuYW1lOiAnQ3Vpc2luZXMnLFxyXG4gICAgICBsYWJlbDogJ0N1aXNpbmVzJyxcclxuICAgICAgaW5pdGlhbFZhbHVlOiB7bmFtZTogJ0FsbCBDdWlzaW5lcycsIHZhbHVlOiAnYWxsJ30sXHJcbiAgICAgIHZhbHVlczogY3Vpc2luZXMsXHJcbiAgICAgIG9uQ2hhbmdlOiB1cGRhdGVSZXN0YXVyYW50c1xyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuXHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICB6b29tOiAxMixcclxuICAgIGNlbnRlcjogbG9jLFxyXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgfSk7XHJcblxyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCAoKSA9PiB7XHJcbiAgICBpZiAoIXNjcm9sbGVkKSB7XHJcbiAgICAgIHNjcm9sbGVkID0gdHJ1ZTtcclxuICAgICAgLy8gdXBkYXRlUmVzdGF1cmFudHMoKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKS5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKS5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgJ0dvb2dsZSBtYXAnKTtcclxuICB9LCAyMDApO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG5mdW5jdGlvbiB1cGRhdGVSZXN0YXVyYW50cygpIHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3QuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTtcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgIGZpbGxSZXN0YXVyYW50c0hUTUwocmVzdGF1cmFudHMpO1xyXG4gIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5mdW5jdGlvbiByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKSB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBpZihzZWxmLm1hcmtlcnMpIHtcclxuICAgIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIH1cclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRzSFRNTChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpIHtcclxuXHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG4gIH0pO1xyXG4gIGFkZE1hcmtlcnNUb01hcChyZXN0YXVyYW50cyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBgQW4gaW1hZ2UgZnJvbSB0aGUgcmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX1gKTtcclxuICBsaS5hcHBlbmQoaW1hZ2UpO1xyXG5cclxuICBjb25zdCBpbmZvQmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBpbmZvQmxvY2suY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW5mbyc7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtY2FyZC1uYW1lJztcclxuICBuYW1lLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGluZm9CbG9jay5hcHBlbmQobmFtZSk7XHJcblxyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBuZWlnaGJvcmhvb2Quc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBpbmZvQmxvY2suYXBwZW5kKG5laWdoYm9yaG9vZCk7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgYWRkcmVzcy5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgaW5mb0Jsb2NrLmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW5mb0Jsb2NrLmFwcGVuZChtb3JlKTtcclxuICBsaS5hcHBlbmQoaW5mb0Jsb2NrKTtcclxuXHJcbiAgcmV0dXJuIGxpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuZnVuY3Rpb24gYWRkTWFya2Vyc1RvTWFwKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybFxyXG4gICAgfSk7XHJcbiAgICBpZiAoIXNlbGYubWFya2Vycykge1xyXG4gICAgICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICAgIH1cclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn1cclxuIiwiLyogUmVnaXN0ZXIgc2VydmljZSB3b3JrZXIgd2l0aCBldmVudHMgKi9cclxuZnVuY3Rpb24gcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCkge1xyXG5cclxuICByZXR1cm47XHJcblxyXG4gIGlmICghJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXJ2aWNlV29ya2VyIG5vdCByZWdpc3RlcicpO1xyXG4gIH1cclxuXHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24gKHJlZykge1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChyZWcuYWN0aXZlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdUaGVyZSBpcyBhbiBhbiBhY3RpdmUgc2VydmljZSB3b3JrZXInKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVnLndhaXRpbmcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3dhaXRpbmcgOicsIHJlZy53YWl0aW5nKTtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIGlzIHdhaXRpbmcnKTtcclxuICAgICAgdXBkYXRlU2VydmljZVdvcmtlcihyZWcud2FpdGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZy5pbnN0YWxsaW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdpbnN0YWxsaW5nIDogJywgcmVnKTtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHN0YXR1cyBpcyBpbnN0YWxsaW5nJyk7XHJcbiAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVnLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgdXBkYXRlIGZvdW5kJywgcmVnKTtcclxuICAgICAgdHJhY2tJbnN0YWxsaW5nKHJlZy5pbnN0YWxsaW5nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHZhciByZWZyZXNoaW5nO1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKHJlZnJlc2hpbmcpIHJldHVybjtcclxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIHJlZnJlc2hpbmcgPSB0cnVlO1xyXG4gICAgICB9LCAxMDAwKTtcclxuICAgIH0pO1xyXG5cclxuICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKCdSZWdpc3RyYXRpb24gZmFpbGVkIHdpdGggJyArIGVycm9yKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdHJhY2tJbnN0YWxsaW5nKGluc3RhbGxpbmdXb3JrZXIpIHtcclxuICBpZiAoIWluc3RhbGxpbmdXb3JrZXIpIHtcclxuICAgIGNvbnNvbGUubG9nKCdXb3JrZXIgbm90IGRlZmluZWQhJyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGluc3RhbGxpbmdXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignc3RhdGVjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBzdGF0ZSB3YXMgY2hhbmdlZCB0byAnICsgaW5zdGFsbGluZ1dvcmtlci5zdGF0ZSk7XHJcbiAgICBpZiAoaW5zdGFsbGluZ1dvcmtlci5zdGF0ZSA9PT0gJ2luc3RhbGxlZCcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2Ugd29ya2VyIGluc3RhbGxlZCBhbmQgd2FpdGluZyBmb3IgYWN0aXZhdGlvbicsIGluc3RhbGxpbmdXb3JrZXIpO1xyXG4gICAgICB1cGRhdGVTZXJ2aWNlV29ya2VyKGluc3RhbGxpbmdXb3JrZXIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVTZXJ2aWNlV29ya2VyKHdvcmtlcikge1xyXG4gIHNlbmRNZXNzYWdlVG9TZXJ2aWNlV29ya2VyKHthY3Rpb246ICdza2lwV2FpdGluZyd9LCB3b3JrZXIpXHJcbiAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2VGcm9tU3cpIHtcclxuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2VGcm9tU3cpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbmRNZXNzYWdlVG9TZXJ2aWNlV29ya2VyKG1zZywgd29ya2VyKSB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIHZhciBtc2dDaGFuID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XHJcblxyXG4gICAgLy8gSGFuZGxlciBmb3IgcmVjaWV2aW5nIG1lc3NhZ2UgcmVwbHkgZnJvbSBzZXJ2aWNlIHdvcmtlclxyXG4gICAgbXNnQ2hhbi5wb3J0MS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgaWYgKGV2ZW50LmRhdGEuZXJyb3IpIHtcclxuICAgICAgICByZWplY3QoZXZlbnQuZGF0YS5lcnJvcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShldmVudC5kYXRhKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vIFNlbmQgbWVzc2FnZSB0byBzZXJ2aWNlIHdvcmtlciBhbG9uZyB3aXRoIHBvcnQgZm9yIHJlcGx5XHJcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2UobXNnLCBbbXNnQ2hhbi5wb3J0Ml0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIsXHJcbn07Il19
