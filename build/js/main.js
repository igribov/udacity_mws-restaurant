"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function o(s,a,c){function u(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return u(s[t][1][e]||e)},i,i.exports,o,s,a,c)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,f,t){!function(){function s(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function o(n,r,i){var o,e=new Promise(function(e,t){s(o=n[r].apply(n,i)).then(e,t)});return e.request=o,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return o(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=o(e,n,arguments)).then(function(e){if(e)return new a(e,t.request)});var e,t})})}function i(e){this._index=e}function a(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function u(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new u(n)}function d(e){this._db=e}e(i,"_index",["name","keyPath","multiEntry","unique"]),t(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(a,"_cursor",["direction","key","primaryKey","value"]),t(a,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(a.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),s(t._request).then(function(e){if(e)return new a(e,t._request)})})})}),c.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(c,"_store",["name","keyPath","indexNames","autoIncrement"]),t(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(c,"_store",IDBObjectStore,["deleteIndex"]),u.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},e(u,"_tx",["objectStoreNames","mode"]),n(u,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new u(this._db.transaction.apply(this._db,arguments))},e(d,"_db",["name","version","objectStoreNames"]),n(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[c,i].forEach(function(e){o in e.prototype&&(e.prototype[o.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[o].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});var h={open:function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new l(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new d(e)})},delete:function(e){return o(indexedDB,"deleteDatabase",[e])}};void 0!==f?(f.exports=h,f.exports.default=f.exports):self.idb=h}()},{}],2:[function(e,t,n){function r(e){var r=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.select=document.querySelector(e),this.select.setAttribute("aria-label",i.label),this.select.setAttribute("tabindex","0"),this.select.setAttribute("role","listbox"),this.select){this.onChange=i.onChange||function(){};var t=document.createElement("span");t.className="custom-select__dropdown",this.selectedValueBlock=document.createElement("span"),this.selectedValueBlock.className="custom-select__selected-item-value",this.selectedValueBlock.setAttribute("data-value",i.initialValue.value),this.selectedValueBlock.innerText=i.initialValue.name||"",t.append(this.selectedValueBlock);var n=document.createElement("span");n.className="custom-select__dropdown-button",n.setAttribute("role","button"),n.setAttribute("aria-label","open dropdown list"),t.append(n),this.select.append(t),this.itemsList=document.createElement("ul"),this.itemsList.className="custom-select__list";var o=i.values||[],s=document.createElement("li");s.setAttribute("tabindex","0"),s.setAttribute("role","option"),s.setAttribute("id",i.name+"_elem"),s.innerHTML=i.initialValue.name,s.setAttribute("data-value",i.initialValue.value),s.addEventListener("click",function(e){console.log(1),r.onListElementClick.bind(r)(e)}),this.itemsList.append(s),this.setSelectedElement(s),o.forEach(function(e,t){var n=document.createElement("li");n.setAttribute("tabindex","0"),n.setAttribute("role","option"),n.setAttribute("id",i.name+"_elem_"+t),n.innerHTML=e,n.setAttribute("data-value",e),n.addEventListener("click",r.onListElementClick.bind(r)),r.itemsList.append(n)}),this.select.append(this.itemsList),this.activeItemIdx=0,n.addEventListener("click",this.toggleDropDown.bind(this)),this.selectedValueBlock.addEventListener("click",this.toggleDropDown.bind(this)),this.select.addEventListener("keydown",this.handleKeyDown.bind(this))}}r.prototype={toggleDropDown:function(){this.itemsList.classList.contains("open")?this.itemsList.classList.remove("open"):this.itemsList.classList.add("open")},openDropDown:function(){this.itemsList.classList.add("open")},closeDropDown:function(){this.itemsList.classList.remove("open")},onListElementClick:function(e){var t=Array.prototype.indexOf.call(this.itemsList.children,e.target);-1!==!t&&(this.activeItemIdx=t,this.setSelectedElement(this.itemsList.children[this.activeItemIdx]),this.closeDropDown())},setSelectedElement:function(e){if(e){var t=e.getAttribute("data-value");this.selectedValueBlock.setAttribute("data-value",t),this.select.setAttribute("data-value",t),this.selectedValueBlock.innerText=e.innerText;var n=!0,r=!1,i=void 0;try{for(var o,s=this.itemsList.children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.setAttribute("aria-selected","")}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}e.setAttribute("aria-selected","true"),this.select.setAttribute("aria-activedescendant",e.id),this.onChange()}},handleKeyDown:function(e){var t=13,n=27,r=32,i=37,o=38,s=39,a=40;if(-1!==[a,o,r,t,i,s,n].indexOf(e.keyCode))switch(e.preventDefault(),e.keyCode){case a:case s:this.nextActiveListItem();break;case o:case i:this.previousActiveListItem();break;case r:this.openDropDown(),this.itemsList.children[this.activeItemIdx].focus();break;case t:var c=this.itemsList.children[this.activeItemIdx];if(!c)break;this.setSelectedElement(c),this.closeDropDown(),this.select.focus();break;case n:this.closeDropDown(),this.select.focus()}},nextActiveListItem:function(){var e=this.activeItemIdx>=this.itemsList.children.length-1?0:this.activeItemIdx+1;this.itemsList.children[e].focus(),this.activeItemIdx=e},previousActiveListItem:function(){var e=0===this.activeItemIdx?this.itemsList.children.length-1:this.activeItemIdx-1;this.itemsList.children[e].focus(),this.activeItemIdx=e}},t.exports=r},{}],3:[function(e,t,n){var r=e("idb"),o="restaurants",i=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"fetchRestaurants",value:function(){var t=this;return fetch(i.DATABASE_URL+"/restaurants").then(function(e){return e.json()}).then(function(e){return t.putRestaurantsIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return i.fetchRestaurantsFromIndexedDb().then(function(e){if(e.length)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(t){var n=this;return fetch(i.DATABASE_URL+"/restaurants/"+t).then(function(e){return e.json()}).then(function(e){return n.putRestaurantIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return i.fetchRestaurantFromIndexedDb(t).then(function(e){if(e)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return i.openDatabase().then(function(e){return e.transaction(o).objectStore(o).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(t){return i.openDatabase().then(function(e){return e.transaction(o).objectStore(o).get(+t)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return i.clearRestaurantsInIndexedDb().then(function(){return i.openDatabase().then(function(e){var t=e.transaction(o,"readwrite");return n.forEach(function(e){return t.objectStore(o).put(e)}),t.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return i.openDatabase().then(function(e){var t=e.transaction(o,"readwrite");return t.objectStore(o).put(n),t.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return i.openDatabase().then(function(e){var t=e.transaction(o,"readwrite");return t.objectStore(o).clear(),t.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore(o,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(e){return i.fetchRestaurant(e).then(function(e){return e})}},{key:"fetchRestaurantByCuisine",value:function(t,e){i.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return i.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return i.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoods",value:function(){return i.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"fetchCuisines",value:function(){return i.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].cuisine_type});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.id+"_medium.jpg"}},{key:"imageSrcSetForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),i}();t.exports=i},{idb:1}],4:[function(e,t,n){var c=e("./dbhelper"),r=e("./accessibility-select"),i=e("./process");function o(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.getAttribute("data-value"),r=t.getAttribute("data-value");c.fetchRestaurantByCuisineAndNeighborhood(n,r).then(function(e){!function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.setMap(null)});self.markers=[],self.restaurants=e}(e),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(function(e){var t=document.createElement("li");t.setAttribute("tabindex",0);var n=document.createElement("img");n.className="restaurant-img",n.src=c.imageUrlForRestaurant(e),n.setAttribute("alt","An image from the restaurant "+e.name),t.append(n);var r=document.createElement("div");r.className="restaurant-info";var i=document.createElement("h2");i.className="restaurant-card-name",i.setAttribute("tabindex","0"),i.innerHTML=e.name,r.append(i);var o=document.createElement("p");o.setAttribute("tabindex",0),o.innerHTML=e.neighborhood,r.append(o);var s=document.createElement("p");s.setAttribute("tabindex",0),s.innerHTML=e.address,r.append(s);var a=document.createElement("a");return a.innerHTML="View Details",a.href=c.urlForRestaurant(e),r.append(a),t.append(r),t}(e))}),function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=c.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})}()}()}).catch(function(e){console.error(e)})}document.addEventListener("DOMContentLoaded",function(e){i.registerServiceWorker(),c.fetchNeighborhoods().then(function(e){self.neighborhoods=e,function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,new r("#neighborhoods-select",{name:"Neighborhood",label:"Neighborhood",initialValue:{name:"All Neighborhoods",value:"all"},values:self.neighborhoods,onChange:o})}()}).catch(function(e){console.error("fetchNeighborhoods error",e)}),c.fetchCuisines().then(function(e){self.cuisines=e,function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines;new r("#cuisines-select",{name:"Cuisines",label:"Cuisines",initialValue:{name:"All Cuisines",value:"all"},values:e,onChange:o})}()}).catch(function(e){console.error(e)})}),window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),o()}},{"./accessibility-select":2,"./dbhelper":3,"./process":5}],5:[function(e,t,n){function r(e){e?e.addEventListener("statechange",function(){console.log("ServiceWorker state was changed to "+e.state),"installed"===e.state&&(console.log("Service worker installed and waiting for activation",e),i(e))}):console.log("Worker not defined!")}function i(e){var r,i;(r={action:"skipWaiting"},i=e,new Promise(function(t,n){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?n(e.data.error):t(e.data)},i.postMessage(r,[e.port2])})).then(function(e){console.log(e)})}t.exports={registerServiceWorker:function(){if(!1 in navigator)throw new Error("serviceWorker not register");navigator.serviceWorker.register("/sw.js").then(function(e){var t;navigator.serviceWorker.controller&&(e.active&&console.log("There is an an active service worker"),e.waiting&&(console.log("waiting :",e.waiting),console.log("service worker is waiting"),i(e.waiting)),e.installing&&(console.log("installing : ",e),console.log("service worker status is installing"),r(e.installing)),e.addEventListener("updatefound",function(){console.log("service worker update found",e),r(e.installing)}),navigator.serviceWorker.addEventListener("controllerchange",function(){t||setTimeout(function(){window.location.reload(),t=!0},1e3)}))}).catch(function(e){console.log("Registration failed with "+e)})}}},{}]},{},[4]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvYWNjZXNzaWJpbGl0eS1zZWxlY3QuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9wcm9jZXNzLmpzIl0sIm5hbWVzIjpbInJlc3VsdCIsImVycm9yIiwicmVxdWVzdCIsImFyZ3MiLCJyZWplY3QiLCJwIiwicHJvcCIsInZhbCIsImFyZ3VtZW50cyIsImluZGV4IiwiY3Vyc29yIiwic3RvcmUiLCJpZGJUcmFuc2FjdGlvbiIsInJlc29sdmUiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsInRoaXMiLCJfcmVxdWVzdCIsImFyciIsIl9pbmRleCIsInZhbHVlIiwiY29udGludWUiLCJpdGVtcyIsInZlcnNpb24iLCJuYW1lIiwiZXhwIiwiZXhwb3J0cyIsIkFjY2Vzc2liaWxpdHlTZWxlY3QiLCJzZWxlY3RvciIsIl90aGlzIiwib3B0aW9ucyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInNldEF0dHJpYnV0ZSIsImxhYmVsIiwib25DaGFuZ2UiLCJkcm9wZG93biIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJzZWxlY3RlZFZhbHVlQmxvY2siLCJpbml0aWFsVmFsdWUiLCJpbm5lclRleHQiLCJhcHBlbmQiLCJkcm9wZG93bkJ1dHRvbiIsIml0ZW1zTGlzdCIsIm5laWdoYm9yaG9vZHMiLCJ2YWx1ZXMiLCJvcHRpb24iLCJpbm5lckhUTUwiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImxvZyIsIm9uTGlzdEVsZW1lbnRDbGljayIsImJpbmQiLCJzZXRTZWxlY3RlZEVsZW1lbnQiLCJmb3JFYWNoIiwibmVpZ2hib3Job29kIiwiYWN0aXZlSXRlbUlkeCIsInRvZ2dsZURyb3BEb3duIiwiaGFuZGxlS2V5RG93biIsInByb3RvdHlwZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiYWRkIiwic2VsZWN0ZWRFbGVtZW50SW5kZXgiLCJBcnJheSIsImluZGV4T2YiLCJjYWxsIiwiY2hpbGRyZW4iLCJ0YXJnZXQiLCJjbG9zZURyb3BEb3duIiwiZWxlbWVudCIsImdldEF0dHJpYnV0ZSIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24iLCJfc3RlcCIsIl9pdGVyYXRvciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJpZCIsIlZLX0VOVEVSIiwiVktfRVNDIiwiVktfU1BBQ0UiLCJWS19MRUZUIiwiVktfVVAiLCJWS19SSUdIVCIsIlZLX0RPV04iLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJuZXh0QWN0aXZlTGlzdEl0ZW0iLCJwcmV2aW91c0FjdGl2ZUxpc3RJdGVtIiwib3BlbkRyb3BEb3duIiwiZm9jdXMiLCJhY3RpdmUiLCJuZXh0RWxlbWVudEluZGV4IiwicHJldkVsZW1lbnRJbmRleCIsIm1vZHVsZSIsImlkYiIsInJlcXVpcmUiLCJEQl9SRVNUQVVSQU5UU19UQUJMRSIsIkRCSGVscGVyIiwiX3RoaXMyIiwiREFUQUJBU0VfVVJMIiwidGhlbiIsImRhdGEiLCJqc29uIiwicmVzdGF1cmFudHMiLCJwdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIiLCJjYXRjaCIsImVyciIsImZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiIiwiRXJyb3IiLCJfdGhpczMiLCJyZXN0YXVyYW50IiwicHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIiLCJmZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiIiwib3BlbkRhdGFiYXNlIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJnZXQiLCJjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIiLCJ0eCIsInB1dCIsImNvbXBsZXRlIiwiY2xlYXIiLCJvcGVuIiwidXBncmFkZURiIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwiY3JlYXRlSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnQiLCJjdWlzaW5lIiwiY2FsbGJhY2siLCJmZXRjaFJlc3RhdXJhbnRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsInJlc3VsdHMiLCJtYXAiLCJ2IiwiaSIsImN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJsYXRsbmciLCJ1cmxGb3JSZXN0YXVyYW50IiwiQW5pbWF0aW9uIiwiRFJPUCIsInByb2Nlc3MiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsIm5TZWxlY3QiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJzZWxmIiwibWFya2VycyIsIm0iLCJzZXRNYXAiLCJ1bCIsImxpIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJpbmZvQmxvY2siLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJldmVudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJ1cmwiLCJwdXNoIiwiYWRkTWFya2Vyc1RvTWFwIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInJlZ2lzdGVyU2VydmljZVdvcmtlciIsImZldGNoTmVpZ2hib3Job29kcyIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImZldGNoQ3Vpc2luZXMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInRyYWNrSW5zdGFsbGluZyIsImluc3RhbGxpbmdXb3JrZXIiLCJzdGF0ZSIsInVwZGF0ZVNlcnZpY2VXb3JrZXIiLCJ3b3JrZXIiLCJtc2ciLCJhY3Rpb24iLCJQcm9taXNlIiwibXNnQ2hhbiIsIk1lc3NhZ2VDaGFubmVsIiwicG9ydDEiLCJvbm1lc3NhZ2UiLCJwb3N0TWVzc2FnZSIsInBvcnQyIiwicmVzcG9uc2VGcm9tU3ciLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWciLCJyZWZyZXNoaW5nIiwiY29udHJvbGxlciIsIndhaXRpbmciLCJpbnN0YWxsaW5nIiwicmVsb2FkIl0sIm1hcHBpbmdzIjoieXlCQUFBLDJHQ1dBQSxrQ0FJQUMsZ0NBTUFDLCtDQUVBQyxXQUNBQyxzQkFHQUYsRUFDQUcsNkdBZUFDLCtCQUdBQyxpSEFVQUMsc0lBU0FBLGdJQVNBQSxtREF2Q0FOLGlEQTZDQU8sK0JBd0JBQyxnQkFDQVIsNEJBZ0NBUyx5QkF3Q0FDLGtFQUdBQyw4QkFHQVosaUNBR0FBLHFDQW1CQWEsa0JBQ0FDLHlCQUNBQywwQkFtQkFGLGVBL0lBLENBQ0EsT0FDQSxVQUNBLGFBQ0EsaUNBR0EsQ0FDQSxNQUNBLFNBQ0EsU0FDQSxhQUNBLGdDQUdBLENBQ0EsYUFDQSxnQ0FRQSxDQUNBLFlBQ0EsTUFDQSxhQUNBLGtDQUdBLENBQ0EsU0FDQSxzSUFPQUcsT0FDQVQsdUZBRUFMLHdEQUdBZSw0R0FXQVYsMkZBSUFBLDBCQUdBLENBQ0EsT0FDQSxVQUNBLGFBQ0EsOENBR0EsQ0FDQSxNQUNBLE1BQ0EsU0FDQSxRQUNBLE1BQ0EsU0FDQSxTQUNBLGFBQ0Esc0NBR0EsQ0FDQSxhQUNBLDhDQUdBLENBQ0Esb0dBbUJBQSx1QkFHQSxDQUNBLG1CQUNBLGtDQUdBLENBQ0EsMEdBVUFBLHVCQUdBLENBQ0EsT0FDQSxVQUNBLDJDQUdBLENBQ0Esb0JBQ0EsOEZBUUFBLHVCQUdBLENBQ0EsT0FDQSxVQUNBLDJDQUdBLENBQ0EseUtBV0FBLHFDQXRQQVcsaUJBdVBBLHVCQUNBQyxpQ0FDQSwrQkFFQXBCLHFHQVVBaUIsT0FDQSw0RUFRQUksaUNBTUFDLGFBSEFDLE1BTkFBLG1FQWlCQUMsUUFDQXRCLGdGQUlBYywrQ0FLQUYsOERBSUFXLDRCQUtBQyxzQkFDQUMsa0JBR0FELDZCQ3ZUQSxTQUFBRSxFQUFBQyxHQUFxRCxJQUFBQyxFQUFBYixLQUFkYyxFQUFBLEVBQUF2QixVQUFBd0IsYUFBQUMsSUFB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SyxpQkFBQSxjQUFvQyxtQkFDbENFLElBQUEsOEJBQUE0SixLQUNnQkEsRUFBaEJJLHdCQUlGTixjQUFBNUosaUJBQUEsbUJBQTZELFdBQzNEK0osY0FDVyxrQkFDVGhDLFNBQUFvQyxZQUNBLEdBRkYsVUE1Qkp0RyxNQWtDUyxTQUFBakgsV0FDUHNELElBQVksNEJBQVp0RCIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsIlxuZnVuY3Rpb24gQWNjZXNzaWJpbGl0eVNlbGVjdChzZWxlY3Rvciwgb3B0aW9ucyA9IHt9KSB7XG4gIHRoaXMuc2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIG9wdGlvbnMubGFiZWwpO1xuICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpc3Rib3gnKTtcblxuICBpZiAoIXRoaXMuc2VsZWN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy5vbkNoYW5nZSA9IG9wdGlvbnMub25DaGFuZ2UgfHwgKCgpID0+IHt9KTtcblxuICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgZHJvcGRvd24uY2xhc3NOYW1lID0gJ2N1c3RvbS1zZWxlY3RfX2Ryb3Bkb3duJztcblxuICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suY2xhc3NOYW1lID0gJ2N1c3RvbS1zZWxlY3RfX3NlbGVjdGVkLWl0ZW0tdmFsdWUnO1xuICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jay5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBvcHRpb25zLmluaXRpYWxWYWx1ZS52YWx1ZSk7XG4gIHRoaXMuc2VsZWN0ZWRWYWx1ZUJsb2NrLmlubmVyVGV4dCA9IG9wdGlvbnMuaW5pdGlhbFZhbHVlLm5hbWUgfHwgJyc7XG4gIGRyb3Bkb3duLmFwcGVuZCh0aGlzLnNlbGVjdGVkVmFsdWVCbG9jayk7XG5cbiAgY29uc3QgZHJvcGRvd25CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIGRyb3Bkb3duQnV0dG9uLmNsYXNzTmFtZSA9ICdjdXN0b20tc2VsZWN0X19kcm9wZG93bi1idXR0b24nO1xuICBkcm9wZG93bkJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIGRyb3Bkb3duQnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdvcGVuIGRyb3Bkb3duIGxpc3QnKTtcblxuICBkcm9wZG93bi5hcHBlbmQoZHJvcGRvd25CdXR0b24pO1xuICB0aGlzLnNlbGVjdC5hcHBlbmQoZHJvcGRvd24pO1xuXG4gIHRoaXMuaXRlbXNMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcbiAgdGhpcy5pdGVtc0xpc3QuY2xhc3NOYW1lID0gJ2N1c3RvbS1zZWxlY3RfX2xpc3QnO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZHMgPSBvcHRpb25zLnZhbHVlcyB8fCBbXTtcblxuICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBvcHRpb24uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XG4gIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgb3B0aW9ucy5uYW1lICsgJ19lbGVtJyk7XG4gIG9wdGlvbi5pbm5lckhUTUwgPSBvcHRpb25zLmluaXRpYWxWYWx1ZS5uYW1lO1xuICBvcHRpb24uc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgb3B0aW9ucy5pbml0aWFsVmFsdWUudmFsdWUpO1xuICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKDEpO1xuICAgIHRoaXMub25MaXN0RWxlbWVudENsaWNrLmJpbmQodGhpcykoZSk7XG4gIH0pO1xuICB0aGlzLml0ZW1zTGlzdC5hcHBlbmQob3B0aW9uKTtcbiAgdGhpcy5zZXRTZWxlY3RlZEVsZW1lbnQob3B0aW9uKTtcblxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goKG5laWdoYm9yaG9vZCwgaW5kZXgpID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ29wdGlvbicpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgb3B0aW9ucy5uYW1lICsgJ19lbGVtXycgKyBpbmRleCk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgbmVpZ2hib3Job29kKTtcbiAgICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uTGlzdEVsZW1lbnRDbGljay5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLml0ZW1zTGlzdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG5cbiAgdGhpcy5zZWxlY3QuYXBwZW5kKHRoaXMuaXRlbXNMaXN0KTtcblxuICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSAwO1xuXG4gIGRyb3Bkb3duQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy50b2dnbGVEcm9wRG93bi5iaW5kKHRoaXMpKTtcbiAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnRvZ2dsZURyb3BEb3duLmJpbmQodGhpcykpO1xuXG4gIHRoaXMuc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmhhbmRsZUtleURvd24uYmluZCh0aGlzKSk7XG59XG5cbkFjY2Vzc2liaWxpdHlTZWxlY3QucHJvdG90eXBlID0ge1xuXG4gIHRvZ2dsZURyb3BEb3duKCkge1xuICAgIGlmICh0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkge1xuICAgICAgdGhpcy5pdGVtc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XG4gICAgfVxuICB9LFxuXG4gIG9wZW5Ecm9wRG93bigpIHtcbiAgICB0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XG4gIH0sXG5cbiAgY2xvc2VEcm9wRG93bigpIHtcbiAgICB0aGlzLml0ZW1zTGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7XG4gIH0sXG5cbiAgb25MaXN0RWxlbWVudENsaWNrKGUpIHtcbiAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnRJbmRleCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwodGhpcy5pdGVtc0xpc3QuY2hpbGRyZW4sIGUudGFyZ2V0KTtcbiAgICBpZiAoIXNlbGVjdGVkRWxlbWVudEluZGV4ID09PSAtMSlcbiAgICAgIHJldHVybjtcblxuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IHNlbGVjdGVkRWxlbWVudEluZGV4O1xuICAgIHRoaXMuc2V0U2VsZWN0ZWRFbGVtZW50KHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW3RoaXMuYWN0aXZlSXRlbUlkeF0pO1xuICAgIHRoaXMuY2xvc2VEcm9wRG93bigpO1xuICB9LFxuXG4gIHNldFNlbGVjdGVkRWxlbWVudChlbGVtZW50KSB7XG4gICAgaWYgKCFlbGVtZW50KVxuICAgICAgcmV0dXJuO1xuXG4gICAgY29uc3QgdmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xuICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZUJsb2NrLnNldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScsIHZhbHVlKTtcbiAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCB2YWx1ZSk7XG4gICAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suaW5uZXJUZXh0ID0gZWxlbWVudC5pbm5lclRleHQ7XG4gICAgZm9yIChjb25zdCBlbCBvZiB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlbikge1xuICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJycpO1xuICAgIH1cbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICd0cnVlJyk7XG4gICAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnLCBlbGVtZW50LmlkKTtcbiAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gIH0sXG5cbiAgaGFuZGxlS2V5RG93bihlKSB7XG4gICAgLy8gRGVmaW5lIHZhbHVlcyBmb3Iga2V5Y29kZXNcbiAgICBjb25zdCBWS19FTlRFUiA9IDEzO1xuICAgIGNvbnN0IFZLX0VTQyA9IDI3O1xuICAgIGNvbnN0IFZLX1NQQUNFID0gMzI7XG4gICAgY29uc3QgVktfTEVGVCA9IDM3O1xuICAgIGNvbnN0IFZLX1VQID0gMzg7XG4gICAgY29uc3QgVktfUklHSFQgPSAzOTtcbiAgICBjb25zdCBWS19ET1dOID0gNDA7XG5cbiAgICBpZiAoW1ZLX0RPV04sIFZLX1VQLCBWS19TUEFDRSwgVktfRU5URVIsIFZLX0xFRlQsIFZLX1JJR0hULCBWS19FU0NdLmluZGV4T2YoZS5rZXlDb2RlKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICBjYXNlIFZLX0RPV046XG4gICAgICBjYXNlIFZLX1JJR0hUOlxuICAgICAgICB0aGlzLm5leHRBY3RpdmVMaXN0SXRlbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfVVA6XG4gICAgICBjYXNlIFZLX0xFRlQ6XG4gICAgICAgIHRoaXMucHJldmlvdXNBY3RpdmVMaXN0SXRlbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfU1BBQ0U6XG4gICAgICAgIHRoaXMub3BlbkRyb3BEb3duKCk7XG4gICAgICAgIHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW3RoaXMuYWN0aXZlSXRlbUlkeF0uZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFZLX0VOVEVSOlxuICAgICAgICBjb25zdCBhY3RpdmUgPSB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlblt0aGlzLmFjdGl2ZUl0ZW1JZHhdO1xuICAgICAgICBpZiAoIWFjdGl2ZSlcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZEVsZW1lbnQoYWN0aXZlKTtcbiAgICAgICAgdGhpcy5jbG9zZURyb3BEb3duKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0LmZvY3VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19FU0M6XG4gICAgICAgIHRoaXMuY2xvc2VEcm9wRG93bigpO1xuICAgICAgICB0aGlzLnNlbGVjdC5mb2N1cygpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm47XG4gIH0sXG4gIG5leHRBY3RpdmVMaXN0SXRlbSgpIHtcbiAgICBjb25zdCBuZXh0RWxlbWVudEluZGV4ID0gKHRoaXMuYWN0aXZlSXRlbUlkeCA+PSB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlbi5sZW5ndGggLSAxKSA/IDAgOiAodGhpcy5hY3RpdmVJdGVtSWR4ICsgMSk7XG4gICAgdGhpcy5pdGVtc0xpc3QuY2hpbGRyZW5bbmV4dEVsZW1lbnRJbmRleF0uZm9jdXMoKTtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSBuZXh0RWxlbWVudEluZGV4O1xuXG4gIH0sXG4gIHByZXZpb3VzQWN0aXZlTGlzdEl0ZW0oKSB7XG4gICAgY29uc3QgcHJldkVsZW1lbnRJbmRleCA9ICh0aGlzLmFjdGl2ZUl0ZW1JZHggPT09IDApID8gdGhpcy5pdGVtc0xpc3QuY2hpbGRyZW4ubGVuZ3RoIC0gMSA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggLSAxKTtcbiAgICB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlbltwcmV2RWxlbWVudEluZGV4XS5mb2N1cygpO1xuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IHByZXZFbGVtZW50SW5kZXg7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQWNjZXNzaWJpbGl0eVNlbGVjdDsiLCJjb25zdCBpZGIgID0gcmVxdWlyZSgnaWRiJyk7XHJcbmNvbnN0IEFQUF9EQl9OQU1FID0gJ3Jlc3RhdXJhbnRzLWRiJztcclxuY29uc3QgREJfUkVTVEFVUkFOVFNfVEFCTEUgPSAncmVzdGF1cmFudHMnO1xyXG5jb25zdCBBUFBfREJfVkVSID0gMTtcclxuXHJcbi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICsgJy9yZXN0YXVyYW50cycpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIocmVzdGF1cmFudHMpLnRoZW4oKCkgPT4gcmVzdGF1cmFudHMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICAgIGlmICghcmVzdGF1cmFudHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmV0Y2ggZXJyb3InKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudChpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmVzdGF1cmFudHMvJHtpZH1gKVxyXG4gICAgICAudGhlbihkYXRhID0+IGRhdGEuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50SW50b0luZGV4ZWREYihyZXN0YXVyYW50KS50aGVuKCgpID0+IHJlc3RhdXJhbnQpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYihpZCkudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZldGNoIGVycm9yJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiKCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpXHJcbiAgICAgIC50aGVuKGRiID0+IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuZ2V0QWxsKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEZyb21JbmRleGVkRGIoaWQpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+XHJcbiAgICAgIGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuZ2V0KCtpZCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYihyZXN0YXVyYW50cykge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpLnRoZW4oKCkgPT4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkucHV0KHJlc3RhdXJhbnQpKTtcclxuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgdHgub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLmNsZWFyKCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG9wZW5EYXRhYmFzZSgpIHtcclxuICAgIHJldHVybiBpZGIub3BlbihBUFBfREJfTkFNRSwgQVBQX0RCX1ZFUiwgKHVwZ3JhZGVEYikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgY2FzZSAwIDpcclxuICAgICAgICAgIGNvbnN0IHJlc3RhdXJhbnRTdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSwge2tleVBhdGg6ICdpZCd9KTtcclxuICAgICAgICAgIHJlc3RhdXJhbnRTdG9yZS5jcmVhdGVJbmRleCgnc3RhdHVzJywgJ3N0YXR1cycpO1xyXG4gICAgICAgIC8vIGJyZWFrIG9taXR0ZWRcclxuICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudChpZCkudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIHJldHVybiByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XHJcblxyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuXHJcbiAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcygpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgcmV0dXJuIG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcygpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxyXG4gICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgIHJldHVybiBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQuaWR9X21lZGl1bS5qcGdgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gREJIZWxwZXI7IiwiY29uc3QgREJIZWxwZXIgPSByZXF1aXJlKCcuL2RiaGVscGVyJyk7XHJcbmNvbnN0IEFjY2Vzc2liaWxpdHlTZWxlY3QgPSByZXF1aXJlKCcuL2FjY2Vzc2liaWxpdHktc2VsZWN0Jyk7XHJcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKCcuL3Byb2Nlc3MnKTtcclxuXHJcbmxldCByZXN0YXVyYW50cyxcclxuICBuZWlnaGJvcmhvb2RzLFxyXG4gIGN1aXNpbmVzO1xyXG52YXIgbWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIHByb2Nlc3MucmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKCkudGhlbihuZWlnaGJvcmhvb2RzID0+IHtcclxuICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdmZXRjaE5laWdoYm9yaG9vZHMgZXJyb3InLCBlcnJvcik7XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsTmVpZ2hib3Job29kc0hUTUwobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykge1xyXG4gIGNvbnN0IHNlbGVjdCA9IG5ldyBBY2Nlc3NpYmlsaXR5U2VsZWN0KFxyXG4gICAgJyNuZWlnaGJvcmhvb2RzLXNlbGVjdCcsXHJcbiAgICB7XHJcbiAgICAgIG5hbWU6ICdOZWlnaGJvcmhvb2QnLFxyXG4gICAgICBsYWJlbDogJ05laWdoYm9yaG9vZCcsXHJcbiAgICAgIGluaXRpYWxWYWx1ZToge25hbWU6ICdBbGwgTmVpZ2hib3Job29kcycsIHZhbHVlOiAnYWxsJ30sXHJcbiAgICAgIHZhbHVlczogc2VsZi5uZWlnaGJvcmhvb2RzLFxyXG4gICAgICBvbkNoYW5nZTogdXBkYXRlUmVzdGF1cmFudHNcclxuICAgIH1cclxuICApO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmZXRjaEN1aXNpbmVzKCkge1xyXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKS50aGVuKGN1aXNpbmVzID0+IHtcclxuICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsQ3Vpc2luZXNIVE1MKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykge1xyXG5cclxuICBjb25zdCBzZWxlY3QgPSBuZXcgQWNjZXNzaWJpbGl0eVNlbGVjdChcclxuICAgICcjY3Vpc2luZXMtc2VsZWN0JyxcclxuICAgIHtcclxuICAgICAgbmFtZTogJ0N1aXNpbmVzJyxcclxuICAgICAgbGFiZWw6ICdDdWlzaW5lcycsXHJcbiAgICAgIGluaXRpYWxWYWx1ZToge25hbWU6ICdBbGwgQ3Vpc2luZXMnLCB2YWx1ZTogJ2FsbCd9LFxyXG4gICAgICB2YWx1ZXM6IGN1aXNpbmVzLFxyXG4gICAgICBvbkNoYW5nZTogdXBkYXRlUmVzdGF1cmFudHNcclxuICAgIH1cclxuICApO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICB6b29tOiAxMixcclxuICAgIGNlbnRlcjogbG9jLFxyXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgfSk7XHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlUmVzdGF1cmFudHMoKSB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0LmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3QuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbmZ1bmN0aW9uIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpIHtcclxuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICB1bC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIGlmKHNlbGYubWFya2Vycykge1xyXG4gICAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgfVxyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudHNIVE1MKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGBBbiBpbWFnZSBmcm9tIHRoZSByZXN0YXVyYW50ICR7cmVzdGF1cmFudC5uYW1lfWApO1xyXG4gIGxpLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gIGNvbnN0IGluZm9CbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIGluZm9CbG9jay5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbmZvJztcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgbmFtZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1jYXJkLW5hbWUnO1xyXG4gIG5hbWUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgaW5mb0Jsb2NrLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGluZm9CbG9jay5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBpbmZvQmxvY2suYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XHJcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbmZvQmxvY2suYXBwZW5kKG1vcmUpO1xyXG4gIGxpLmFwcGVuZChpbmZvQmxvY2spO1xyXG5cclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5mdW5jdGlvbiBhZGRNYXJrZXJzVG9NYXAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn1cclxuIiwiLyogUmVnaXN0ZXIgc2VydmljZSB3b3JrZXIgd2l0aCBldmVudHMgKi9cclxuZnVuY3Rpb24gcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCkge1xyXG5cclxuICBpZiAoISdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignc2VydmljZVdvcmtlciBub3QgcmVnaXN0ZXInKTtcclxuICB9XHJcblxyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uIChyZWcpIHtcclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAocmVnLmFjdGl2ZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnVGhlcmUgaXMgYW4gYW4gYWN0aXZlIHNlcnZpY2Ugd29ya2VyJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZy53YWl0aW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCd3YWl0aW5nIDonLCByZWcud2FpdGluZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBpcyB3YWl0aW5nJyk7XHJcbiAgICAgIHVwZGF0ZVNlcnZpY2VXb3JrZXIocmVnLndhaXRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWcuaW5zdGFsbGluZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnaW5zdGFsbGluZyA6ICcsIHJlZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBzdGF0dXMgaXMgaW5zdGFsbGluZycpO1xyXG4gICAgICB0cmFja0luc3RhbGxpbmcocmVnLmluc3RhbGxpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHVwZGF0ZSBmb3VuZCcsIHJlZyk7XHJcbiAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgcmVmcmVzaGluZztcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlmIChyZWZyZXNoaW5nKSByZXR1cm47XHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICByZWZyZXNoaW5nID0gdHJ1ZTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZygnUmVnaXN0cmF0aW9uIGZhaWxlZCB3aXRoICcgKyBlcnJvcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyYWNrSW5zdGFsbGluZyhpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgaWYgKCFpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgICBjb25zb2xlLmxvZygnV29ya2VyIG5vdCBkZWZpbmVkIScpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBpbnN0YWxsaW5nV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgc3RhdGUgd2FzIGNoYW5nZWQgdG8gJyArIGluc3RhbGxpbmdXb3JrZXIuc3RhdGUpO1xyXG4gICAgaWYgKGluc3RhbGxpbmdXb3JrZXIuc3RhdGUgPT09ICdpbnN0YWxsZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlIHdvcmtlciBpbnN0YWxsZWQgYW5kIHdhaXRpbmcgZm9yIGFjdGl2YXRpb24nLCBpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgICAgdXBkYXRlU2VydmljZVdvcmtlcihpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU2VydmljZVdvcmtlcih3b3JrZXIpIHtcclxuICBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcih7YWN0aW9uOiAnc2tpcFdhaXRpbmcnfSwgd29ya2VyKVxyXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlRnJvbVN3KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlRnJvbVN3KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcihtc2csIHdvcmtlcikge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB2YXIgbXNnQ2hhbiA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG5cclxuICAgIC8vIEhhbmRsZXIgZm9yIHJlY2lldmluZyBtZXNzYWdlIHJlcGx5IGZyb20gc2VydmljZSB3b3JrZXJcclxuICAgIG1zZ0NoYW4ucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGlmIChldmVudC5kYXRhLmVycm9yKSB7XHJcbiAgICAgICAgcmVqZWN0KGV2ZW50LmRhdGEuZXJyb3IpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc29sdmUoZXZlbnQuZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gc2VydmljZSB3b3JrZXIgYWxvbmcgd2l0aCBwb3J0IGZvciByZXBseVxyXG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKG1zZywgW21zZ0NoYW4ucG9ydDJdKTtcclxuICB9KTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyLFxyXG59OyJdfQ==
