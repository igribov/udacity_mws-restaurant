"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function o(a,s,u){function c(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return c(a[t][1][e]||e)},i,i.exports,o,a,s,u)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,f,t){!function(){function a(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function o(n,r,i){var o,e=new Promise(function(e,t){a(o=n[r].apply(n,i)).then(e,t)});return e.request=o,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return o(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=o(e,n,arguments)).then(function(e){if(e)return new s(e,t.request)});var e,t})})}function i(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function d(e){this._db=e}e(i,"_index",["name","keyPath","multiEntry","unique"]),t(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(s,"_cursor",["direction","key","primaryKey","value"]),t(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(s.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),a(t._request).then(function(e){if(e)return new s(e,t._request)})})})}),u.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(u,"_store",["name","keyPath","indexNames","autoIncrement"]),t(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(d,"_db",["name","version","objectStoreNames"]),n(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[u,i].forEach(function(e){o in e.prototype&&(e.prototype[o.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[o].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});var h={open:function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new l(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new d(e)})},delete:function(e){return o(indexedDB,"deleteDatabase",[e])}};void 0!==f?(f.exports=h,f.exports.default=f.exports):self.idb=h}()},{}],2:[function(e,t,n){function r(e){var r=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.select=document.querySelector(e),this.select.setAttribute("aria-label",i.label),this.select.setAttribute("tabindex","0"),this.select.setAttribute("role","listbox"),this.select){this.onChange=i.onChange||function(){};var t=document.createElement("span");t.className="custom-select__dropdown",this.selectedValueBlock=document.createElement("span"),this.selectedValueBlock.className="custom-select__selected-item-value",this.selectedValueBlock.setAttribute("data-value",i.initialValue.value),this.selectedValueBlock.innerText=i.initialValue.name||"",t.append(this.selectedValueBlock);var n=document.createElement("span");n.className="custom-select__dropdown-button",n.setAttribute("role","button"),n.setAttribute("aria-label","open dropdown list"),t.append(n),this.select.append(t),this.itemsList=document.createElement("ul"),this.itemsList.className="custom-select__list";var o=i.values||[],a=document.createElement("li");a.setAttribute("tabindex","0"),a.setAttribute("role","option"),a.setAttribute("id",i.name+"_elem"),a.innerHTML=i.initialValue.name,a.setAttribute("data-value",i.initialValue.value),a.addEventListener("click",function(e){r.onListElementClick.bind(r)(e)}),this.itemsList.append(a),this.setSelectedElement(a),o.forEach(function(e,t){var n=document.createElement("li");n.setAttribute("tabindex","0"),n.setAttribute("role","option"),n.setAttribute("id",i.name+"_elem_"+t),n.innerHTML=e,n.setAttribute("data-value",e),n.addEventListener("click",r.onListElementClick.bind(r)),r.itemsList.append(n)}),this.select.append(this.itemsList),this.activeItemIdx=0,n.addEventListener("click",this.toggleDropDown.bind(this)),this.selectedValueBlock.addEventListener("click",this.toggleDropDown.bind(this)),this.select.addEventListener("keydown",this.handleKeyDown.bind(this))}}r.prototype={toggleDropDown:function(){this.itemsList.classList.contains("open")?this.itemsList.classList.remove("open"):this.itemsList.classList.add("open")},openDropDown:function(){this.itemsList.classList.add("open")},closeDropDown:function(){this.itemsList.classList.remove("open")},onListElementClick:function(e){var t=Array.prototype.indexOf.call(this.itemsList.children,e.target);-1!==!t&&(this.activeItemIdx=t,this.setSelectedElement(this.itemsList.children[this.activeItemIdx],!0),this.closeDropDown())},setSelectedElement:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e){var n=e.getAttribute("data-value");this.selectedValueBlock.setAttribute("data-value",n),this.select.setAttribute("data-value",n),this.selectedValueBlock.innerText=e.innerText;var r=!0,i=!1,o=void 0;try{for(var a,s=this.itemsList.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){a.value.setAttribute("aria-selected","")}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}e.setAttribute("aria-selected","true"),this.select.setAttribute("aria-activedescendant",e.id),t&&this.onChange()}},handleKeyDown:function(e){var t=13,n=27,r=32,i=37,o=38,a=39,s=40;if(-1!==[s,o,r,t,i,a,n].indexOf(e.keyCode))switch(e.preventDefault(),e.keyCode){case s:case a:this.nextActiveListItem();break;case o:case i:this.previousActiveListItem();break;case r:this.openDropDown(),this.itemsList.children[this.activeItemIdx].focus();break;case t:var u=this.itemsList.children[this.activeItemIdx];if(!u)break;this.setSelectedElement(u),this.closeDropDown(),this.select.focus();break;case n:this.closeDropDown(),this.select.focus()}},nextActiveListItem:function(){var e=this.activeItemIdx>=this.itemsList.children.length-1?0:this.activeItemIdx+1;this.itemsList.children[e].focus(),this.activeItemIdx=e},previousActiveListItem:function(){var e=0===this.activeItemIdx?this.itemsList.children.length-1:this.activeItemIdx-1;this.itemsList.children[e].focus(),this.activeItemIdx=e}},t.exports=r},{}],3:[function(e,t,n){var r=e("idb"),i="restaurants",o=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(){var t=this;return fetch(o.DATABASE_URL+"/restaurants").then(function(e){return e.json()}).then(function(e){return t.putRestaurantsIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return o.fetchRestaurantsFromIndexedDb().then(function(e){if(e.length)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurantWithReviews",value:function(t){var i=this;return Promise.all([this.fetchRestaurant(t),this.fetchRestaurantReviews(t)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return n.reviews=r,i.putRestaurantIntoIndexedDb(n).then(function(){return n})}).catch(function(e){return o.fetchRestaurantFromIndexedDb(t).then(function(e){if(e)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(e){return fetch(o.DATABASE_URL+"/restaurants/"+e).then(function(e){return e.json()})}},{key:"fetchRestaurantReviews",value:function(e){return fetch(o.DATABASE_URL+"/reviews/?restaurant_id="+e).then(function(e){return e.json()})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return o.openDatabase().then(function(e){return e.transaction(i).objectStore(i).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(t){return o.openDatabase().then(function(e){return e.transaction(i).objectStore(i).get(+t)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return o.clearRestaurantsInIndexedDb().then(function(){return o.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return n.forEach(function(e){return t.objectStore(i).put(e)}),t.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return o.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return t.objectStore(i).put(n),t.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return o.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return t.objectStore(i).clear(),t.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore(i,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(e){return o.fetchRestaurantWithReviews(e)}},{key:"fetchRestaurantByCuisine",value:function(t,e){o.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return o.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return o.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoodsAndCuisines",value:function(){return o.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood}),i=n.map(function(e,t){return n[t].cuisine_type});return{neighborhoods:r.filter(function(e,t){return r.indexOf(e)==t}),cuisines:i.filter(function(e,t){return i.indexOf(e)==t}),restaurants:n}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"small";return"/img/"+e.id+"_"+t+".jpg"}},{key:"imageSrcSetForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),o}();t.exports=o},{idb:1}],4:[function(e,t,n){function a(e,t,n){return e.length===t.length&&"function"==typeof n}t.exports={zip:function(e,t,n){if(!a(e,t,n))return!1;for(var r=0;r<e.length;r++)n(e[r],t[r])},zipReduce:function(e,t,n,r){if(!a(e,t,n))return!1;for(var i=r,o=0;o<e.length;o++)i=n(e[o],t[o],i);return i}}},{}],5:[function(e,t,n){var c=e("./dbhelper"),i=e("./accessibility-select"),r=e("./process"),o=e("./helpers"),l=(o.zip,o.zipReduce),a=!1,s=function(){a||(a=!0);var e=document.querySelectorAll("#restaurants-list li.hidden");Array.prototype.forEach.call(e,function(e){return e.classList.remove("hidden")})};function u(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.getAttribute("data-value"),r=t.getAttribute("data-value");c.fetchRestaurantByCuisineAndNeighborhood(n,r).then(function(e){!function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.setMap(null)});self.markers=[],self.restaurants=e}(e),d(e)}).catch(function(e){console.error(e)})}function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,n=document.getElementById("restaurants-list");e.forEach(function(e,t){n.append(function(e,t){var n=document.createElement("li");n.setAttribute("tabindex",0),3<t&&(n.className="hidden");var r=function(e,t,n){var r=[c.imageUrlForRestaurant(n,"small"),c.imageUrlForRestaurant(n,"medium"),c.imageUrlForRestaurant(n,"large"),c.imageUrlForRestaurant(n,"small")],i=document.createElement("picture");i.className="restaurant-img";var o=document.createElement("img");return o.className="restaurant-img",o.setAttribute("src",e),o.setAttribute("alt",t),l(r,["(max-width: 400px)","(min-width: 701px) and (max-width: 1000px)","(min-width: 500px) and (max-width: 700px)","(mim-width: 1001px)"],function(e,t,n){var r=document.createElement("source");return r.setAttribute("media",t),r.setAttribute("srcset",e),[].concat(_toConsumableArray(n),[r])},[]).forEach(function(e){i.append(e)}),i.append(o),i}(c.imageUrlForRestaurant(e),"An image from the restaurant "+e.name,e);n.append(r);var i=document.createElement("div");i.className="restaurant-info";var o=document.createElement("h2");o.className="restaurant-card-name",o.setAttribute("tabindex","0"),o.innerHTML=e.name,i.append(o);var a=document.createElement("p");a.setAttribute("tabindex",0),a.innerHTML=e.neighborhood,i.append(a);var s=document.createElement("p");s.setAttribute("tabindex",0),s.innerHTML=e.address,i.append(s);var u=document.createElement("a");return u.innerHTML="View Details",u.href=c.urlForRestaurant(e),i.append(u),n.append(i),n}(e,t))});setTimeout(function(){return function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=c.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers||(self.markers=[]),self.markers.push(t)})}(e)},500)}document.addEventListener("DOMContentLoaded",function(){r.registerServiceWorker(),c.fetchNeighborhoodsAndCuisines().then(function(e){var t=e.restaurants,n=e.neighborhoods,r=e.cuisines;return function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,new i("#neighborhoods-select",{name:"Neighborhood",label:"Neighborhood",initialValue:{name:"All Neighborhoods",value:"all"},values:self.neighborhoods,onChange:u})}(self.neighborhoods=n),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines;new i("#cuisines-select",{name:"Cuisines",label:"Cuisines",initialValue:{name:"All Cuisines",value:"all"},values:e,onChange:u})}(self.cuisines=r),t}).catch(function(e){console.error(e)}).then(function(e){d(e)})}),document.querySelector("#map-actions .toggle-map").onclick=function(){var e=document.getElementById("map");"none"===e.style.display?(this.setAttribute("aria-label","Close Google Map"),e.style.display="block"):(this.setAttribute("aria-label","Open Google Map"),e.style.display="none")},window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),window.addEventListener("scroll",s),setTimeout(function(){document.getElementById("map").querySelector("iframe").setAttribute("title","Google map")},200)}},{"./accessibility-select":2,"./dbhelper":3,"./helpers":4,"./process":6}],6:[function(e,t,n){function r(e){e?e.addEventListener("statechange",function(){console.log("ServiceWorker state was changed to "+e.state),"installed"===e.state&&(console.log("Service worker installed and waiting for activation",e),i(e))}):console.log("Worker not defined!")}function i(e){var r,i;(r={action:"skipWaiting"},i=e,new Promise(function(t,n){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?n(e.data.error):t(e.data)},i.postMessage(r,[e.port2])})).then(function(e){console.log(e)})}t.exports={registerServiceWorker:function(){if(!1 in navigator)throw new Error("serviceWorker not register");navigator.serviceWorker.register("/sw.js").then(function(e){var t;navigator.serviceWorker.controller&&(e.active&&console.log("There is an active service worker"),e.waiting&&(console.log("waiting :",e.waiting),console.log("service worker is waiting"),i(e.waiting)),e.installing&&(console.log("installing : ",e),console.log("service worker status is installing"),r(e.installing)),e.addEventListener("updatefound",function(){console.log("service worker update found",e),r(e.installing)}),navigator.serviceWorker.addEventListener("controllerchange",function(){t||setTimeout(function(){window.location.reload(),t=!0},1e3)}))}).catch(function(e){console.log("Registration failed with "+e)})}}},{}]},{},[5]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvYWNjZXNzaWJpbGl0eS1zZWxlY3QuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvaGVscGVycy5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3Byb2Nlc3MuanMiXSwibmFtZXMiOlsicmVzdWx0IiwiZXJyb3IiLCJyZXF1ZXN0IiwiYXJncyIsInJlamVjdCIsInAiLCJwcm9wIiwidmFsIiwiYXJndW1lbnRzIiwiaW5kZXgiLCJjdXJzb3IiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwicmVzb2x2ZSIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwidGhpcyIsIl9yZXF1ZXN0IiwiYXJyIiwiX2luZGV4IiwidmFsdWUiLCJjb250aW51ZSIsIml0ZW1zIiwidmVyc2lvbiIsIm5hbWUiLCJleHAiLCJleHBvcnRzIiwiQWNjZXNzaWJpbGl0eVNlbGVjdCIsInNlbGVjdG9yIiwiX3RoaXMiLCJvcHRpb25zIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwic2VsZWN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2V0QXR0cmlidXRlIiwibGFiZWwiLCJvbkNoYW5nZSIsImRyb3Bkb3duIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInNlbGVjdGVkVmFsdWVCbG9jayIsImluaXRpYWxWYWx1ZSIsImlubmVyVGV4dCIsImFwcGVuZCIsImRyb3Bkb3duQnV0dG9uIiwiaXRlbXNMaXN0IiwibmVpZ2hib3Job29kcyIsInZhbHVlcyIsIm9wdGlvbiIsImlubmVySFRNTCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwib25MaXN0RWxlbWVudENsaWNrIiwiYmluZCIsInNldFNlbGVjdGVkRWxlbWVudCIsImZvckVhY2giLCJuZWlnaGJvcmhvb2QiLCJhY3RpdmVJdGVtSWR4IiwidG9nZ2xlRHJvcERvd24iLCJoYW5kbGVLZXlEb3duIiwicHJvdG90eXBlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJyZW1vdmUiLCJhZGQiLCJzZWxlY3RlZEVsZW1lbnRJbmRleCIsIkFycmF5IiwiaW5kZXhPZiIsImNhbGwiLCJjaGlsZHJlbiIsInRhcmdldCIsImNsb3NlRHJvcERvd24iLCJlbGVtZW50IiwidHJpZ2dlckV2ZW50IiwiZ2V0QXR0cmlidXRlIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJTeW1ib2wiLCJpdGVyYXRvciIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24iLCJuZXh0IiwiZG9uZSIsImlkIiwiVktfRU5URVIiLCJWS19FU0MiLCJWS19TUEFDRSIsIlZLX0xFRlQiLCJWS19VUCIsIlZLX1JJR0hUIiwiVktfRE9XTiIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsIm5leHRBY3RpdmVMaXN0SXRlbSIsInByZXZpb3VzQWN0aXZlTGlzdEl0ZW0iLCJvcGVuRHJvcERvd24iLCJmb2N1cyIsImFjdGl2ZSIsIm5leHRFbGVtZW50SW5kZXgiLCJwcmV2RWxlbWVudEluZGV4IiwibW9kdWxlIiwiaWRiIiwicmVxdWlyZSIsIkRCX1JFU1RBVVJBTlRTX1RBQkxFIiwiREJIZWxwZXIiLCJfdGhpczIiLCJEQVRBQkFTRV9VUkwiLCJ0aGVuIiwiZGF0YSIsImpzb24iLCJyZXN0YXVyYW50cyIsInB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYiIsImNhdGNoIiwiZXJyIiwiZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIiLCJFcnJvciIsIl90aGlzMyIsImFsbCIsImZldGNoUmVzdGF1cmFudCIsImZldGNoUmVzdGF1cmFudFJldmlld3MiLCJfcmVmIiwiX3JlZjIiLCJfc2xpY2VkVG9BcnJheSIsInJlc3RhdXJhbnQiLCJyZXZpZXdzIiwicHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIiLCJmZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiIiwicmVzdGF1cmFudElkIiwib3BlbkRhdGFiYXNlIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJnZXQiLCJjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIiLCJ0eCIsInB1dCIsImNvbXBsZXRlIiwiY2xlYXIiLCJvcGVuIiwidXBncmFkZURiIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwiY3JlYXRlSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRXaXRoUmV2aWV3cyIsImN1aXNpbmUiLCJjYWxsYmFjayIsImZldGNoUmVzdGF1cmFudHMiLCJmaWx0ZXIiLCJyIiwiY3Vpc2luZV90eXBlIiwicmVzdWx0cyIsIm1hcCIsInYiLCJpIiwiY3Vpc2luZXMiLCJzaXplIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJsYXRsbmciLCJ1cmxGb3JSZXN0YXVyYW50IiwiQW5pbWF0aW9uIiwiRFJPUCIsImNoZWNrQXJncyIsImFycjEiLCJhcnIyIiwiY2FsbGFibGUiLCJpbml0UmVzdWx0IiwicHJvY2VzcyIsInppcFJlZHVjZSIsIl9yZXF1aXJlIiwiemlwIiwic2Nyb2xsZWQiLCJzaG93SGlkZGVuUmVzdGF1cmFudHMiLCJoaWRkZW5JdGVtcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiblNlbGVjdCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInNlbGYiLCJtYXJrZXJzIiwibSIsInNldE1hcCIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJ1bCIsImxpIiwicGljdHVyZSIsImltZ1VybCIsImFsdCIsImltZ1VybHMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJpbWFnZSIsInNyY3NldCIsIm1lZGlhIiwic291cmNlIiwiY29uY2F0IiwiX3RvQ29uc3VtYWJsZUFycmF5IiwiY3JlYXRlUmVzcG9uc2l2ZUltYWdlIiwiaW5mb0Jsb2NrIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZXZlbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwidXJsIiwicHVzaCIsImFkZE1hcmtlcnNUb01hcCIsInJlZ2lzdGVyU2VydmljZVdvcmtlciIsImZldGNoTmVpZ2hib3Job29kc0FuZEN1aXNpbmVzIiwiX3JlZjMiLCJvbmNsaWNrIiwic3R5bGUiLCJkaXNwbGF5Iiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInRyYWNrSW5zdGFsbGluZyIsImluc3RhbGxpbmdXb3JrZXIiLCJsb2ciLCJzdGF0ZSIsInVwZGF0ZVNlcnZpY2VXb3JrZXIiLCJ3b3JrZXIiLCJtc2ciLCJhY3Rpb24iLCJQcm9taXNlIiwibXNnQ2hhbiIsIk1lc3NhZ2VDaGFubmVsIiwicG9ydDEiLCJvbm1lc3NhZ2UiLCJwb3N0TWVzc2FnZSIsInBvcnQyIiwicmVzcG9uc2VGcm9tU3ciLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWciLCJyZWZyZXNoaW5nIiwiY29udHJvbGxlciIsIndhaXRpbmciLCJpbnN0YWxsaW5nIiwicmVsb2FkIl0sIm1hcHBpbmdzIjoiNjBDQUFBLDJHQ1dBQSxrQ0FJQUMsZ0NBTUFDLCtDQUVBQyxXQUNBQyxzQkFHQUYsRUFDQUcsNkdBZUFDLCtCQUdBQyxpSEFVQUMsc0lBU0FBLGdJQVNBQSxtREF2Q0FOLGlEQTZDQU8sK0JBd0JBQyxnQkFDQVIsNEJBZ0NBUyx5QkF3Q0FDLGtFQUdBQyw4QkFHQVosaUNBR0FBLHFDQW1CQWEsa0JBQ0FDLHlCQUNBQywwQkFtQkFGLGVBL0lBLENBQ0EsT0FDQSxVQUNBLGFBQ0EsaUNBR0EsQ0FDQSxNQUNBLFNBQ0EsU0FDQSxhQUNBLGdDQUdBLENBQ0EsYUFDQSxnQ0FRQSxDQUNBLFlBQ0EsTUFDQSxhQUNBLGtDQUdBLENBQ0EsU0FDQSxzSUFPQUcsT0FDQVQsdUZBRUFMLHdEQUdBZSw0R0FXQVYsMkZBSUFBLDBCQUdBLENBQ0EsT0FDQSxVQUNBLGFBQ0Es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QUFBNkwsc0JBbkZBLGVBRU0sS0FBSnlCLGdCQUNRLElBQUE1SCxNQUFOLHdDQUdGNkgsY0FBQUMsU0FBQSxVQUFBdEksS0FBZ0QsU0FBQXVJLE9BeUI5Q0MsRUF4QktKLFVBQUFDLGNBQUxJLGFBR0lGLEVBQUpqSixnQkFDRWdJLElBQUEscUNBR0VpQixFQUFKRyxrQkFDRXBCLElBQUEsWUFBeUJpQixFQUF6QkcsaUJBQ0FwQixJQUFBLCtCQUNvQmlCLEVBQXBCRyxVQUdFSCxFQUFKSSxxQkFDRXJCLElBQUEsZ0JBQUFpQixXQUNBakIsSUFBQSx5Q0FDZ0JpQixFQUFoQkksZUFHRm5NLGlCQUFBLGNBQW9DLG1CQUNsQzhLLElBQUEsOEJBQUFpQixLQUNnQkEsRUFBaEJJLHdCQUlGTixjQUFBN0wsaUJBQUEsbUJBQTZELFdBQzNEZ00sY0FDVyxrQkFDVGpDLFNBQUFxQyxZQUNBLEdBRkYsVUE1Qkp2SSxNQWtDUyxTQUFBakgsV0FDUGtPLElBQVksNEJBQVpsTyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsIlxyXG5mdW5jdGlvbiBBY2Nlc3NpYmlsaXR5U2VsZWN0KHNlbGVjdG9yLCBvcHRpb25zID0ge30pIHtcclxuICB0aGlzLnNlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG4gIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIG9wdGlvbnMubGFiZWwpO1xyXG4gIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG4gIHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgncm9sZScsICdsaXN0Ym94Jyk7XHJcblxyXG4gIGlmICghdGhpcy5zZWxlY3QpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRoaXMub25DaGFuZ2UgPSBvcHRpb25zLm9uQ2hhbmdlIHx8ICgoKSA9PiB7fSk7XHJcblxyXG4gIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gIGRyb3Bkb3duLmNsYXNzTmFtZSA9ICdjdXN0b20tc2VsZWN0X19kcm9wZG93bic7XHJcblxyXG4gIHRoaXMuc2VsZWN0ZWRWYWx1ZUJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gIHRoaXMuc2VsZWN0ZWRWYWx1ZUJsb2NrLmNsYXNzTmFtZSA9ICdjdXN0b20tc2VsZWN0X19zZWxlY3RlZC1pdGVtLXZhbHVlJztcclxuICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jay5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBvcHRpb25zLmluaXRpYWxWYWx1ZS52YWx1ZSk7XHJcbiAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suaW5uZXJUZXh0ID0gb3B0aW9ucy5pbml0aWFsVmFsdWUubmFtZSB8fCAnJztcclxuICBkcm9wZG93bi5hcHBlbmQodGhpcy5zZWxlY3RlZFZhbHVlQmxvY2spO1xyXG5cclxuICBjb25zdCBkcm9wZG93bkJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICBkcm9wZG93bkJ1dHRvbi5jbGFzc05hbWUgPSAnY3VzdG9tLXNlbGVjdF9fZHJvcGRvd24tYnV0dG9uJztcclxuICBkcm9wZG93bkJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XHJcbiAgZHJvcGRvd25CdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ29wZW4gZHJvcGRvd24gbGlzdCcpO1xyXG5cclxuICBkcm9wZG93bi5hcHBlbmQoZHJvcGRvd25CdXR0b24pO1xyXG4gIHRoaXMuc2VsZWN0LmFwcGVuZChkcm9wZG93bik7XHJcblxyXG4gIHRoaXMuaXRlbXNMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcclxuICB0aGlzLml0ZW1zTGlzdC5jbGFzc05hbWUgPSAnY3VzdG9tLXNlbGVjdF9fbGlzdCc7XHJcblxyXG4gIGNvbnN0IG5laWdoYm9yaG9vZHMgPSBvcHRpb25zLnZhbHVlcyB8fCBbXTtcclxuXHJcbiAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBvcHRpb24uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgb3B0aW9uLnNldEF0dHJpYnV0ZSgncm9sZScsICdvcHRpb24nKTtcclxuICBvcHRpb24uc2V0QXR0cmlidXRlKCdpZCcsIG9wdGlvbnMubmFtZSArICdfZWxlbScpO1xyXG4gIG9wdGlvbi5pbm5lckhUTUwgPSBvcHRpb25zLmluaXRpYWxWYWx1ZS5uYW1lO1xyXG4gIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBvcHRpb25zLmluaXRpYWxWYWx1ZS52YWx1ZSk7XHJcbiAgb3B0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgIHRoaXMub25MaXN0RWxlbWVudENsaWNrLmJpbmQodGhpcykoZSk7XHJcbiAgfSk7XHJcbiAgdGhpcy5pdGVtc0xpc3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgdGhpcy5zZXRTZWxlY3RlZEVsZW1lbnQob3B0aW9uKTtcclxuXHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKChuZWlnaGJvcmhvb2QsIGluZGV4KSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgncm9sZScsICdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgb3B0aW9ucy5uYW1lICsgJ19lbGVtXycgKyBpbmRleCk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScsIG5laWdoYm9yaG9vZCk7XHJcbiAgICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uTGlzdEVsZW1lbnRDbGljay5iaW5kKHRoaXMpKTtcclxuICAgIHRoaXMuaXRlbXNMaXN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG5cclxuICB0aGlzLnNlbGVjdC5hcHBlbmQodGhpcy5pdGVtc0xpc3QpO1xyXG5cclxuICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSAwO1xyXG5cclxuICBkcm9wZG93bkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMudG9nZ2xlRHJvcERvd24uYmluZCh0aGlzKSk7XHJcbiAgdGhpcy5zZWxlY3RlZFZhbHVlQmxvY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnRvZ2dsZURyb3BEb3duLmJpbmQodGhpcykpO1xyXG5cclxuICB0aGlzLnNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVLZXlEb3duLmJpbmQodGhpcykpO1xyXG59XHJcblxyXG5BY2Nlc3NpYmlsaXR5U2VsZWN0LnByb3RvdHlwZSA9IHtcclxuXHJcbiAgdG9nZ2xlRHJvcERvd24oKSB7XHJcbiAgICBpZiAodGhpcy5pdGVtc0xpc3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcGVuJykpIHtcclxuICAgICAgdGhpcy5pdGVtc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pdGVtc0xpc3QuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIG9wZW5Ecm9wRG93bigpIHtcclxuICAgIHRoaXMuaXRlbXNMaXN0LmNsYXNzTGlzdC5hZGQoJ29wZW4nKTtcclxuICB9LFxyXG5cclxuICBjbG9zZURyb3BEb3duKCkge1xyXG4gICAgdGhpcy5pdGVtc0xpc3QuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xyXG4gIH0sXHJcblxyXG4gIG9uTGlzdEVsZW1lbnRDbGljayhlKSB7XHJcbiAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnRJbmRleCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwodGhpcy5pdGVtc0xpc3QuY2hpbGRyZW4sIGUudGFyZ2V0KTtcclxuICAgIGlmICghc2VsZWN0ZWRFbGVtZW50SW5kZXggPT09IC0xKVxyXG4gICAgICByZXR1cm47XHJcblxyXG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gc2VsZWN0ZWRFbGVtZW50SW5kZXg7XHJcbiAgICB0aGlzLnNldFNlbGVjdGVkRWxlbWVudCh0aGlzLml0ZW1zTGlzdC5jaGlsZHJlblt0aGlzLmFjdGl2ZUl0ZW1JZHhdLCB0cnVlKTtcclxuICAgIHRoaXMuY2xvc2VEcm9wRG93bigpO1xyXG4gIH0sXHJcblxyXG4gIHNldFNlbGVjdGVkRWxlbWVudChlbGVtZW50LCB0cmlnZ2VyRXZlbnQgPSBmYWxzZSkge1xyXG4gICAgaWYgKCFlbGVtZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB2YWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7XHJcbiAgICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jay5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCB2YWx1ZSk7XHJcbiAgICB0aGlzLnNlbGVjdC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCB2YWx1ZSk7XHJcbiAgICB0aGlzLnNlbGVjdGVkVmFsdWVCbG9jay5pbm5lclRleHQgPSBlbGVtZW50LmlubmVyVGV4dDtcclxuICAgIGZvciAoY29uc3QgZWwgb2YgdGhpcy5pdGVtc0xpc3QuY2hpbGRyZW4pIHtcclxuICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJycpO1xyXG4gICAgfVxyXG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCAndHJ1ZScpO1xyXG4gICAgdGhpcy5zZWxlY3Quc2V0QXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnLCBlbGVtZW50LmlkKTtcclxuICAgIGlmICh0cmlnZ2VyRXZlbnQpIHtcclxuICAgICAgdGhpcy5vbkNoYW5nZSgpO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGhhbmRsZUtleURvd24oZSkge1xyXG4gICAgLy8gRGVmaW5lIHZhbHVlcyBmb3Iga2V5Y29kZXNcclxuICAgIGNvbnN0IFZLX0VOVEVSID0gMTM7XHJcbiAgICBjb25zdCBWS19FU0MgPSAyNztcclxuICAgIGNvbnN0IFZLX1NQQUNFID0gMzI7XHJcbiAgICBjb25zdCBWS19MRUZUID0gMzc7XHJcbiAgICBjb25zdCBWS19VUCA9IDM4O1xyXG4gICAgY29uc3QgVktfUklHSFQgPSAzOTtcclxuICAgIGNvbnN0IFZLX0RPV04gPSA0MDtcclxuXHJcbiAgICBpZiAoW1ZLX0RPV04sIFZLX1VQLCBWS19TUEFDRSwgVktfRU5URVIsIFZLX0xFRlQsIFZLX1JJR0hULCBWS19FU0NdLmluZGV4T2YoZS5rZXlDb2RlKSA9PT0gLTEpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgY2FzZSBWS19ET1dOOlxyXG4gICAgICBjYXNlIFZLX1JJR0hUOlxyXG4gICAgICAgIHRoaXMubmV4dEFjdGl2ZUxpc3RJdGVtKCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgVktfVVA6XHJcbiAgICAgIGNhc2UgVktfTEVGVDpcclxuICAgICAgICB0aGlzLnByZXZpb3VzQWN0aXZlTGlzdEl0ZW0oKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBWS19TUEFDRTpcclxuICAgICAgICB0aGlzLm9wZW5Ecm9wRG93bigpO1xyXG4gICAgICAgIHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW3RoaXMuYWN0aXZlSXRlbUlkeF0uZm9jdXMoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBWS19FTlRFUjpcclxuICAgICAgICBjb25zdCBhY3RpdmUgPSB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlblt0aGlzLmFjdGl2ZUl0ZW1JZHhdO1xyXG4gICAgICAgIGlmICghYWN0aXZlKVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZEVsZW1lbnQoYWN0aXZlKTtcclxuICAgICAgICB0aGlzLmNsb3NlRHJvcERvd24oKTtcclxuICAgICAgICB0aGlzLnNlbGVjdC5mb2N1cygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFZLX0VTQzpcclxuICAgICAgICB0aGlzLmNsb3NlRHJvcERvd24oKTtcclxuICAgICAgICB0aGlzLnNlbGVjdC5mb2N1cygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybjtcclxuICB9LFxyXG4gIG5leHRBY3RpdmVMaXN0SXRlbSgpIHtcclxuICAgIGNvbnN0IG5leHRFbGVtZW50SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSWR4ID49IHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuLmxlbmd0aCAtIDEpID8gMCA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggKyAxKTtcclxuICAgIHRoaXMuaXRlbXNMaXN0LmNoaWxkcmVuW25leHRFbGVtZW50SW5kZXhdLmZvY3VzKCk7XHJcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSBuZXh0RWxlbWVudEluZGV4O1xyXG5cclxuICB9LFxyXG4gIHByZXZpb3VzQWN0aXZlTGlzdEl0ZW0oKSB7XHJcbiAgICBjb25zdCBwcmV2RWxlbWVudEluZGV4ID0gKHRoaXMuYWN0aXZlSXRlbUlkeCA9PT0gMCkgPyB0aGlzLml0ZW1zTGlzdC5jaGlsZHJlbi5sZW5ndGggLSAxIDogKHRoaXMuYWN0aXZlSXRlbUlkeCAtIDEpO1xyXG4gICAgdGhpcy5pdGVtc0xpc3QuY2hpbGRyZW5bcHJldkVsZW1lbnRJbmRleF0uZm9jdXMoKTtcclxuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IHByZXZFbGVtZW50SW5kZXg7XHJcbiAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBBY2Nlc3NpYmlsaXR5U2VsZWN0OyIsImNvbnN0IGlkYiA9IHJlcXVpcmUoJ2lkYicpO1xyXG5jb25zdCBBUFBfREJfTkFNRSA9ICdyZXN0YXVyYW50cy1kYic7XHJcbmNvbnN0IERCX1JFU1RBVVJBTlRTX1RBQkxFID0gJ3Jlc3RhdXJhbnRzJztcclxuY29uc3QgQVBQX0RCX1ZFUiA9IDE7XHJcblxyXG4vKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCArICcvcmVzdGF1cmFudHMnKVxyXG4gICAgICAudGhlbihkYXRhID0+IGRhdGEuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnRzKS50aGVuKCgpID0+IHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgICAgICBpZiAoIXJlc3RhdXJhbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZldGNoIGVycm9yJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnQgYnkgaWQgd2l0aCByZXZpZXdzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRXaXRoUmV2aWV3cyhpZCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtcclxuICAgICAgdGhpcy5mZXRjaFJlc3RhdXJhbnQoaWQpLFxyXG4gICAgICB0aGlzLmZldGNoUmVzdGF1cmFudFJldmlld3MoaWQpXHJcbiAgICBdKS50aGVuKChbcmVzdGF1cmFudCwgcmV2aWV3c10pID0+IHtcclxuICAgICAgcmVzdGF1cmFudC5yZXZpZXdzID0gcmV2aWV3cztcclxuICAgICAgcmV0dXJuIHRoaXMucHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIocmVzdGF1cmFudCkudGhlbigoKSA9PiByZXN0YXVyYW50KTtcclxuICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiKGlkKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGZXRjaCBlcnJvcicpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50KGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50cy8ke2lkfWApXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudFJldmlld3MocmVzdGF1cmFudElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7cmVzdGF1cmFudElkfWApXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiKCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpXHJcbiAgICAgIC50aGVuKGRiID0+IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuZ2V0QWxsKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEZyb21JbmRleGVkRGIoaWQpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+XHJcbiAgICAgIGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuZ2V0KCtpZCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYihyZXN0YXVyYW50cykge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpLnRoZW4oKCkgPT4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkucHV0KHJlc3RhdXJhbnQpKTtcclxuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgdHgub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLmNsZWFyKCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG9wZW5EYXRhYmFzZSgpIHtcclxuICAgIHJldHVybiBpZGIub3BlbihBUFBfREJfTkFNRSwgQVBQX0RCX1ZFUiwgKHVwZ3JhZGVEYikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgY2FzZSAwIDpcclxuICAgICAgICAgIGNvbnN0IHJlc3RhdXJhbnRTdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSwge2tleVBhdGg6ICdpZCd9KTtcclxuICAgICAgICAgIHJlc3RhdXJhbnRTdG9yZS5jcmVhdGVJbmRleCgnc3RhdHVzJywgJ3N0YXR1cycpO1xyXG4gICAgICAgIC8vIGJyZWFrIG9taXR0ZWRcclxuICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXdzKGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIHJldHVybiByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG5cclxuICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzQW5kQ3Vpc2luZXMoKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XHJcbiAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcblxyXG4gICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBuZWlnaGJvcmhvb2RzOiBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpLFxyXG4gICAgICAgIGN1aXNpbmVzOiBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSksXHJcbiAgICAgICAgcmVzdGF1cmFudHMsXHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzaXplID0gJ3NtYWxsJykge1xyXG4gICAgcmV0dXJuIGAvaW1nLyR7cmVzdGF1cmFudC5pZH1fJHtzaXplfS5qcGdgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgICAgfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBEQkhlbHBlcjsiLCJtb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHppcDogKGFycjEsIGFycjIsIGNhbGxhYmxlKSA9PiB7XHJcbiAgICAgICAgaWYgKCFjaGVja0FyZ3MoYXJyMSwgYXJyMiwgY2FsbGFibGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIxLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNhbGxhYmxlKGFycjFbaV0sIGFycjJbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB6aXBSZWR1Y2U6IChhcnIxLCBhcnIyLCBjYWxsYWJsZSwgaW5pdFJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGlmICghY2hlY2tBcmdzKGFycjEsIGFycjIsIGNhbGxhYmxlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCByZXN1bHQgPSBpbml0UmVzdWx0O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyMS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBjYWxsYWJsZShhcnIxW2ldLCBhcnIyW2ldLCByZXN1bHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG59O1xyXG5cclxuZnVuY3Rpb24gY2hlY2tBcmdzKGFycjEsIGFycjIsIGNhbGxhYmxlKSB7XHJcbiAgICByZXR1cm4gYXJyMS5sZW5ndGggPT09IGFycjIubGVuZ3RoICYmIHR5cGVvZiBjYWxsYWJsZSA9PT0gJ2Z1bmN0aW9uJztcclxufSIsImNvbnN0IERCSGVscGVyID0gcmVxdWlyZSgnLi9kYmhlbHBlcicpO1xyXG5jb25zdCBBY2Nlc3NpYmlsaXR5U2VsZWN0ID0gcmVxdWlyZSgnLi9hY2Nlc3NpYmlsaXR5LXNlbGVjdCcpO1xyXG5jb25zdCBwcm9jZXNzID0gcmVxdWlyZSgnLi9wcm9jZXNzJyk7XHJcbmNvbnN0IHsgemlwLCB6aXBSZWR1Y2UgfSA9IHJlcXVpcmUoJy4vaGVscGVycycpO1xyXG5cclxubGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXM7XHJcbnZhciBtYXA7XHJcbnZhciBtYXJrZXJzID0gW107XHJcbnZhciBzY3JvbGxlZCA9IGZhbHNlO1xyXG5cclxuY29uc3Qgc2hvd0hpZGRlblJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGlmICghc2Nyb2xsZWQpIHtcclxuICAgIHNjcm9sbGVkID0gdHJ1ZTtcclxuICB9XHJcbiAgY29uc3QgaGlkZGVuSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjcmVzdGF1cmFudHMtbGlzdCBsaS5oaWRkZW4nKTtcclxuICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGhpZGRlbkl0ZW1zLCBlbCA9PiBlbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKSk7XHJcbn07XHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgcHJvY2Vzcy5yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuICBmZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICBmaWxsUmVzdGF1cmFudHNIVE1MKHJlc3RhdXJhbnRzKTtcclxuICB9KVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU1hcCgpIHtcclxuICBjb25zdCBtYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyk7XHJcbiAgaWYgKG1hcC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpe1xyXG4gICAgdGhpcy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQ2xvc2UgR29vZ2xlIE1hcCcpO1xyXG4gICAgbWFwLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snXHJcbiAgfSBlbHNlIHtcclxuICAgIHRoaXMuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ09wZW4gR29vZ2xlIE1hcCcpO1xyXG4gICAgbWFwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcclxuICB9XHJcbn1cclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYXAtYWN0aW9ucyAudG9nZ2xlLW1hcCcpLm9uY2xpY2sgPSB0b2dnbGVNYXA7XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxOZWlnaGJvcmhvb2RzSFRNTChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gbmV3IEFjY2Vzc2liaWxpdHlTZWxlY3QoXHJcbiAgICAnI25laWdoYm9yaG9vZHMtc2VsZWN0JyxcclxuICAgIHtcclxuICAgICAgbmFtZTogJ05laWdoYm9yaG9vZCcsXHJcbiAgICAgIGxhYmVsOiAnTmVpZ2hib3Job29kJyxcclxuICAgICAgaW5pdGlhbFZhbHVlOiB7bmFtZTogJ0FsbCBOZWlnaGJvcmhvb2RzJywgdmFsdWU6ICdhbGwnfSxcclxuICAgICAgdmFsdWVzOiBzZWxmLm5laWdoYm9yaG9vZHMsXHJcbiAgICAgIG9uQ2hhbmdlOiB1cGRhdGVSZXN0YXVyYW50c1xyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZldGNoTmVpZ2hib3Job29kc0FuZEN1aXNpbmVzKCkge1xyXG4gIHJldHVybiBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpLnRoZW4oKHsgcmVzdGF1cmFudHMsIG5laWdoYm9yaG9vZHMsIGN1aXNpbmVzIH0pID0+IHtcclxuXHJcbiAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKG5laWdoYm9yaG9vZHMpO1xyXG5cclxuICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgIGZpbGxDdWlzaW5lc0hUTUwoY3Vpc2luZXMpO1xyXG5cclxuICAgIHJldHVybiByZXN0YXVyYW50cztcclxuXHJcbiAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxDdWlzaW5lc0hUTUwoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSB7XHJcblxyXG4gIGNvbnN0IHNlbGVjdCA9IG5ldyBBY2Nlc3NpYmlsaXR5U2VsZWN0KFxyXG4gICAgJyNjdWlzaW5lcy1zZWxlY3QnLFxyXG4gICAge1xyXG4gICAgICBuYW1lOiAnQ3Vpc2luZXMnLFxyXG4gICAgICBsYWJlbDogJ0N1aXNpbmVzJyxcclxuICAgICAgaW5pdGlhbFZhbHVlOiB7bmFtZTogJ0FsbCBDdWlzaW5lcycsIHZhbHVlOiAnYWxsJ30sXHJcbiAgICAgIHZhbHVlczogY3Vpc2luZXMsXHJcbiAgICAgIG9uQ2hhbmdlOiB1cGRhdGVSZXN0YXVyYW50c1xyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBsZXQgbG9jID0ge1xyXG4gICAgbGF0OiA0MC43MjIyMTYsXHJcbiAgICBsbmc6IC03My45ODc1MDFcclxuICB9O1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHNob3dIaWRkZW5SZXN0YXVyYW50cyk7XHJcblxyXG4gIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJykucXVlcnlTZWxlY3RvcignaWZyYW1lJykuc2V0QXR0cmlidXRlKCd0aXRsZScsICdHb29nbGUgbWFwJyk7XHJcbiAgfSwgMjAwKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlUmVzdGF1cmFudHMoKSB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0LmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3QuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICBmaWxsUmVzdGF1cmFudHNIVE1MKHJlc3RhdXJhbnRzKTtcclxuICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cclxuZnVuY3Rpb24gcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cykge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgaWYoc2VsZi5tYXJrZXJzKSB7XHJcbiAgICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICB9XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50c0hUTUwocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSB7XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2goKHJlc3RhdXJhbnQsIGkpID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50LCBpKSk7XHJcbiAgfSk7XHJcbiAgY29uc3QgYWRkTWFya2VycyA9ICgpID0+IGFkZE1hcmtlcnNUb01hcChyZXN0YXVyYW50cyk7XHJcbiAgc2V0VGltZW91dChhZGRNYXJrZXJzLCA1MDApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVJbWFnZShpbWdVcmwsIGFsdCkge1xyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICBpbWFnZS5zcmMgPSBpbWdVcmw7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBhbHQpO1xyXG4gIHJldHVybiBpbWFnZTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUmVzcG9uc2l2ZUltYWdlKGltZ1VybCwgYWx0LCByZXN0YXVyYW50KSB7XHJcbiAgY29uc3QgaW1nVXJscyA9IFtcclxuICAgIERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCAnc21hbGwnKSxcclxuICAgIERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCAnbWVkaXVtJyksXHJcbiAgICBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgJ2xhcmdlJyksXHJcbiAgICBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgJ3NtYWxsJyksXHJcbiAgXTtcclxuXHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuICBwaWN0dXJlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1nVXJsKTtcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGFsdCk7XHJcbiAgbGV0IHNvdXJjZXMgPSB6aXBSZWR1Y2UoXHJcbiAgICAgIGltZ1VybHMsIFxyXG4gICAgICBbJyhtYXgtd2lkdGg6IDQwMHB4KScsICcobWluLXdpZHRoOiA3MDFweCkgYW5kIChtYXgtd2lkdGg6IDEwMDBweCknLCAnKG1pbi13aWR0aDogNTAwcHgpIGFuZCAobWF4LXdpZHRoOiA3MDBweCknLCAnKG1pbS13aWR0aDogMTAwMXB4KSddLFxyXG4gICAgICAoc3Jjc2V0LCBtZWRpYSwgcmVzdWx0KSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgICAgICAgc291cmNlLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCBtZWRpYSk7XHJcbiAgICAgICAgc291cmNlLnNldEF0dHJpYnV0ZSgnc3Jjc2V0Jywgc3Jjc2V0KTtcclxuICAgICAgICByZXR1cm4gWyAuLi5yZXN1bHQsIHNvdXJjZV07XHJcbiAgICAgIH0sXHJcbiAgICAgIFtdXHJcbiAgKTtcclxuICBzb3VyY2VzLmZvckVhY2goc291cmNlID0+IHtcclxuICAgIHBpY3R1cmUuYXBwZW5kKHNvdXJjZSk7XHJcbiAgfSk7XHJcbiAgcGljdHVyZS5hcHBlbmQoaW1hZ2UpO1xyXG4gIHJldHVybiBwaWN0dXJlO1xyXG59XHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCwgaW5kZXgpIHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xyXG4gIGlmIChpbmRleCA+IDMpIHtcclxuICAgIGxpLmNsYXNzTmFtZSA9ICdoaWRkZW4nO1xyXG4gIH1cclxuICBjb25zdCBwaWN0dXJlID0gY3JlYXRlUmVzcG9uc2l2ZUltYWdlKFxyXG4gICAgICBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIGBBbiBpbWFnZSBmcm9tIHRoZSByZXN0YXVyYW50ICR7cmVzdGF1cmFudC5uYW1lfWAsXHJcbiAgICAgIHJlc3RhdXJhbnRcclxuICApO1xyXG4gIGxpLmFwcGVuZChwaWN0dXJlKTtcclxuXHJcbiAgY29uc3QgaW5mb0Jsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgaW5mb0Jsb2NrLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWluZm8nO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICBuYW1lLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWNhcmQtbmFtZSc7XHJcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBpbmZvQmxvY2suYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcclxuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XHJcbiAgaW5mb0Jsb2NrLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3Muc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGluZm9CbG9jay5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGluZm9CbG9jay5hcHBlbmQobW9yZSk7XHJcbiAgbGkuYXBwZW5kKGluZm9CbG9jayk7XHJcblxyXG4gIHJldHVybiBsaVxyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmZ1bmN0aW9uIGFkZE1hcmtlcnNUb01hcChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpIHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmxcclxuICAgIH0pO1xyXG4gICAgaWYgKCFzZWxmLm1hcmtlcnMpIHtcclxuICAgICAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgICB9XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59XHJcbiIsIi8qIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyIHdpdGggZXZlbnRzICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpIHtcclxuXHJcbiAgaWYgKCEnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3NlcnZpY2VXb3JrZXIgbm90IHJlZ2lzdGVyJyk7XHJcbiAgfVxyXG5cclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykudGhlbihmdW5jdGlvbiAocmVnKSB7XHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlZy5hY3RpdmUpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1RoZXJlIGlzIGFuIGFjdGl2ZSBzZXJ2aWNlIHdvcmtlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWcud2FpdGluZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnd2FpdGluZyA6JywgcmVnLndhaXRpbmcpO1xyXG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgaXMgd2FpdGluZycpO1xyXG4gICAgICB1cGRhdGVTZXJ2aWNlV29ya2VyKHJlZy53YWl0aW5nKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVnLmluc3RhbGxpbmcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ2luc3RhbGxpbmcgOiAnLCByZWcpO1xyXG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgc3RhdHVzIGlzIGluc3RhbGxpbmcnKTtcclxuICAgICAgdHJhY2tJbnN0YWxsaW5nKHJlZy5pbnN0YWxsaW5nKTtcclxuICAgIH1cclxuXHJcbiAgICByZWcuYWRkRXZlbnRMaXN0ZW5lcigndXBkYXRlZm91bmQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciB1cGRhdGUgZm91bmQnLCByZWcpO1xyXG4gICAgICB0cmFja0luc3RhbGxpbmcocmVnLmluc3RhbGxpbmcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIHJlZnJlc2hpbmc7XHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBpZiAocmVmcmVzaGluZykgcmV0dXJuO1xyXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgcmVmcmVzaGluZyA9IHRydWU7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgfSk7XHJcblxyXG4gIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coJ1JlZ2lzdHJhdGlvbiBmYWlsZWQgd2l0aCAnICsgZXJyb3IpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0cmFja0luc3RhbGxpbmcoaW5zdGFsbGluZ1dvcmtlcikge1xyXG4gIGlmICghaW5zdGFsbGluZ1dvcmtlcikge1xyXG4gICAgY29uc29sZS5sb2coJ1dvcmtlciBub3QgZGVmaW5lZCEnKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgaW5zdGFsbGluZ1dvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIHN0YXRlIHdhcyBjaGFuZ2VkIHRvICcgKyBpbnN0YWxsaW5nV29ya2VyLnN0YXRlKTtcclxuICAgIGlmIChpbnN0YWxsaW5nV29ya2VyLnN0YXRlID09PSAnaW5zdGFsbGVkJykge1xyXG4gICAgICBjb25zb2xlLmxvZygnU2VydmljZSB3b3JrZXIgaW5zdGFsbGVkIGFuZCB3YWl0aW5nIGZvciBhY3RpdmF0aW9uJywgaW5zdGFsbGluZ1dvcmtlcik7XHJcbiAgICAgIHVwZGF0ZVNlcnZpY2VXb3JrZXIoaW5zdGFsbGluZ1dvcmtlcik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVNlcnZpY2VXb3JrZXIod29ya2VyKSB7XHJcbiAgc2VuZE1lc3NhZ2VUb1NlcnZpY2VXb3JrZXIoe2FjdGlvbjogJ3NraXBXYWl0aW5nJ30sIHdvcmtlcilcclxuICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZUZyb21Tdykge1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXNwb25zZUZyb21Tdyk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb1NlcnZpY2VXb3JrZXIobXNnLCB3b3JrZXIpIHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgdmFyIG1zZ0NoYW4gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcclxuXHJcbiAgICAvLyBIYW5kbGVyIGZvciByZWNlaXZpbmcgbWVzc2FnZSByZXBseSBmcm9tIHNlcnZpY2Ugd29ya2VyXHJcbiAgICBtc2dDaGFuLnBvcnQxLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICBpZiAoZXZlbnQuZGF0YS5lcnJvcikge1xyXG4gICAgICAgIHJlamVjdChldmVudC5kYXRhLmVycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNvbHZlKGV2ZW50LmRhdGEpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8gU2VuZCBtZXNzYWdlIHRvIHNlcnZpY2Ugd29ya2VyIGFsb25nIHdpdGggcG9ydCBmb3IgcmVwbHlcclxuICAgIHdvcmtlci5wb3N0TWVzc2FnZShtc2csIFttc2dDaGFuLnBvcnQyXSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHJlZ2lzdGVyU2VydmljZVdvcmtlcixcclxufTsiXX0=
