"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function a(o,s,u){function c(e,t){if(!s[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[e]={exports:{}};o[e][0].call(i.exports,function(t){return c(o[e][1][t]||t)},i,i.exports,a,o,s,u)}return s[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,h,e){!function(){function o(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function a(n,r,i){var a,t=new Promise(function(t,e){o(a=n[r].apply(n,i)).then(t,e)});return t.request=a,t}function t(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function e(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return a(this[n],t,arguments)})})}function n(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function r(t,r,e,n){n.forEach(function(n){n in e.prototype&&(t.prototype[n]=function(){return t=this[r],(e=a(t,n,arguments)).then(function(t){if(t)return new s(t,e.request)});var t,e})})}function i(t){this._index=t}function s(t,e){this._cursor=t,this._request=e}function u(t){this._store=t}function c(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new c(n)}function d(t){this._db=t}t(i,"_index",["name","keyPath","multiEntry","unique"]),e(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),t(s,"_cursor",["direction","key","primaryKey","value"]),e(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(s.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),o(e._request).then(function(t){if(t)return new s(t,e._request)})})})}),u.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},t(u,"_store",["name","keyPath","indexNames","autoIncrement"]),e(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},t(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},t(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},t(d,"_db",["name","version","objectStoreNames"]),n(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[u,i].forEach(function(t){a in t.prototype&&(t.prototype[a.replace("open","iterate")]=function(){var t,e=(t=arguments,Array.prototype.slice.call(t)),n=e[e.length-1],r=this._store||this._index,i=r[a].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,u].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var f={open:function(t,e,n){var r=a(indexedDB,"open",[t,e]),i=r.request;return i.onupgradeneeded=function(t){n&&n(new l(i.result,t.oldVersion,i.transaction))},r.then(function(t){return new d(t)})},delete:function(t){return a(indexedDB,"deleteDatabase",[t])}};void 0!==h?(h.exports=f,h.exports.default=h.exports):self.idb=f}()},{}],2:[function(t,e,n){var r=t("idb"),i="restaurants",a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(){var e=this;return fetch(a.DATABASE_URL+"/restaurants").then(function(t){return t.json()}).then(function(t){return e.putRestaurantsIntoIndexedDb(t).then(function(){return t})}).catch(function(t){return a.fetchRestaurantsFromIndexedDb().then(function(t){if(t.length)return t;throw new Error("Fetch error")})})}},{key:"fetchRestaurantWithReviews",value:function(e){var i=this;return Promise.all([this.fetchRestaurant(e),this.fetchRestaurantReviews(e)]).then(function(t){var e=_slicedToArray(t,2),n=e[0],r=e[1];return n.reviews=r,i.putRestaurantIntoIndexedDb(n).then(function(){return n})}).catch(function(t){return a.fetchRestaurantFromIndexedDb(e).then(function(t){if(t)return t;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(t){return fetch(a.DATABASE_URL+"/restaurants/"+t).then(function(t){return t.json()})}},{key:"fetchRestaurantReviews",value:function(t){return fetch(a.DATABASE_URL+"/reviews/?restaurant_id="+t).then(function(t){return t.json()})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return a.openDatabase().then(function(t){return t.transaction(i).objectStore(i).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(e){return a.openDatabase().then(function(t){return t.transaction(i).objectStore(i).get(+e)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return a.clearRestaurantsInIndexedDb().then(function(){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return n.forEach(function(t){return e.objectStore(i).put(t)}),e.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return e.objectStore(i).put(n),e.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return e.objectStore(i).clear(),e.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(i,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(t){return a.fetchRestaurantWithReviews(t)}},{key:"fetchRestaurantByCuisine",value:function(e,t){a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.cuisine_type==e})})}},{key:"fetchRestaurantByNeighborhood",value:function(e){return a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.neighborhood==e})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(t){var e=t;return"all"!=n&&(e=e.filter(function(t){return t.cuisine_type==n})),"all"!=r&&(e=e.filter(function(t){return t.neighborhood==r})),e})}},{key:"fetchNeighborhoodsAndCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(t,e){return n[e].neighborhood}),i=n.map(function(t,e){return n[e].cuisine_type});return{neighborhoods:r.filter(function(t,e){return r.indexOf(t)==e}),cuisines:i.filter(function(t,e){return i.indexOf(t)==e}),restaurants:n}})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"/img/"+t.id+"_small.jpg"}},{key:"imageSrcSetForRestaurant",value:function(t){return"/img/"+t.photograph}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:a.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}();e.exports=a},{idb:1}],3:[function(t,e,n){e.exports={registerServiceWorker:function(){}}},{}],4:[function(t,e,n){function r(t,e){if((e=e||{}).max=e.max||5,this.rating=document.querySelector(t),this.starList=[],this.rating){this.rating.setAttribute("aria-label",e.label),this.rating.setAttribute("tabindex","0"),this.rating.setAttribute("role","radiogroup"),this.rating.setAttribute("aria-valuenow",0),this.rating.setAttribute("aria-valuemin",0),this.rating.setAttribute("aria-valuemax",e.max),this.rating.className="rating-select";for(var n=1;n<=e.max;n++){var r=document.createElement("div");r.className="rating-select__item",r.setAttribute("role","radio"),r.setAttribute("aria-checked",!1),r.setAttribute("tabindex",0),r.setAttribute("data-value",n),this.starList.push(r),r.addEventListener("click",this.onRatingElementClick.bind(this)),this.rating.append(r)}this.rating.addEventListener("keydown",this.handleKeyDown.bind(this)),this.activeItemIdx=0,this.ratingInput=document.createElement("input"),this.ratingInput.setAttribute("value",0),this.ratingInput.setAttribute("name",e.inputName||"rating"),this.ratingInput.setAttribute("id",e.inputName||"rating"),this.ratingInput.setAttribute("type","hidden"),this.rating.append(this.ratingInput)}}r.prototype={reset:function(){console.log("reset"),this.rating.setAttribute("aria-valuenow",0),this.ratingInput.setAttribute("value",0),this.activeItemIdx=0,this.starList.forEach(function(t){t.classList.remove("rating-select__item--checked"),t.setAttribute("aria-checked",!1),t.setAttribute("tabindex",-1)}),this.starList[0].setAttribute("tabindex",0)},onRatingElementClick:function(t){var n=this.starList.indexOf(t.target);if(-1!==!n){this.activeItemIdx=n,this.starList.map(function(t,e){t.classList.toggle("rating-select__item--checked",e<=n),e===n?(t.setAttribute("aria-checked",!0),t.setAttribute("tabindex",0)):(t.setAttribute("aria-checked",!1),t.setAttribute("tabindex",-1))});var e=t.target.getAttribute("data-value");this.rating.setAttribute("data-value",e),this.rating.setAttribute("aria-valuenow",e),this.ratingInput.setAttribute("value",e)}},handleKeyDown:function(t){var e=13,n=27,r=32,i=37,a=38,o=39,s=40;if(-1!==[s,a,r,e,i,o,n].indexOf(t.keyCode))switch(t.preventDefault(),t.keyCode){case s:case o:this.nextActiveListItem();break;case a:case i:this.previousActiveListItem();break;case r:case e:this.onRatingElementClick(t),this.rating.focus();break;case n:this.rating.focus()}},nextActiveListItem:function(){var t=this.activeItemIdx>=this.starList.length-1?0:this.activeItemIdx+1;this.starList[t].focus(),this.activeItemIdx=t},previousActiveListItem:function(){var t=0===this.activeItemIdx?this.starList.length-1:this.activeItemIdx-1;this.starList[t].focus(),this.activeItemIdx=t}},e.exports=r},{}],5:[function(t,e,n){var r,i=t("./dbhelper"),a=t("./task-service"),o=t("./process"),s=t("./rating-select"),f=new a,u=((r=document.createElement("div")).className="server-status-bar -online",document.body.appendChild(r),r);function h(){if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0])&&self.restaurant)return self.restaurant;var t=function(t,e){e||(e=window.location.href);t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))}("id");if(t)return i.fetchRestaurantById(t).then(function(t){if(!t)throw new Error("No restaurant");return t});throw new Error("No restaurant id in URL")}function p(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,e=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");if(!t){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void e.appendChild(r)}t.forEach(function(t){n.appendChild(m(t))})}function m(t){var e=document.createElement("li");e.setAttribute("tabindex","0"),e.className="reviews-list-item",e.setAttribute("aria-label","review");var n=document.createElement("div");n.className="reviewer-info";var r=document.createElement("div");r.className="reviewer-info__name-date";var i=document.createElement("h3");i.setAttribute("tabindex","0"),i.setAttribute("aria-label",t.name),i.innerHTML=t.name;var a=document.createElement("date");a.setAttribute("tabindex","0"),a.innerHTML=new Date(t.updatedAt).toDateString(),r.appendChild(i),r.appendChild(a),n.appendChild(r),n.appendChild(function(t){var e=document.createElement("p");e.appendChild((n=document.createElement("span"),n.className="rating-number",n.setAttribute("tabindex","0"),n.innerHTML="Rating : "+t,n));var n;var r="★".repeat(+t);+t<5&&(r+="☆".repeat(5-+t));var i=document.createElement("span");return i.className="rating-stars",i.innerHTML=r,e.appendChild(i),e}(t.rating)),e.appendChild(n);var o=document.createElement("p");return o.setAttribute("tabindex","0"),o.className="reviewer-comment",o.innerHTML=t.comments,e.appendChild(o),e}document.addEventListener("serverstatus",function(t){u.classList.toggle("-online",t.detail.online)},!1),function(){var l=document.getElementById("send-rating-form");if(!l)return;var d=new s("#rating-select",{label:"Rating",max:5});l.onsubmit=function(t){t.preventDefault();var e,n,r,i,a,o,s,u,c=t.target.elements;n=(e=c).name.value,r=e.rating.value,i=e.comments.value,a=(new Date).getTime(),o={restaurant_id:self.restaurant.id,name:n,rating:r,comments:i,createdAt:a,updatedAt:a},s=document.getElementById("reviews-list"),(u=m(o)).classList.add("-added"),s.appendChild(u),f.saveReview(o,function(){h(!0).then(function(t){self.restaurant=t,console.log("fill-reviews!!!!",t),Array.prototype.forEach.call(document.querySelectorAll(".reviews-list-item"),function(t){return t.remove()}),p()})}),l.reset(),d.reset()}}(),window.initMap=function(){o.registerServiceWorker(),h().then(function(t){self.restaurant=t,function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,e=document.getElementById("restaurant-name");e.innerHTML=t.name,e.setAttribute("tabindex","0"),document.getElementById("restaurant-address").innerHTML=t.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.setAttribute("alt","An image from the restaurant "+t.name),n.src=i.imageUrlForRestaurant(t);var r=document.getElementById("restaurant-cuisine");r.setAttribute("tabindex","0"),r.innerHTML=t.cuisine_type,t.operating_hours&&function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,e=document.getElementById("restaurant-hours");for(var n in t){var r=document.createElement("tr"),i=document.createElement("td");i.innerHTML=n,r.appendChild(i);var a=document.createElement("td");a.innerHTML=t[n],a.setAttribute("aria-label",t[n]+","),r.appendChild(a),e.appendChild(r)}}();p()}(),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,e=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=t.name,e.appendChild(n)}(),i.mapMarkerForRestaurant(self.restaurant,self.map)}).catch(function(t){console.error(t)})}},{"./dbhelper":2,"./process":3,"./rating-select":4,"./task-service":6}],6:[function(t,e,n){var r=t("./dbhelper");function i(){var s=this;this.worker=new Worker("task-worker.js"),this.jobId=0,this.worker.onmessage=function(t){var e=t.data,n=e.id,r=void 0===n?0:n,i=e.action,a=e.result;switch(i){case"offline":case"online":var o=new CustomEvent("serverstatus",{detail:{online:"online"===i}});document.dispatchEvent(o);break;case"save_review":console.log("this.worker.onmessage",r,i,a),s.workerCallbacks[r]&&s.workerCallbacks[r](a)}},this.workerCallbacks={onReviewSave:[]}}i.prototype={saveReview:function(e,t){this.jobId=this.jobId+1,r.fetchRestaurantFromIndexedDb(e.restaurant_id).then(function(t){t.reviews.push(e),r.putRestaurantIntoIndexedDb(t)}),this.worker.postMessage({id:this.jobId,action:"save_review",payload:e}),"function"==typeof t&&(this.workerCallbacks[this.jobId]=t)}},e.exports=i},{"./dbhelper":2}]},{},[5]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvcHJvY2Vzcy5qcyIsInNyYy9qcy9yYXRpbmctc2VsZWN0LmpzIiwic3JjL2pzL3Jlc3RhdXJhbnRfaW5mby5qcyIsInNyYy9qcy90YXNrLXNlcnZpY2UuanMiXSwibmFtZXMiOlsicmVzdWx0IiwiZXJyb3IiLCJyZXF1ZXN0IiwiYXJncyIsInJlamVjdCIsInAiLCJwcm9wIiwidmFsIiwiYXJndW1lbnRzIiwiaW5kZXgiLCJjdXJzb3IiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwicmVzb2x2ZSIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwidGhpcyIsIl9yZXF1ZXN0IiwiYXJyIiwiX2luZGV4IiwidmFsdWUiLCJjb250aW51ZSIsIml0ZW1zIiwidmVyc2lvbiIsIm5hbWUiLCJleHAiLCJleHBvcnRzIiwiaWRiIiwicmVxdWlyZSIsIkRCX1JFU1RBVVJBTlRTX1RBQkxFIiwiREJIZWxwZXIiLCJfdGhpcyIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJkYXRhIiwianNvbiIsInJlc3RhdXJhbnRzIiwicHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiIiwiY2F0Y2giLCJlcnIiLCJmZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYiIsImxlbmd0aCIsIkVycm9yIiwiaWQiLCJfdGhpczIiLCJhbGwiLCJmZXRjaFJlc3RhdXJhbnQiLCJmZXRjaFJlc3RhdXJhbnRSZXZpZXdzIiwiX3JlZiIsIl9yZWYyIiwiX3NsaWNlZFRvQXJyYXkiLCJyZXN0YXVyYW50IiwicmV2aWV3cyIsInB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiIiwiZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYiIsInJlc3RhdXJhbnRJZCIsIm9wZW5EYXRhYmFzZSIsIm9iamVjdFN0b3JlIiwiZ2V0QWxsIiwiZ2V0IiwiY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiIiwidHgiLCJmb3JFYWNoIiwicHV0IiwiY29tcGxldGUiLCJjbGVhciIsIm9wZW4iLCJ1cGdyYWRlRGIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXdzIiwiY3Vpc2luZSIsImNhbGxiYWNrIiwiZmV0Y2hSZXN0YXVyYW50cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJyZXN1bHRzIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiY3Vpc2luZXMiLCJpbmRleE9mIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJsYXRsbmciLCJ1cmxGb3JSZXN0YXVyYW50IiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1vZHVsZSIsInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIlJhdGluZ1NlbGVjdCIsInNlbGVjdG9yIiwib3B0aW9ucyIsIm1heCIsInJhdGluZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInN0YXJMaXN0Iiwic2V0QXR0cmlidXRlIiwibGFiZWwiLCJjbGFzc05hbWUiLCJzdGFyIiwiY3JlYXRlRWxlbWVudCIsInB1c2giLCJhZGRFdmVudExpc3RlbmVyIiwib25SYXRpbmdFbGVtZW50Q2xpY2siLCJiaW5kIiwiYXBwZW5kIiwiaGFuZGxlS2V5RG93biIsImFjdGl2ZUl0ZW1JZHgiLCJyYXRpbmdJbnB1dCIsImlucHV0TmFtZSIsInByb3RvdHlwZSIsImxvZyIsImVsIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZSIsImNsaWNrZWRTdGFySW5kZXgiLCJ0YXJnZXQiLCJ0b2dnbGUiLCJnZXRBdHRyaWJ1dGUiLCJWS19FTlRFUiIsIlZLX0VTQyIsIlZLX1NQQUNFIiwiVktfTEVGVCIsIlZLX1VQIiwiVktfUklHSFQiLCJWS19ET1dOIiwia2V5Q29kZSIsInByZXZlbnREZWZhdWx0IiwibmV4dEFjdGl2ZUxpc3RJdGVtIiwicHJldmlvdXNBY3RpdmVMaXN0SXRlbSIsImZvY3VzIiwibmV4dEVsZW1lbnRJbmRleCIsInByZXZFbGVtZW50SW5kZXgiLCJiYXIiLCJUYXNrU2VydmljZSIsInByb2Nlc3MiLCJ0YXNrU2VydmljZSIsInN0YXR1c0JhciIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJ1bmRlZmluZWQiLCJzZWxmIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJldmlld3NIVE1MIiwiY29udGFpbmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJ1bCIsIm5vUmV2aWV3cyIsImlubmVySFRNTCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsInJldmlld2VySW5mb0Jsb2NrIiwicmV2aWV3ZXJOYW1lRGF0ZSIsImRhdGUiLCJEYXRlIiwidXBkYXRlZEF0IiwidG9EYXRlU3RyaW5nIiwicmF0aW5nVmFsdWUiLCJzcGFuIiwicmF0aW5nU3RhcnMiLCJyZXBlYXQiLCJyYXRpbmdTdGFyc0VsZW1lbnQiLCJjcmVhdGVSYXRpbmdTdGFyc0Jsb2NrIiwiY29tbWVudHMiLCJkZXRhaWwiLCJvbmxpbmUiLCJmb3JtIiwic2VsZWN0Iiwib25zdWJtaXQiLCJlbGVtZW50cyIsImN1ckRhdGUiLCJ2YWx1ZXMiLCJnZXRUaW1lIiwiYWRkIiwic2F2ZVJldmlldyIsImNhbGwiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVzZXQiLCJyYXRpbmdGb3JtIiwiaW5pdE1hcCIsImFkZHJlc3MiLCJpbWFnZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsIm9wZXJhdGluZ19ob3VycyIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJNYXAiLCJicmVhZGNydW1iIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiX3RoaXMzIiwid29ya2VyIiwiV29ya2VyIiwiam9iSWQiLCJvbm1lc3NhZ2UiLCJfcmVmMyIsIl9yZWYzJGRhdGEiLCJfcmVmMyRkYXRhJGlkIiwiYWN0aW9uIiwic3RhdHVzRXZlbnQiLCJDdXN0b21FdmVudCIsImRpc3BhdGNoRXZlbnQiLCJ3b3JrZXJDYWxsYmFja3MiLCJyZXN0YXVyYW50X2lkIiwicG9zdE1lc3NhZ2UiXSwibWFwcGluZ3MiOiJvc0NBQUEsMkdDV0FBLGtDQUlBQyxnQ0FNQUMsK0NBRUFDLFdBQ0FDLHNCQUdBRixFQUNBRyw2R0FlQUMsK0JBR0FDLGlIQVVBQyxzSUFTQUEsZ0lBU0FBLG1EQXZDQU4saURBNkNBTywrQkF3QkFDLGdCQUNBUiw0QkFnQ0FTLHlCQXdDQUMsa0VBR0FDLDhCQUdBWixpQ0FHQUEscUNBbUJBYSxrQkFDQUMseUJBQ0FDLDBCQW1CQUYsZUEvSUEsQ0FDQSxPQUNBLFVBQ0EsYUFDQSxpQ0FHQSxDQUNBLE1BQ0EsU0FDQSxTQUNBLGFBQ0EsZ0NBR0EsQ0FDQSxhQUNBLGdDQVFBLENBQ0EsWUFDQSxNQUNBLGFBQ0Esa0NBR0EsQ0FDQSxTQUNBLHNJQU9BRyxPQUNBVCx1RkFFQUwsd0RBR0FlLDRHQVdBViwyRkFJQUEsMEJBR0EsQ0FDQSxPQUNBLFVBQ0EsYUFDQSw4Q0FHQSxDQUNBLE1BQ0EsTUFDQSxTQUNBLFFBQ0EsTUFDQSxTQUNBLFNBQ0EsYUFDQSxzQ0FHQSxDQUNBLGFBQ0EsOENBR0EsQ0FDQSxvR0FtQkFBLHVCQUdBLENBQ0EsbUJBQ0Esa0NBR0EsQ0FDQSwwR0FVQUEsdUJBR0EsQ0FDQSxPQUNBLFVBQ0EsMkNBR0EsQ0FDQSxvQkFDQSw4RkFRQUEsdUJBR0EsQ0FDQSxPQUNBLFVBQ0EsMkNBR0EsQ0FDQSx5S0FXQUEscUNBdFBBVyxpQkF1UEEs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QXRLLDZCQUFzQ2tILEVBQXRDOEQsZUFBQXJNLEtBQWlFLFNBQUFrQixLQUMvREMsUUFBQXlELEtBQUEyRCxLQUNBbkgsMkJBQUFGLFVBSUZ1SyxPQUFBYSxZQUFBLElBQ012TixLQURrQjRNLGFBQUEsc0JBQXhCcEQsSUFNQSxtQkFBSS9GLFNBQ0Y0SixnQkFBcUJyTixLQUFyQjRNLE9BQUFuSixLQU9OcUIsRUFBQXBFLFFBQUFxSCIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cbiAgICAgIGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIiwiY29uc3QgaWRiID0gcmVxdWlyZSgnaWRiJyk7XHJcbmNvbnN0IEFQUF9EQl9OQU1FID0gJ3Jlc3RhdXJhbnRzLWRiJztcclxuY29uc3QgREJfUkVTVEFVUkFOVFNfVEFCTEUgPSAncmVzdGF1cmFudHMnO1xyXG5jb25zdCBBUFBfREJfVkVSID0gMTtcclxuXHJcbi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICsgJy9yZXN0YXVyYW50cycpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIocmVzdGF1cmFudHMpLnRoZW4oKCkgPT4gcmVzdGF1cmFudHMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICAgIGlmICghcmVzdGF1cmFudHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmV0Y2ggZXJyb3InKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudCBieSBpZCB3aXRoIHJldmlld3MuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXdzKGlkKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xyXG4gICAgICB0aGlzLmZldGNoUmVzdGF1cmFudChpZCksXHJcbiAgICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50UmV2aWV3cyhpZClcclxuICAgIF0pLnRoZW4oKFtyZXN0YXVyYW50LCByZXZpZXdzXSkgPT4ge1xyXG4gICAgICByZXN0YXVyYW50LnJldmlld3MgPSByZXZpZXdzO1xyXG4gICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50SW50b0luZGV4ZWREYihyZXN0YXVyYW50KS50aGVuKCgpID0+IHJlc3RhdXJhbnQpO1xyXG4gICAgfSkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEZyb21JbmRleGVkRGIoaWQpLnRoZW4ocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZldGNoIGVycm9yJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZXN0YXVyYW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jlc3RhdXJhbnRzLyR7aWR9YClcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50UmV2aWV3cyhyZXN0YXVyYW50SWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JHtyZXN0YXVyYW50SWR9YClcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKClcclxuICAgICAgLnRoZW4oZGIgPT4gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXRBbGwoKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYihpZCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT5cclxuICAgICAgZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXQoK2lkKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnRzKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIuY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiKCkudGhlbigoKSA9PiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCkpO1xyXG4gICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgIHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuY2xlYXIoKTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgb3BlbkRhdGFiYXNlKCkge1xyXG4gICAgcmV0dXJuIGlkYi5vcGVuKEFQUF9EQl9OQU1FLCBBUFBfREJfVkVSLCAodXBncmFkZURiKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcclxuICAgICAgICBjYXNlIDAgOlxyXG4gICAgICAgICAgY29uc3QgcmVzdGF1cmFudFN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFLCB7a2V5UGF0aDogJ2lkJ30pO1xyXG4gICAgICAgICAgcmVzdGF1cmFudFN0b3JlLmNyZWF0ZUluZGV4KCdzdGF0dXMnLCAnc3RhdHVzJyk7XHJcbiAgICAgICAgLy8gYnJlYWsgb21pdHRlZFxyXG4gICAgICAgIGRlZmF1bHQgOlxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MoaWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcblxyXG4gICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5laWdoYm9yaG9vZHM6IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSksXHJcbiAgICAgICAgY3Vpc2luZXM6IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKSxcclxuICAgICAgICByZXN0YXVyYW50cyxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQuaWR9X3NtYWxsLmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VTcmNTZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IERCSGVscGVyOyIsIi8qIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyIHdpdGggZXZlbnRzICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpIHtcclxuXHJcbiAgcmV0dXJuO1xyXG5cclxuICBpZiAoISdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignc2VydmljZVdvcmtlciBub3QgcmVnaXN0ZXInKTtcclxuICB9XHJcblxyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uIChyZWcpIHtcclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAocmVnLmFjdGl2ZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnVGhlcmUgaXMgYW4gYW4gYWN0aXZlIHNlcnZpY2Ugd29ya2VyJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZy53YWl0aW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCd3YWl0aW5nIDonLCByZWcud2FpdGluZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBpcyB3YWl0aW5nJyk7XHJcbiAgICAgIHVwZGF0ZVNlcnZpY2VXb3JrZXIocmVnLndhaXRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWcuaW5zdGFsbGluZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnaW5zdGFsbGluZyA6ICcsIHJlZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBzdGF0dXMgaXMgaW5zdGFsbGluZycpO1xyXG4gICAgICB0cmFja0luc3RhbGxpbmcocmVnLmluc3RhbGxpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHVwZGF0ZSBmb3VuZCcsIHJlZyk7XHJcbiAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgcmVmcmVzaGluZztcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlmIChyZWZyZXNoaW5nKSByZXR1cm47XHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICByZWZyZXNoaW5nID0gdHJ1ZTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZygnUmVnaXN0cmF0aW9uIGZhaWxlZCB3aXRoICcgKyBlcnJvcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyYWNrSW5zdGFsbGluZyhpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgaWYgKCFpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgICBjb25zb2xlLmxvZygnV29ya2VyIG5vdCBkZWZpbmVkIScpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBpbnN0YWxsaW5nV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgc3RhdGUgd2FzIGNoYW5nZWQgdG8gJyArIGluc3RhbGxpbmdXb3JrZXIuc3RhdGUpO1xyXG4gICAgaWYgKGluc3RhbGxpbmdXb3JrZXIuc3RhdGUgPT09ICdpbnN0YWxsZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlIHdvcmtlciBpbnN0YWxsZWQgYW5kIHdhaXRpbmcgZm9yIGFjdGl2YXRpb24nLCBpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgICAgdXBkYXRlU2VydmljZVdvcmtlcihpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU2VydmljZVdvcmtlcih3b3JrZXIpIHtcclxuICBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcih7YWN0aW9uOiAnc2tpcFdhaXRpbmcnfSwgd29ya2VyKVxyXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlRnJvbVN3KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlRnJvbVN3KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcihtc2csIHdvcmtlcikge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB2YXIgbXNnQ2hhbiA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG5cclxuICAgIC8vIEhhbmRsZXIgZm9yIHJlY2lldmluZyBtZXNzYWdlIHJlcGx5IGZyb20gc2VydmljZSB3b3JrZXJcclxuICAgIG1zZ0NoYW4ucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGlmIChldmVudC5kYXRhLmVycm9yKSB7XHJcbiAgICAgICAgcmVqZWN0KGV2ZW50LmRhdGEuZXJyb3IpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc29sdmUoZXZlbnQuZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gc2VydmljZSB3b3JrZXIgYWxvbmcgd2l0aCBwb3J0IGZvciByZXBseVxyXG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKG1zZywgW21zZ0NoYW4ucG9ydDJdKTtcclxuICB9KTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyLFxyXG59OyIsImZ1bmN0aW9uIFJhdGluZ1NlbGVjdChzZWxlY3Rvciwgb3B0aW9ucykge1xuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgb3B0aW9ucy5tYXggPSBvcHRpb25zLm1heCB8fCA1O1xuXG4gIHRoaXMucmF0aW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG5cbiAgdGhpcy5zdGFyTGlzdCA9IFtdO1xuXG4gIGlmICghdGhpcy5yYXRpbmcpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBvcHRpb25zLmxhYmVsKTtcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgncm9sZScsICdyYWRpb2dyb3VwJyk7XG4gIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW5vdycsIDApO1xuICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWVtaW4nLCAwKTtcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbWF4Jywgb3B0aW9ucy5tYXgpO1xuICB0aGlzLnJhdGluZy5jbGFzc05hbWUgPSAncmF0aW5nLXNlbGVjdCc7XG5cbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gb3B0aW9ucy5tYXg7IGkrKykge1xuICAgIGNvbnN0IHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzdGFyLmNsYXNzTmFtZSA9ICdyYXRpbmctc2VsZWN0X19pdGVtJztcbiAgICBzdGFyLnNldEF0dHJpYnV0ZSgncm9sZScsICdyYWRpbycpO1xuICAgIHN0YXIuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBpKTtcbiAgICB0aGlzLnN0YXJMaXN0LnB1c2goc3Rhcik7XG4gICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25SYXRpbmdFbGVtZW50Q2xpY2suYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yYXRpbmcuYXBwZW5kKHN0YXIpO1xuICB9XG5cbiAgdGhpcy5yYXRpbmcuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpKTtcbiAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gMDtcblxuICB0aGlzLnJhdGluZ0lucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgMCk7XG4gIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgb3B0aW9ucy5pbnB1dE5hbWUgfHwgJ3JhdGluZycpO1xuICB0aGlzLnJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBvcHRpb25zLmlucHV0TmFtZSB8fCAncmF0aW5nJyk7XG4gIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpO1xuICB0aGlzLnJhdGluZy5hcHBlbmQodGhpcy5yYXRpbmdJbnB1dCk7XG59XG5cblJhdGluZ1NlbGVjdC5wcm90b3R5cGUgPSB7XG5cbiAgcmVzZXQoKSB7XG4gICAgY29uc29sZS5sb2coJ3Jlc2V0Jyk7XG4gICAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgMCk7XG4gICAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgMCk7XG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gMDtcbiAgICB0aGlzLnN0YXJMaXN0LmZvckVhY2goZWwgPT4ge1xuICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgncmF0aW5nLXNlbGVjdF9faXRlbS0tY2hlY2tlZCcpO1xuICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XG4gICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgLTEpO1xuICAgIH0pO1xuICAgIHRoaXMuc3Rhckxpc3RbMF0uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xuICB9LFxuXG4gIG9uUmF0aW5nRWxlbWVudENsaWNrKGUpIHtcbiAgICBjb25zdCBjbGlja2VkU3RhckluZGV4ID0gdGhpcy5zdGFyTGlzdC5pbmRleE9mKGUudGFyZ2V0KTtcblxuICAgIGlmICghY2xpY2tlZFN0YXJJbmRleCA9PT0gLTEpIHJldHVybjtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSBjbGlja2VkU3RhckluZGV4O1xuXG4gICAgdGhpcy5zdGFyTGlzdC5tYXAoKGVsLCBpKSA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKCdyYXRpbmctc2VsZWN0X19pdGVtLS1jaGVja2VkJywgaSA8PSBjbGlja2VkU3RhckluZGV4KTtcbiAgICAgIGlmIChpID09PSBjbGlja2VkU3RhckluZGV4KSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgdHJ1ZSk7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgZmFsc2UpO1xuICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgLTEpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHZhbCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xuICAgIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScsIHZhbCk7XG4gICAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgdmFsKTtcbiAgICB0aGlzLnJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCB2YWwpO1xuXG4gIH0sXG5cbiAgaGFuZGxlS2V5RG93bihlKSB7XG4gICAgLy8gRGVmaW5lIHZhbHVlcyBmb3Iga2V5Y29kZXNcbiAgICBjb25zdCBWS19FTlRFUiA9IDEzO1xuICAgIGNvbnN0IFZLX0VTQyA9IDI3O1xuICAgIGNvbnN0IFZLX1NQQUNFID0gMzI7XG4gICAgY29uc3QgVktfTEVGVCA9IDM3O1xuICAgIGNvbnN0IFZLX1VQID0gMzg7XG4gICAgY29uc3QgVktfUklHSFQgPSAzOTtcbiAgICBjb25zdCBWS19ET1dOID0gNDA7XG5cbiAgICBpZiAoW1ZLX0RPV04sIFZLX1VQLCBWS19TUEFDRSwgVktfRU5URVIsIFZLX0xFRlQsIFZLX1JJR0hULCBWS19FU0NdLmluZGV4T2YoZS5rZXlDb2RlKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICBjYXNlIFZLX0RPV046XG4gICAgICBjYXNlIFZLX1JJR0hUOlxuICAgICAgICB0aGlzLm5leHRBY3RpdmVMaXN0SXRlbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfVVA6XG4gICAgICBjYXNlIFZLX0xFRlQ6XG4gICAgICAgIHRoaXMucHJldmlvdXNBY3RpdmVMaXN0SXRlbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfU1BBQ0U6XG4gICAgICAgIHRoaXMub25SYXRpbmdFbGVtZW50Q2xpY2soZSk7XG4gICAgICAgIHRoaXMucmF0aW5nLmZvY3VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19FTlRFUjpcbiAgICAgICAgdGhpcy5vblJhdGluZ0VsZW1lbnRDbGljayhlKTtcbiAgICAgICAgdGhpcy5yYXRpbmcuZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFZLX0VTQzpcbiAgICAgICAgdGhpcy5yYXRpbmcuZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuO1xuICB9LFxuXG4gIG5leHRBY3RpdmVMaXN0SXRlbSgpIHtcbiAgICBjb25zdCBuZXh0RWxlbWVudEluZGV4ID0gKHRoaXMuYWN0aXZlSXRlbUlkeCA+PSB0aGlzLnN0YXJMaXN0Lmxlbmd0aCAtIDEpID8gMCA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggKyAxKTtcbiAgICB0aGlzLnN0YXJMaXN0W25leHRFbGVtZW50SW5kZXhdLmZvY3VzKCk7XG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gbmV4dEVsZW1lbnRJbmRleDtcbiAgfSxcblxuICBwcmV2aW91c0FjdGl2ZUxpc3RJdGVtKCkge1xuICAgIGNvbnN0IHByZXZFbGVtZW50SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSWR4ID09PSAwKSA/IHRoaXMuc3Rhckxpc3QubGVuZ3RoIC0gMSA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggLSAxKTtcbiAgICB0aGlzLnN0YXJMaXN0W3ByZXZFbGVtZW50SW5kZXhdLmZvY3VzKCk7XG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gcHJldkVsZW1lbnRJbmRleDtcbiAgfSxcblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFJhdGluZ1NlbGVjdDsiLCJjb25zdCBEQkhlbHBlciA9IHJlcXVpcmUoJy4vZGJoZWxwZXInKTtcbmNvbnN0IFRhc2tTZXJ2aWNlID0gcmVxdWlyZSgnLi90YXNrLXNlcnZpY2UnKTtcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKCcuL3Byb2Nlc3MnKTtcbmNvbnN0IFJhdGluZ1NlbGVjdCA9IHJlcXVpcmUoJy4vcmF0aW5nLXNlbGVjdCcpO1xuXG5sZXQgcmVzdGF1cmFudDtcbnZhciBtYXA7XG5jb25zdCB0YXNrU2VydmljZSA9IG5ldyBUYXNrU2VydmljZSgpO1xuXG5jb25zdCBzdGF0dXNCYXIgPSBjcmVhdGVTdGF0dXNCYXIoKTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VydmVyc3RhdHVzJywgZnVuY3Rpb24gKGUpIHtcbiAgc3RhdHVzQmFyLmNsYXNzTGlzdC50b2dnbGUoJy1vbmxpbmUnLCBlLmRldGFpbC5vbmxpbmUpO1xufSwgZmFsc2UpO1xuXG5yYXRpbmdGb3JtKCk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgcHJvY2Vzcy5yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpLnRoZW4ocmVzdGF1cmFudCA9PiB7XG4gICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblxuICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuXG4gICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgem9vbTogMTYsXG4gICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgfSk7XG5cbiAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cbiAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xufTtcblxuZnVuY3Rpb24gY3JlYXRlU3RhdHVzQmFyKCkge1xuICBjb25zdCBiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgYmFyLmNsYXNzTmFtZSA9ICdzZXJ2ZXItc3RhdHVzLWJhciAtb25saW5lJztcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYXIpO1xuXG4gIHJldHVybiBiYXI7XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKGZvcmNlID0gZmFsc2UpIHtcbiAgaWYgKCFmb3JjZSAmJiBzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgcmV0dXJuIHNlbGYucmVzdGF1cmFudDtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQpLnRoZW4oKHJlc3RhdXJhbnQpID0+IHtcblxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gcmVzdGF1cmFudCcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdGF1cmFudDtcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGBBbiBpbWFnZSBmcm9tIHRoZSByZXN0YXVyYW50ICR7cmVzdGF1cmFudC5uYW1lfWApO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHRpbWUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgb3BlcmF0aW5nSG91cnNba2V5XSArICcsJyk7IC8vIGZvciBzY3JlZW4gcmVhZGVyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZnVuY3Rpb24gZmlsbFJldmlld3NIVE1MKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykge1xuXG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjbGVhclJldmlld3NIdG1sKCkge1xuICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKFxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZXZpZXdzLWxpc3QtaXRlbScpLFxuICAgIGxpID0+IGxpLnJlbW92ZSgpXG4gICk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSB7XG5cbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgbGkuY2xhc3NOYW1lID0gJ3Jldmlld3MtbGlzdC1pdGVtJztcbiAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ3JldmlldycpO1xuXG4gIGNvbnN0IHJldmlld2VySW5mb0Jsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJldmlld2VySW5mb0Jsb2NrLmNsYXNzTmFtZSA9ICdyZXZpZXdlci1pbmZvJztcblxuICBjb25zdCByZXZpZXdlck5hbWVEYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJldmlld2VyTmFtZURhdGUuY2xhc3NOYW1lID0gJ3Jldmlld2VyLWluZm9fX25hbWUtZGF0ZSc7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG4gIG5hbWUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIG5hbWUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcmV2aWV3Lm5hbWUpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkYXRlJyk7XG4gIGRhdGUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCkudG9EYXRlU3RyaW5nKCk7XG5cbiAgcmV2aWV3ZXJOYW1lRGF0ZS5hcHBlbmRDaGlsZChuYW1lKTtcbiAgcmV2aWV3ZXJOYW1lRGF0ZS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICByZXZpZXdlckluZm9CbG9jay5hcHBlbmRDaGlsZChyZXZpZXdlck5hbWVEYXRlKTtcblxuICByZXZpZXdlckluZm9CbG9jay5hcHBlbmRDaGlsZChjcmVhdGVSYXRpbmdTdGFyc0Jsb2NrKHJldmlldy5yYXRpbmcpKTtcblxuICBsaS5hcHBlbmRDaGlsZChyZXZpZXdlckluZm9CbG9jayk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBjb21tZW50cy5jbGFzc05hbWUgPSAncmV2aWV3ZXItY29tbWVudCc7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmF0aW5nU3RhcnNCbG9jayhyYXRpbmdWYWx1ZSkge1xuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cbiAgcmF0aW5nLmFwcGVuZENoaWxkKCgoKSA9PiB7XG4gICAgbGV0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgc3Bhbi5jbGFzc05hbWUgPSAncmF0aW5nLW51bWJlcic7XG4gICAgc3Bhbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICBzcGFuLmlubmVySFRNTCA9ICdSYXRpbmcgOiAnICsgcmF0aW5nVmFsdWU7XG4gICAgcmV0dXJuIHNwYW47XG4gIH0pKCkpO1xuXG4gIGxldCByYXRpbmdTdGFycyA9ICfimIUnLnJlcGVhdCgrcmF0aW5nVmFsdWUpO1xuXG4gIGlmICgrcmF0aW5nVmFsdWUgPCA1KSB7XG4gICAgcmF0aW5nU3RhcnMgPSByYXRpbmdTdGFycyArICfimIYnLnJlcGVhdCg1IC0gK3JhdGluZ1ZhbHVlKTtcbiAgfVxuICBjb25zdCByYXRpbmdTdGFyc0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIHJhdGluZ1N0YXJzRWxlbWVudC5jbGFzc05hbWUgPSAncmF0aW5nLXN0YXJzJztcbiAgcmF0aW5nU3RhcnNFbGVtZW50LmlubmVySFRNTCA9IHJhdGluZ1N0YXJzO1xuICByYXRpbmcuYXBwZW5kQ2hpbGQocmF0aW5nU3RhcnNFbGVtZW50KTtcblxuICByZXR1cm4gcmF0aW5nO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJhdGluZ1NlbGVjdCgpIHtcblxufVxuXG5mdW5jdGlvbiByYXRpbmdGb3JtKCkge1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbmQtcmF0aW5nLWZvcm0nKTtcbiAgaWYgKCFmb3JtKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2VsZWN0ID0gbmV3IFJhdGluZ1NlbGVjdCgnI3JhdGluZy1zZWxlY3QnLCB7XG4gICAgbGFiZWw6ICdSYXRpbmcnLFxuICAgIG1heDogNSxcbiAgfSk7XG5cbiAgZm9ybS5vbnN1Ym1pdCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgdmFsdWVzID0gZS50YXJnZXQuZWxlbWVudHM7XG4gICAgYWRkQ29tbWVudCh2YWx1ZXMpO1xuICAgIGZvcm0ucmVzZXQoKTtcbiAgICBzZWxlY3QucmVzZXQoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRDb21tZW50KGVsZW1lbnRzKSB7XG4gIGNvbnN0IHtcbiAgICBuYW1lOiB7IHZhbHVlIDogbmFtZSB9LFxuICAgIHJhdGluZzogeyB2YWx1ZSA6IHJhdGluZyB9LFxuICAgIGNvbW1lbnRzOiB7IHZhbHVlIDogY29tbWVudHMgfVxuICB9ID0gZWxlbWVudHM7XG5cbiAgY29uc3QgY3VyRGF0ZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG5cbiAgY29uc3QgcmV2aWV3ID0ge1xuICAgIHJlc3RhdXJhbnRfaWQ6IHNlbGYucmVzdGF1cmFudC5pZCxcbiAgICBuYW1lLFxuICAgIHJhdGluZyxcbiAgICBjb21tZW50cyxcbiAgICBjcmVhdGVkQXQ6IGN1ckRhdGUsXG4gICAgdXBkYXRlZEF0OiBjdXJEYXRlLFxuICB9O1xuXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICBjb25zdCBsaSA9IGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KTtcbiAgbGkuY2xhc3NMaXN0LmFkZCgnLWFkZGVkJyk7XG4gIHVsLmFwcGVuZENoaWxkKGxpKTtcbiAgdGFza1NlcnZpY2Uuc2F2ZVJldmlldyhyZXZpZXcsICgpID0+IHtcbiAgICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKHRydWUpLnRoZW4ocmVzdGF1cmFudCA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgY29uc29sZS5sb2coJ2ZpbGwtcmV2aWV3cyEhISEnLCByZXN0YXVyYW50KTtcbiAgICAgIGNsZWFyUmV2aWV3c0h0bWwoKTtcbiAgICAgIGZpbGxSZXZpZXdzSFRNTCgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUgKG5hbWUsIHVybCkge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICghcmVzdWx0c1syXSkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG4iLCJjb25zdCBEQkhlbHBlciA9IHJlcXVpcmUoJy4vZGJoZWxwZXInKTtcblxuZnVuY3Rpb24gVGFza1NlcnZpY2UoKSB7XG4gIHRoaXMud29ya2VyID0gbmV3IFdvcmtlcigndGFzay13b3JrZXIuanMnKTtcbiAgdGhpcy5qb2JJZCA9IDA7XG4gIHRoaXMud29ya2VyLm9ubWVzc2FnZSA9ICh7IGRhdGE6IHsgaWQgPSAwLCBhY3Rpb24sIHJlc3VsdCB9IH0pID0+IHtcbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSAnb2ZmbGluZSc6XG4gICAgICBjYXNlICdvbmxpbmUnOlxuICAgICAgICBjb25zdCBzdGF0dXNFdmVudCA9IG5ldyBDdXN0b21FdmVudCgnc2VydmVyc3RhdHVzJywgeyBkZXRhaWw6IHsgb25saW5lOiBhY3Rpb24gPT09ICdvbmxpbmUnIH0gfSk7XG4gICAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoc3RhdHVzRXZlbnQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NhdmVfcmV2aWV3JzpcbiAgICAgICAgY29uc29sZS5sb2coJ3RoaXMud29ya2VyLm9ubWVzc2FnZScsIGlkLCBhY3Rpb24sIHJlc3VsdCk7XG4gICAgICAgIGlmICh0aGlzLndvcmtlckNhbGxiYWNrc1tpZF0pIHtcbiAgICAgICAgICB0aGlzLndvcmtlckNhbGxiYWNrc1tpZF0ocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICB0aGlzLndvcmtlckNhbGxiYWNrcyA9IHtcbiAgICBvblJldmlld1NhdmU6IFtdLFxuICB9O1xufVxuXG5UYXNrU2VydmljZS5wcm90b3R5cGUgPSB7XG5cbiAgc2F2ZVJldmlldyhyZXZpZXcsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5qb2JJZCA9IHRoaXMuam9iSWQgKyAxO1xuICAgIC8vIGZpcnN0IHN0ZXA6IHNhdmUgaW50byBpbmRleGVkREJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiKHJldmlldy5yZXN0YXVyYW50X2lkKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xuICAgICAgcmVzdGF1cmFudC5yZXZpZXdzLnB1c2gocmV2aWV3KTtcbiAgICAgIERCSGVscGVyLnB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnQpO1xuICAgIH0pO1xuXG4gICAgLy8gdGhlbiBzZW5kIGRhdGEgdG8gQVBJXG4gICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgaWQ6IHRoaXMuam9iSWQsXG4gICAgICBhY3Rpb246ICdzYXZlX3JldmlldycsXG4gICAgICBwYXlsb2FkOiByZXZpZXdcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRoaXMud29ya2VyQ2FsbGJhY2tzW3RoaXMuam9iSWRdID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gIH0sXG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVGFza1NlcnZpY2U7Il19
