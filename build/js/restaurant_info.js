"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function a(o,u,s){function c(e,t){if(!u[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var i=u[e]={exports:{}};o[e][0].call(i.exports,function(t){return c(o[e][1][t]||t)},i,i.exports,a,o,u,s)}return u[e].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)c(s[t]);return c}({1:[function(t,h,e){!function(){function o(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function a(n,r,i){var a,t=new Promise(function(t,e){o(a=n[r].apply(n,i)).then(t,e)});return t.request=a,t}function t(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function e(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return a(this[n],t,arguments)})})}function n(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function r(t,r,e,n){n.forEach(function(n){n in e.prototype&&(t.prototype[n]=function(){return t=this[r],(e=a(t,n,arguments)).then(function(t){if(t)return new u(t,e.request)});var t,e})})}function i(t){this._index=t}function u(t,e){this._cursor=t,this._request=e}function s(t){this._store=t}function c(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new c(n)}function f(t){this._db=t}t(i,"_index",["name","keyPath","multiEntry","unique"]),e(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),t(u,"_cursor",["direction","key","primaryKey","value"]),e(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(u.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),o(e._request).then(function(t){if(t)return new u(t,e._request)})})})}),s.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},t(s,"_store",["name","keyPath","indexNames","autoIncrement"]),e(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},t(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},t(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},t(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[s,i].forEach(function(t){a in t.prototype&&(t.prototype[a.replace("open","iterate")]=function(){var t,e=(t=arguments,Array.prototype.slice.call(t)),n=e[e.length-1],r=this._store||this._index,i=r[a].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,s].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var d={open:function(t,e,n){var r=a(indexedDB,"open",[t,e]),i=r.request;return i.onupgradeneeded=function(t){n&&n(new l(i.result,t.oldVersion,i.transaction))},r.then(function(t){return new f(t)})},delete:function(t){return a(indexedDB,"deleteDatabase",[t])}};void 0!==h?(h.exports=d,h.exports.default=h.exports):self.idb=d}()},{}],2:[function(t,e,n){var r=t("idb"),i="restaurants",a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(){var e=this;return fetch(a.DATABASE_URL+"/restaurants").then(function(t){return t.json()}).then(function(t){return e.putRestaurantsIntoIndexedDb(t).then(function(){return t})}).catch(function(t){return a.fetchRestaurantsFromIndexedDb().then(function(t){if(t.length)return t;throw new Error("Fetch error")})})}},{key:"fetchRestaurantWithReviews",value:function(e){var i=this;return Promise.all([this.fetchRestaurant(e),this.fetchRestaurantReviews(e)]).then(function(t){var e=_slicedToArray(t,2),n=e[0],r=e[1];return n.reviews=r,i.putRestaurantIntoIndexedDb(n).then(function(){return n})}).catch(function(t){return a.fetchRestaurantFromIndexedDb(e).then(function(t){if(t)return t;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(t){return fetch(a.DATABASE_URL+"/restaurants/"+t).then(function(t){return t.json()})}},{key:"fetchRestaurantReviews",value:function(t){return fetch(a.DATABASE_URL+"/reviews/?restaurant_id="+t).then(function(t){return t.json()})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return a.openDatabase().then(function(t){return t.transaction(i).objectStore(i).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(e){return a.openDatabase().then(function(t){return t.transaction(i).objectStore(i).get(+e)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return a.clearRestaurantsInIndexedDb().then(function(){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return n.forEach(function(t){return e.objectStore(i).put(t)}),e.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return e.objectStore(i).put(n),e.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return e.objectStore(i).clear(),e.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(i,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(t){return a.fetchRestaurantWithReviews(t)}},{key:"fetchRestaurantByCuisine",value:function(e,t){a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.cuisine_type==e})})}},{key:"fetchRestaurantByNeighborhood",value:function(e){return a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.neighborhood==e})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(t){var e=t;return"all"!=n&&(e=e.filter(function(t){return t.cuisine_type==n})),"all"!=r&&(e=e.filter(function(t){return t.neighborhood==r})),e})}},{key:"fetchNeighborhoodsAndCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(t,e){return n[e].neighborhood}),i=n.map(function(t,e){return n[e].cuisine_type});return{neighborhoods:r.filter(function(t,e){return r.indexOf(t)==e}),cuisines:i.filter(function(t,e){return i.indexOf(t)==e}),restaurants:n}})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"/img/"+t.id+"_small.jpg"}},{key:"imageSrcSetForRestaurant",value:function(t){return"/img/"+t.photograph}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:a.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}();e.exports=a},{idb:1}],3:[function(t,e,n){e.exports={registerServiceWorker:function(){}}},{}],4:[function(t,e,n){function r(t,e){if((e=e||{}).max=e.max||5,this.rating=document.querySelector(t),this.starList=[],this.rating){this.rating.setAttribute("aria-label",e.label),this.rating.setAttribute("tabindex","0"),this.rating.setAttribute("role","radiogroup"),this.rating.setAttribute("aria-valuenow",0),this.rating.setAttribute("aria-valuemin",0),this.rating.setAttribute("aria-valuemax",e.max),this.rating.className="rating-select";for(var n=1;n<=e.max;n++){var r=document.createElement("div");r.className="rating-select__item",r.setAttribute("role","radio"),r.setAttribute("aria-checked",!1),r.setAttribute("tabindex",0),r.setAttribute("data-value",n),this.starList.push(r),r.addEventListener("click",this.onRatingElementClick.bind(this)),this.rating.append(r)}this.rating.addEventListener("keydown",this.handleKeyDown.bind(this)),this.activeItemIdx=0,this.ratingInput=document.createElement("input"),this.ratingInput.setAttribute("value",0),this.ratingInput.setAttribute("name",e.inputName||"rating"),this.ratingInput.setAttribute("id",e.inputName||"review-rating"),this.ratingInput.setAttribute("type","hidden"),this.rating.append(this.ratingInput)}}r.prototype={onRatingElementClick:function(t){var n=this.starList.indexOf(t.target);if(-1!==!n){this.activeItemIdx=n,this.starList.map(function(t,e){t.classList.toggle("rating-select__item--checked",e<=n),e===n?(t.setAttribute("aria-checked",!0),t.setAttribute("tabindex",0)):(t.setAttribute("aria-checked",!1),t.setAttribute("tabindex",-1))});var e=t.target.getAttribute("data-value");this.rating.setAttribute("data-value",e),this.rating.setAttribute("aria-valuenow",e),this.ratingInput.setAttribute("value",e)}},handleKeyDown:function(t){var e=13,n=27,r=32,i=37,a=38,o=39,u=40;if(-1!==[u,a,r,e,i,o,n].indexOf(t.keyCode))switch(t.preventDefault(),t.keyCode){case u:case o:this.nextActiveListItem();break;case a:case i:this.previousActiveListItem();break;case r:case e:this.onRatingElementClick(t),this.rating.focus();break;case n:this.rating.focus()}},nextActiveListItem:function(){var t=this.activeItemIdx>=this.starList.length-1?0:this.activeItemIdx+1;this.starList[t].focus(),this.activeItemIdx=t},previousActiveListItem:function(){var t=0===this.activeItemIdx?this.starList.length-1:this.activeItemIdx-1;this.starList[t].focus(),this.activeItemIdx=t}},e.exports=r},{}],5:[function(t,e,n){var i=t("./dbhelper"),r=t("./process");new(t("./rating-select"))("#rating-select",{label:"Rating",max:5}),function(){var t=document.getElementById("send-rating-form");if(!t)return;t.onsubmit=function(t){t.preventDefault(),console.log("FOrm submited",t.target.elements)}}(),window.initMap=function(){r.registerServiceWorker(),function(){if(self.restaurant)return self.restaurant;var t=function(t,e){e||(e=window.location.href);t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))}("id");{if(t)return i.fetchRestaurantById(t).then(function(t){if(!t)throw new Error("No restaurant");return t});throw new Error("No restaurant id in URL")}}().then(function(t){self.restaurant=t,function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,e=document.getElementById("restaurant-name");e.innerHTML=t.name,e.setAttribute("tabindex","0"),document.getElementById("restaurant-address").innerHTML=t.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.setAttribute("alt","An image from the restaurant "+t.name),n.src=i.imageUrlForRestaurant(t);var r=document.getElementById("restaurant-cuisine");r.setAttribute("tabindex","0"),r.innerHTML=t.cuisine_type,t.operating_hours&&function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,e=document.getElementById("restaurant-hours");for(var n in t){var r=document.createElement("tr"),i=document.createElement("td");i.innerHTML=n,r.appendChild(i);var a=document.createElement("td");a.innerHTML=t[n],a.setAttribute("aria-label",t[n]+","),r.appendChild(a),e.appendChild(r)}}();!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,e=document.getElementById("reviews-container");if(!t){var n=document.createElement("p");return n.innerHTML="No reviews yet!",e.appendChild(n)}var r=document.getElementById("reviews-list");t.forEach(function(t){r.appendChild(function(t){var e=document.createElement("li");e.setAttribute("tabindex","0"),e.className="reviews-list-item",e.setAttribute("aria-label","review");var n=document.createElement("div");n.className="reviewer-info";var r=document.createElement("div");r.className="reviewer-info__name-date";var i=document.createElement("h3");i.setAttribute("tabindex","0"),i.setAttribute("aria-label",t.name),i.innerHTML=t.name;var a=document.createElement("date");a.setAttribute("tabindex","0"),a.innerHTML=new Date(t.updatedAt).toDateString(),r.appendChild(i),r.appendChild(a),n.appendChild(r),n.appendChild(function(t){var e=document.createElement("p");e.appendChild((n=document.createElement("span"),n.className="rating-number",n.setAttribute("tabindex","0"),n.innerHTML="Rating : "+t,n));var n;var r="★".repeat(+t);+t<5&&(r+="☆".repeat(5-+t));var i=document.createElement("span");return i.className="rating-stars",i.innerHTML=r,e.appendChild(i),e}(t.rating)),e.appendChild(n);var o=document.createElement("p");return o.setAttribute("tabindex","0"),o.className="reviewer-comment",o.innerHTML=t.comments,e.appendChild(o),e}(t))}),e.appendChild(r)}()}(),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,e=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=t.name,e.appendChild(n)}(),i.mapMarkerForRestaurant(self.restaurant,self.map)}).catch(function(t){console.error(t)})}},{"./dbhelper":2,"./process":3,"./rating-select":4}]},{},[5]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvcHJvY2Vzcy5qcyIsInNyYy9qcy9yYXRpbmctc2VsZWN0LmpzIiwic3JjL2pzL3Jlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN1bHQiLCJlcnJvciIsInJlcXVlc3QiLCJhcmdzIiwicmVqZWN0IiwicCIsInByb3AiLCJ2YWwiLCJhcmd1bWVudHMiLCJpbmRleCIsImN1cnNvciIsInN0b3JlIiwiaWRiVHJhbnNhY3Rpb24iLCJyZXNvbHZlIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJ0aGlzIiwiX3JlcXVlc3QiLCJhcnIiLCJfaW5kZXgiLCJ2YWx1ZSIsImNvbnRpbnVlIiwiaXRlbXMiLCJ2ZXJzaW9uIiwibmFtZSIsImV4cCIsImV4cG9ydHMiLCJpZGIiLCJyZXF1aXJlIiwiREJfUkVTVEFVUkFOVFNfVEFCTEUiLCJEQkhlbHBlciIsIl90aGlzIiwiREFUQUJBU0VfVVJMIiwidGhlbiIsImRhdGEiLCJqc29uIiwicmVzdGF1cmFudHMiLCJwdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIiLCJjYXRjaCIsImVyciIsImZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiIiwibGVuZ3RoIiwiRXJyb3IiLCJpZCIsIl90aGlzMiIsImFsbCIsImZldGNoUmVzdGF1cmFudCIsImZldGNoUmVzdGF1cmFudFJldmlld3MiLCJfcmVmIiwiX3JlZjIiLCJfc2xpY2VkVG9BcnJheSIsInJlc3RhdXJhbnQiLCJyZXZpZXdzIiwicHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIiLCJmZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiIiwicmVzdGF1cmFudElkIiwib3BlbkRhdGFiYXNlIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJnZXQiLCJjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIiLCJ0eCIsImZvckVhY2giLCJwdXQiLCJjb21wbGV0ZSIsImNsZWFyIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MiLCJjdWlzaW5lIiwiY2FsbGJhY2siLCJmZXRjaFJlc3RhdXJhbnRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsInJlc3VsdHMiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJjdWlzaW5lcyIsImluZGV4T2YiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsImxhdGxuZyIsInVybEZvclJlc3RhdXJhbnQiLCJBbmltYXRpb24iLCJEUk9QIiwibW9kdWxlIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwiUmF0aW5nU2VsZWN0Iiwic2VsZWN0b3IiLCJvcHRpb25zIiwibWF4IiwicmF0aW5nIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3Rhckxpc3QiLCJzZXRBdHRyaWJ1dGUiLCJsYWJlbCIsImNsYXNzTmFtZSIsInN0YXIiLCJjcmVhdGVFbGVtZW50IiwicHVzaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvblJhdGluZ0VsZW1lbnRDbGljayIsImJpbmQiLCJhcHBlbmQiLCJoYW5kbGVLZXlEb3duIiwiYWN0aXZlSXRlbUlkeCIsInJhdGluZ0lucHV0IiwiaW5wdXROYW1lIiwicHJvdG90eXBlIiwiZSIsImNsaWNrZWRTdGFySW5kZXgiLCJ0YXJnZXQiLCJlbCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImdldEF0dHJpYnV0ZSIsIlZLX0VOVEVSIiwiVktfRVNDIiwiVktfU1BBQ0UiLCJWS19MRUZUIiwiVktfVVAiLCJWS19SSUdIVCIsIlZLX0RPV04iLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJuZXh0QWN0aXZlTGlzdEl0ZW0iLCJwcmV2aW91c0FjdGl2ZUxpc3RJdGVtIiwiZm9jdXMiLCJuZXh0RWxlbWVudEluZGV4IiwicHJldkVsZW1lbnRJbmRleCIsInByb2Nlc3MiLCJmb3JtIiwiZ2V0RWxlbWVudEJ5SWQiLCJvbnN1Ym1pdCIsImxvZyIsImVsZW1lbnRzIiwicmF0aW5nRm9ybSIsIndpbmRvdyIsImluaXRNYXAiLCJzZWxmIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwidW5kZWZpbmVkIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwib3BlcmF0aW5nX2hvdXJzIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwidWwiLCJyZXZpZXciLCJsaSIsInJldmlld2VySW5mb0Jsb2NrIiwicmV2aWV3ZXJOYW1lRGF0ZSIsImRhdGUiLCJEYXRlIiwidXBkYXRlZEF0IiwidG9EYXRlU3RyaW5nIiwicmF0aW5nVmFsdWUiLCJzcGFuIiwicmF0aW5nU3RhcnMiLCJyZXBlYXQiLCJyYXRpbmdTdGFyc0VsZW1lbnQiLCJjcmVhdGVSYXRpbmdTdGFyc0Jsb2NrIiwiY29tbWVudHMiLCJjcmVhdGVSZXZpZXdIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiTWFwIiwiYnJlYWRjcnVtYiIsImZpbGxCcmVhZGNydW1iIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCJdLCJtYXBwaW5ncyI6Im9zQ0FBQSwyR0NXQUEsa0NBSUFDLGdDQU1BQywrQ0FFQUMsV0FDQUMsc0JBR0FGLEVBQ0FHLDZHQWVBQywrQkFHQUMsaUhBVUFDLHNJQVNBQSxnSUFTQUEsbURBdkNB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InNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cbiAgZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0oKSk7XG4iLCJjb25zdCBpZGIgPSByZXF1aXJlKCdpZGInKTtcclxuY29uc3QgQVBQX0RCX05BTUUgPSAncmVzdGF1cmFudHMtZGInO1xyXG5jb25zdCBEQl9SRVNUQVVSQU5UU19UQUJMRSA9ICdyZXN0YXVyYW50cyc7XHJcbmNvbnN0IEFQUF9EQl9WRVIgPSAxO1xyXG5cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cygpIHtcclxuICAgIHJldHVybiBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAnL3Jlc3RhdXJhbnRzJylcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYihyZXN0YXVyYW50cykudGhlbigoKSA9PiByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYigpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgICAgaWYgKCFyZXN0YXVyYW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGZXRjaCBlcnJvcicpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50IGJ5IGlkIHdpdGggcmV2aWV3cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MoaWQpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbXHJcbiAgICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50KGlkKSxcclxuICAgICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRSZXZpZXdzKGlkKVxyXG4gICAgXSkudGhlbigoWyByZXN0YXVyYW50LCByZXZpZXdzIF0pID0+IHtcclxuICAgICAgcmVzdGF1cmFudC5yZXZpZXdzID0gcmV2aWV3cztcclxuICAgICAgcmV0dXJuIHRoaXMucHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIocmVzdGF1cmFudCkudGhlbigoKSA9PiByZXN0YXVyYW50KTtcclxuICAgIH0pLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiKGlkKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGZXRjaCBlcnJvcicpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50KGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50cy8ke2lkfWApXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudFJldmlld3MocmVzdGF1cmFudElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7cmVzdGF1cmFudElkfWApXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiKCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpXHJcbiAgICAgIC50aGVuKGRiID0+IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuZ2V0QWxsKCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEZyb21JbmRleGVkRGIoaWQpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+XHJcbiAgICAgIGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuZ2V0KCtpZCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYihyZXN0YXVyYW50cykge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpLnRoZW4oKCkgPT4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkucHV0KHJlc3RhdXJhbnQpKTtcclxuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgdHgub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLmNsZWFyKCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG9wZW5EYXRhYmFzZSgpIHtcclxuICAgIHJldHVybiBpZGIub3BlbihBUFBfREJfTkFNRSwgQVBQX0RCX1ZFUiwgKHVwZ3JhZGVEYikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgY2FzZSAwIDpcclxuICAgICAgICAgIGNvbnN0IHJlc3RhdXJhbnRTdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSwge2tleVBhdGg6ICdpZCd9KTtcclxuICAgICAgICAgIHJlc3RhdXJhbnRTdG9yZS5jcmVhdGVJbmRleCgnc3RhdHVzJywgJ3N0YXR1cycpO1xyXG4gICAgICAgIC8vIGJyZWFrIG9taXR0ZWRcclxuICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXdzKGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xyXG5cclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcblxyXG4gICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5laWdoYm9yaG9vZHM6IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSksXHJcbiAgICAgICAgY3Vpc2luZXM6IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKSxcclxuICAgICAgICByZXN0YXVyYW50cyxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQuaWR9X3NtYWxsLmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VTcmNTZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IERCSGVscGVyOyIsIi8qIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyIHdpdGggZXZlbnRzICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpIHtcclxuXHJcbiAgcmV0dXJuO1xyXG5cclxuICBpZiAoISdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignc2VydmljZVdvcmtlciBub3QgcmVnaXN0ZXInKTtcclxuICB9XHJcblxyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uIChyZWcpIHtcclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAocmVnLmFjdGl2ZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnVGhlcmUgaXMgYW4gYW4gYWN0aXZlIHNlcnZpY2Ugd29ya2VyJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZy53YWl0aW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCd3YWl0aW5nIDonLCByZWcud2FpdGluZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBpcyB3YWl0aW5nJyk7XHJcbiAgICAgIHVwZGF0ZVNlcnZpY2VXb3JrZXIocmVnLndhaXRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWcuaW5zdGFsbGluZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnaW5zdGFsbGluZyA6ICcsIHJlZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBzdGF0dXMgaXMgaW5zdGFsbGluZycpO1xyXG4gICAgICB0cmFja0luc3RhbGxpbmcocmVnLmluc3RhbGxpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHVwZGF0ZSBmb3VuZCcsIHJlZyk7XHJcbiAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgcmVmcmVzaGluZztcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlmIChyZWZyZXNoaW5nKSByZXR1cm47XHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICByZWZyZXNoaW5nID0gdHJ1ZTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZygnUmVnaXN0cmF0aW9uIGZhaWxlZCB3aXRoICcgKyBlcnJvcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyYWNrSW5zdGFsbGluZyhpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgaWYgKCFpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgICBjb25zb2xlLmxvZygnV29ya2VyIG5vdCBkZWZpbmVkIScpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBpbnN0YWxsaW5nV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgc3RhdGUgd2FzIGNoYW5nZWQgdG8gJyArIGluc3RhbGxpbmdXb3JrZXIuc3RhdGUpO1xyXG4gICAgaWYgKGluc3RhbGxpbmdXb3JrZXIuc3RhdGUgPT09ICdpbnN0YWxsZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlIHdvcmtlciBpbnN0YWxsZWQgYW5kIHdhaXRpbmcgZm9yIGFjdGl2YXRpb24nLCBpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgICAgdXBkYXRlU2VydmljZVdvcmtlcihpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU2VydmljZVdvcmtlcih3b3JrZXIpIHtcclxuICBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcih7YWN0aW9uOiAnc2tpcFdhaXRpbmcnfSwgd29ya2VyKVxyXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlRnJvbVN3KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlRnJvbVN3KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcihtc2csIHdvcmtlcikge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB2YXIgbXNnQ2hhbiA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG5cclxuICAgIC8vIEhhbmRsZXIgZm9yIHJlY2lldmluZyBtZXNzYWdlIHJlcGx5IGZyb20gc2VydmljZSB3b3JrZXJcclxuICAgIG1zZ0NoYW4ucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGlmIChldmVudC5kYXRhLmVycm9yKSB7XHJcbiAgICAgICAgcmVqZWN0KGV2ZW50LmRhdGEuZXJyb3IpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc29sdmUoZXZlbnQuZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gc2VydmljZSB3b3JrZXIgYWxvbmcgd2l0aCBwb3J0IGZvciByZXBseVxyXG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKG1zZywgW21zZ0NoYW4ucG9ydDJdKTtcclxuICB9KTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyLFxyXG59OyIsIlxuZnVuY3Rpb24gUmF0aW5nU2VsZWN0KHNlbGVjdG9yLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBvcHRpb25zLm1heCA9IG9wdGlvbnMubWF4IHx8IDU7XG5cbiAgdGhpcy5yYXRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgdGhpcy5zdGFyTGlzdCA9IFtdO1xuXG4gIGlmICghdGhpcy5yYXRpbmcpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBvcHRpb25zLmxhYmVsKTtcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgncm9sZScsICdyYWRpb2dyb3VwJyk7XG4gIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW5vdycsIDApO1xuICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWVtaW4nLCAwKTtcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbWF4Jywgb3B0aW9ucy5tYXgpO1xuICB0aGlzLnJhdGluZy5jbGFzc05hbWUgPSAncmF0aW5nLXNlbGVjdCc7XG5cbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gb3B0aW9ucy5tYXg7IGkrKykge1xuICAgIGNvbnN0IHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzdGFyLmNsYXNzTmFtZSA9ICdyYXRpbmctc2VsZWN0X19pdGVtJztcbiAgICBzdGFyLnNldEF0dHJpYnV0ZSgncm9sZScsICdyYWRpbycpO1xuICAgIHN0YXIuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBpKTtcbiAgICB0aGlzLnN0YXJMaXN0LnB1c2goc3Rhcik7XG4gICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25SYXRpbmdFbGVtZW50Q2xpY2suYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yYXRpbmcuYXBwZW5kKHN0YXIpO1xuICB9XG5cbiAgdGhpcy5yYXRpbmcuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpKTtcbiAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gMDtcblxuICB0aGlzLnJhdGluZ0lucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgMCk7XG4gIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgb3B0aW9ucy5pbnB1dE5hbWUgfHwgJ3JhdGluZycpO1xuICB0aGlzLnJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBvcHRpb25zLmlucHV0TmFtZSB8fCAncmV2aWV3LXJhdGluZycpO1xuICB0aGlzLnJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdoaWRkZW4nKTtcbiAgdGhpcy5yYXRpbmcuYXBwZW5kKHRoaXMucmF0aW5nSW5wdXQpO1xufVxuXG5SYXRpbmdTZWxlY3QucHJvdG90eXBlID0ge1xuXG4gIG9uUmF0aW5nRWxlbWVudENsaWNrKGUpIHtcbiAgICBjb25zdCBjbGlja2VkU3RhckluZGV4ID0gdGhpcy5zdGFyTGlzdC5pbmRleE9mKGUudGFyZ2V0KTtcblxuICAgIGlmICghY2xpY2tlZFN0YXJJbmRleCA9PT0gLTEpIHJldHVybjtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSBjbGlja2VkU3RhckluZGV4O1xuXG4gICAgdGhpcy5zdGFyTGlzdC5tYXAoKGVsLCBpKSA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKCdyYXRpbmctc2VsZWN0X19pdGVtLS1jaGVja2VkJywgaSA8PSBjbGlja2VkU3RhckluZGV4KTtcbiAgICAgIGlmIChpID09PSBjbGlja2VkU3RhckluZGV4KSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgdHJ1ZSk7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgZmFsc2UpO1xuICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgLTEpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHZhbCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xuICAgIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScsIHZhbCk7XG4gICAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgdmFsKTtcbiAgICB0aGlzLnJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCB2YWwpO1xuXG4gIH0sXG5cbiAgaGFuZGxlS2V5RG93bihlKSB7XG4gICAgLy8gRGVmaW5lIHZhbHVlcyBmb3Iga2V5Y29kZXNcbiAgICBjb25zdCBWS19FTlRFUiA9IDEzO1xuICAgIGNvbnN0IFZLX0VTQyA9IDI3O1xuICAgIGNvbnN0IFZLX1NQQUNFID0gMzI7XG4gICAgY29uc3QgVktfTEVGVCA9IDM3O1xuICAgIGNvbnN0IFZLX1VQID0gMzg7XG4gICAgY29uc3QgVktfUklHSFQgPSAzOTtcbiAgICBjb25zdCBWS19ET1dOID0gNDA7XG5cbiAgICBpZiAoW1ZLX0RPV04sIFZLX1VQLCBWS19TUEFDRSwgVktfRU5URVIsIFZLX0xFRlQsIFZLX1JJR0hULCBWS19FU0NdLmluZGV4T2YoZS5rZXlDb2RlKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICBjYXNlIFZLX0RPV046XG4gICAgICBjYXNlIFZLX1JJR0hUOlxuICAgICAgICB0aGlzLm5leHRBY3RpdmVMaXN0SXRlbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfVVA6XG4gICAgICBjYXNlIFZLX0xFRlQ6XG4gICAgICAgIHRoaXMucHJldmlvdXNBY3RpdmVMaXN0SXRlbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfU1BBQ0U6XG4gICAgICAgIHRoaXMub25SYXRpbmdFbGVtZW50Q2xpY2soZSk7XG4gICAgICAgIHRoaXMucmF0aW5nLmZvY3VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19FTlRFUjpcbiAgICAgICAgdGhpcy5vblJhdGluZ0VsZW1lbnRDbGljayhlKTtcbiAgICAgICAgdGhpcy5yYXRpbmcuZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFZLX0VTQzpcbiAgICAgICAgdGhpcy5yYXRpbmcuZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuO1xuICB9LFxuXG4gIG5leHRBY3RpdmVMaXN0SXRlbSgpIHtcbiAgICBjb25zdCBuZXh0RWxlbWVudEluZGV4ID0gKHRoaXMuYWN0aXZlSXRlbUlkeCA+PSB0aGlzLnN0YXJMaXN0Lmxlbmd0aCAtIDEpID8gMCA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggKyAxKTtcbiAgICB0aGlzLnN0YXJMaXN0W25leHRFbGVtZW50SW5kZXhdLmZvY3VzKCk7XG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gbmV4dEVsZW1lbnRJbmRleDtcbiAgfSxcblxuICBwcmV2aW91c0FjdGl2ZUxpc3RJdGVtKCkge1xuICAgIGNvbnN0IHByZXZFbGVtZW50SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSWR4ID09PSAwKSA/IHRoaXMuc3Rhckxpc3QubGVuZ3RoIC0gMSA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggLSAxKTtcbiAgICB0aGlzLnN0YXJMaXN0W3ByZXZFbGVtZW50SW5kZXhdLmZvY3VzKCk7XG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gcHJldkVsZW1lbnRJbmRleDtcbiAgfSxcblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFJhdGluZ1NlbGVjdDsiLCJjb25zdCBEQkhlbHBlciA9IHJlcXVpcmUoJy4vZGJoZWxwZXInKTtcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKCcuL3Byb2Nlc3MnKTtcbmNvbnN0IFJhdGluZ1NlbGVjdCA9IHJlcXVpcmUoJy4vcmF0aW5nLXNlbGVjdCcpO1xuXG5sZXQgcmVzdGF1cmFudDtcbnZhciBtYXA7XG5cbmNyZWF0ZVJhdGluZ1NlbGVjdCgpO1xucmF0aW5nRm9ybSgpO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIHByb2Nlc3MucmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xuICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG5cbiAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcblxuICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgIHpvb206IDE2LFxuICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICAgIH0pO1xuXG4gICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuXG4gIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICB9KTtcbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKCkge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIHJldHVybiBzZWxmLnJlc3RhdXJhbnQ7XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyByZXN0YXVyYW50IGlkIGluIFVSTCcpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkKS50aGVuKChyZXN0YXVyYW50KSA9PiB7XG5cbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3RhdXJhbnQnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnQ7XG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpIHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIG5hbWUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBgQW4gaW1hZ2UgZnJvbSB0aGUgcmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX1gKTtcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGN1aXNpbmUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICB0aW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIG9wZXJhdGluZ0hvdXJzW2tleV0gKyAnLCcpOyAvLyBmb3Igc2NyZWVuIHJlYWRlclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZ1bmN0aW9uIGZpbGxSZXZpZXdzSFRNTChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpIHtcblxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSB7XG5cbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgbGkuY2xhc3NOYW1lID0gJ3Jldmlld3MtbGlzdC1pdGVtJztcbiAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ3JldmlldycpO1xuXG4gIGNvbnN0IHJldmlld2VySW5mb0Jsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJldmlld2VySW5mb0Jsb2NrLmNsYXNzTmFtZSA9ICdyZXZpZXdlci1pbmZvJztcblxuICBjb25zdCByZXZpZXdlck5hbWVEYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJldmlld2VyTmFtZURhdGUuY2xhc3NOYW1lID0gJ3Jldmlld2VyLWluZm9fX25hbWUtZGF0ZSc7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG4gIG5hbWUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIG5hbWUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcmV2aWV3Lm5hbWUpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkYXRlJyk7XG4gIGRhdGUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCkudG9EYXRlU3RyaW5nKCk7XG5cbiAgcmV2aWV3ZXJOYW1lRGF0ZS5hcHBlbmRDaGlsZChuYW1lKTtcbiAgcmV2aWV3ZXJOYW1lRGF0ZS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICByZXZpZXdlckluZm9CbG9jay5hcHBlbmRDaGlsZChyZXZpZXdlck5hbWVEYXRlKTtcblxuICByZXZpZXdlckluZm9CbG9jay5hcHBlbmRDaGlsZChjcmVhdGVSYXRpbmdTdGFyc0Jsb2NrKHJldmlldy5yYXRpbmcpKTtcblxuICBsaS5hcHBlbmRDaGlsZChyZXZpZXdlckluZm9CbG9jayk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBjb21tZW50cy5jbGFzc05hbWUgPSAncmV2aWV3ZXItY29tbWVudCc7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmF0aW5nU3RhcnNCbG9jayhyYXRpbmdWYWx1ZSkge1xuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG5cbiAgcmF0aW5nLmFwcGVuZENoaWxkKCgoKSA9PiB7XG4gICAgbGV0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgc3Bhbi5jbGFzc05hbWUgPSAncmF0aW5nLW51bWJlcic7XG4gICAgc3Bhbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICBzcGFuLmlubmVySFRNTCA9ICdSYXRpbmcgOiAnICsgcmF0aW5nVmFsdWU7XG4gICAgcmV0dXJuIHNwYW47XG4gIH0pKCkpO1xuXG4gIGxldCByYXRpbmdTdGFycyA9ICfimIUnLnJlcGVhdCgrcmF0aW5nVmFsdWUpO1xuXG4gIGlmICgrcmF0aW5nVmFsdWUgPCA1KSB7XG4gICAgcmF0aW5nU3RhcnMgPSByYXRpbmdTdGFycyArICfimIYnLnJlcGVhdCg1IC0gK3JhdGluZ1ZhbHVlKTtcbiAgfVxuICBjb25zdCByYXRpbmdTdGFyc0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIHJhdGluZ1N0YXJzRWxlbWVudC5jbGFzc05hbWUgPSAncmF0aW5nLXN0YXJzJztcbiAgcmF0aW5nU3RhcnNFbGVtZW50LmlubmVySFRNTCA9IHJhdGluZ1N0YXJzO1xuICByYXRpbmcuYXBwZW5kQ2hpbGQocmF0aW5nU3RhcnNFbGVtZW50KTtcblxuICByZXR1cm4gcmF0aW5nO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJhdGluZ1NlbGVjdCgpIHtcbiAgY29uc3Qgc2VsZWN0ID0gbmV3IFJhdGluZ1NlbGVjdCgnI3JhdGluZy1zZWxlY3QnLCB7XG4gICAgbGFiZWw6ICdSYXRpbmcnLFxuICAgIG1heDogNSxcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJhdGluZ0Zvcm0oKSB7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VuZC1yYXRpbmctZm9ybScpO1xuICBpZiAoIWZvcm0pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9ybS5vbnN1Ym1pdCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc29sZS5sb2coJ0ZPcm0gc3VibWl0ZWQnLCBlLnRhcmdldC5lbGVtZW50cyk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUgKG5hbWUsIHVybCkge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICghcmVzdWx0c1syXSkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG4iXX0=
