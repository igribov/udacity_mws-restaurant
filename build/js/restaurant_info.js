"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function a(o,u,s){function c(e,t){if(!u[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var i=u[e]={exports:{}};o[e][0].call(i.exports,function(t){return c(o[e][1][t]||t)},i,i.exports,a,o,u,s)}return u[e].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)c(s[t]);return c}({1:[function(t,h,e){!function(){function o(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function a(n,r,i){var a,t=new Promise(function(t,e){o(a=n[r].apply(n,i)).then(t,e)});return t.request=a,t}function t(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function e(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return a(this[n],t,arguments)})})}function n(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function r(t,r,e,n){n.forEach(function(n){n in e.prototype&&(t.prototype[n]=function(){return t=this[r],(e=a(t,n,arguments)).then(function(t){if(t)return new u(t,e.request)});var t,e})})}function i(t){this._index=t}function u(t,e){this._cursor=t,this._request=e}function s(t){this._store=t}function c(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new c(n)}function f(t){this._db=t}t(i,"_index",["name","keyPath","multiEntry","unique"]),e(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),t(u,"_cursor",["direction","key","primaryKey","value"]),e(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(u.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),o(e._request).then(function(t){if(t)return new u(t,e._request)})})})}),s.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},t(s,"_store",["name","keyPath","indexNames","autoIncrement"]),e(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},t(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},t(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},t(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[s,i].forEach(function(t){a in t.prototype&&(t.prototype[a.replace("open","iterate")]=function(){var t,e=(t=arguments,Array.prototype.slice.call(t)),n=e[e.length-1],r=this._store||this._index,i=r[a].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,s].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var d={open:function(t,e,n){var r=a(indexedDB,"open",[t,e]),i=r.request;return i.onupgradeneeded=function(t){n&&n(new l(i.result,t.oldVersion,i.transaction))},r.then(function(t){return new f(t)})},delete:function(t){return a(indexedDB,"deleteDatabase",[t])}};void 0!==h?(h.exports=d,h.exports.default=h.exports):self.idb=d}()},{}],2:[function(t,e,n){var r=t("idb"),i="restaurants",a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(){var e=this;return fetch(a.DATABASE_URL+"/restaurants").then(function(t){return t.json()}).then(function(t){return e.putRestaurantsIntoIndexedDb(t).then(function(){return t})}).catch(function(t){return a.fetchRestaurantsFromIndexedDb().then(function(t){if(t.length)return t;throw new Error("Fetch error")})})}},{key:"fetchRestaurantWithReviews",value:function(e){var i=this;return Promise.all([this.fetchRestaurant(e),this.fetchRestaurantReviews(e)]).then(function(t){var e=_slicedToArray(t,2),n=e[0],r=e[1];return n.reviews=r,i.putRestaurantIntoIndexedDb(n).then(function(){return n})}).catch(function(t){return a.fetchRestaurantFromIndexedDb(e).then(function(t){if(t)return t;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(t){return fetch(a.DATABASE_URL+"/restaurants/"+t).then(function(t){return t.json()})}},{key:"fetchRestaurantReviews",value:function(t){return fetch(a.DATABASE_URL+"/reviews/?restaurant_id="+t).then(function(t){return t.json()})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return a.openDatabase().then(function(t){return t.transaction(i).objectStore(i).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(e){return a.openDatabase().then(function(t){return t.transaction(i).objectStore(i).get(+e)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return a.clearRestaurantsInIndexedDb().then(function(){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return n.forEach(function(t){return e.objectStore(i).put(t)}),e.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return e.objectStore(i).put(n),e.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return a.openDatabase().then(function(t){var e=t.transaction(i,"readwrite");return e.objectStore(i).clear(),e.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore(i,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(t){return a.fetchRestaurantWithReviews(t)}},{key:"fetchRestaurantByCuisine",value:function(e,t){a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.cuisine_type==e})})}},{key:"fetchRestaurantByNeighborhood",value:function(e){return a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.neighborhood==e})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(t){var e=t;return"all"!=n&&(e=e.filter(function(t){return t.cuisine_type==n})),"all"!=r&&(e=e.filter(function(t){return t.neighborhood==r})),e})}},{key:"saveReview",value:function(t){fetch(a.DATABASE_URL+"/reviews/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(t){return t.json()}).catch(function(t){console.log("errr")})}},{key:"fetchNeighborhoodsAndCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(t,e){return n[e].neighborhood}),i=n.map(function(t,e){return n[e].cuisine_type});return{neighborhoods:r.filter(function(t,e){return r.indexOf(t)==e}),cuisines:i.filter(function(t,e){return i.indexOf(t)==e}),restaurants:n}})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"/img/"+t.id+"_small.jpg"}},{key:"imageSrcSetForRestaurant",value:function(t){return"/img/"+t.photograph}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:a.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}();e.exports=a},{idb:1}],3:[function(t,e,n){e.exports={registerServiceWorker:function(){}}},{}],4:[function(t,e,n){function r(t,e){if((e=e||{}).max=e.max||5,this.rating=document.querySelector(t),this.starList=[],this.rating){this.rating.setAttribute("aria-label",e.label),this.rating.setAttribute("tabindex","0"),this.rating.setAttribute("role","radiogroup"),this.rating.setAttribute("aria-valuenow",0),this.rating.setAttribute("aria-valuemin",0),this.rating.setAttribute("aria-valuemax",e.max),this.rating.className="rating-select";for(var n=1;n<=e.max;n++){var r=document.createElement("div");r.className="rating-select__item",r.setAttribute("role","radio"),r.setAttribute("aria-checked",!1),r.setAttribute("tabindex",0),r.setAttribute("data-value",n),this.starList.push(r),r.addEventListener("click",this.onRatingElementClick.bind(this)),this.rating.append(r)}this.rating.addEventListener("keydown",this.handleKeyDown.bind(this)),this.activeItemIdx=0,this.ratingInput=document.createElement("input"),this.ratingInput.setAttribute("value",0),this.ratingInput.setAttribute("name",e.inputName||"rating"),this.ratingInput.setAttribute("id",e.inputName||"rating"),this.ratingInput.setAttribute("type","hidden"),this.rating.append(this.ratingInput)}}r.prototype={onRatingElementClick:function(t){var n=this.starList.indexOf(t.target);if(-1!==!n){this.activeItemIdx=n,this.starList.map(function(t,e){t.classList.toggle("rating-select__item--checked",e<=n),e===n?(t.setAttribute("aria-checked",!0),t.setAttribute("tabindex",0)):(t.setAttribute("aria-checked",!1),t.setAttribute("tabindex",-1))});var e=t.target.getAttribute("data-value");this.rating.setAttribute("data-value",e),this.rating.setAttribute("aria-valuenow",e),this.ratingInput.setAttribute("value",e)}},handleKeyDown:function(t){var e=13,n=27,r=32,i=37,a=38,o=39,u=40;if(-1!==[u,a,r,e,i,o,n].indexOf(t.keyCode))switch(t.preventDefault(),t.keyCode){case u:case o:this.nextActiveListItem();break;case a:case i:this.previousActiveListItem();break;case r:case e:this.onRatingElementClick(t),this.rating.focus();break;case n:this.rating.focus()}},nextActiveListItem:function(){var t=this.activeItemIdx>=this.starList.length-1?0:this.activeItemIdx+1;this.starList[t].focus(),this.activeItemIdx=t},previousActiveListItem:function(){var t=0===this.activeItemIdx?this.starList.length-1:this.activeItemIdx-1;this.starList[t].focus(),this.activeItemIdx=t}},e.exports=r},{}],5:[function(t,e,n){var o=t("./dbhelper"),r=t("./process");new(t("./rating-select"))("#rating-select",{label:"Rating",max:5}),function(){var t=document.getElementById("send-rating-form");if(!t)return;t.onsubmit=function(t){t.preventDefault();var e=t.target.elements,n=e.name.value,r=e.rating.value,i=e.comments.value,a={restaurant_id:self.restaurant.id,name:n,rating:r,comments:i};o.saveReview(a)}}(),window.initMap=function(){r.registerServiceWorker(),function(){if(self.restaurant)return self.restaurant;var t=function(t,e){e||(e=window.location.href);t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))}("id");{if(t)return o.fetchRestaurantById(t).then(function(t){if(!t)throw new Error("No restaurant");return t});throw new Error("No restaurant id in URL")}}().then(function(t){self.restaurant=t,function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,e=document.getElementById("restaurant-name");e.innerHTML=t.name,e.setAttribute("tabindex","0"),document.getElementById("restaurant-address").innerHTML=t.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.setAttribute("alt","An image from the restaurant "+t.name),n.src=o.imageUrlForRestaurant(t);var r=document.getElementById("restaurant-cuisine");r.setAttribute("tabindex","0"),r.innerHTML=t.cuisine_type,t.operating_hours&&function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,e=document.getElementById("restaurant-hours");for(var n in t){var r=document.createElement("tr"),i=document.createElement("td");i.innerHTML=n,r.appendChild(i);var a=document.createElement("td");a.innerHTML=t[n],a.setAttribute("aria-label",t[n]+","),r.appendChild(a),e.appendChild(r)}}();!function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,e=document.getElementById("reviews-container");if(!t){var n=document.createElement("p");return n.innerHTML="No reviews yet!",e.appendChild(n)}var r=document.getElementById("reviews-list");t.forEach(function(t){r.appendChild(function(t){var e=document.createElement("li");e.setAttribute("tabindex","0"),e.className="reviews-list-item",e.setAttribute("aria-label","review");var n=document.createElement("div");n.className="reviewer-info";var r=document.createElement("div");r.className="reviewer-info__name-date";var i=document.createElement("h3");i.setAttribute("tabindex","0"),i.setAttribute("aria-label",t.name),i.innerHTML=t.name;var a=document.createElement("date");a.setAttribute("tabindex","0"),a.innerHTML=new Date(t.updatedAt).toDateString(),r.appendChild(i),r.appendChild(a),n.appendChild(r),n.appendChild(function(t){var e=document.createElement("p");e.appendChild((n=document.createElement("span"),n.className="rating-number",n.setAttribute("tabindex","0"),n.innerHTML="Rating : "+t,n));var n;var r="★".repeat(+t);+t<5&&(r+="☆".repeat(5-+t));var i=document.createElement("span");return i.className="rating-stars",i.innerHTML=r,e.appendChild(i),e}(t.rating)),e.appendChild(n);var o=document.createElement("p");return o.setAttribute("tabindex","0"),o.className="reviewer-comment",o.innerHTML=t.comments,e.appendChild(o),e}(t))}),e.appendChild(r)}()}(),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,e=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=t.name,e.appendChild(n)}(),o.mapMarkerForRestaurant(self.restaurant,self.map)}).catch(function(t){console.error(t)})}},{"./dbhelper":2,"./process":3,"./rating-select":4}]},{},[5]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvcHJvY2Vzcy5qcyIsInNyYy9qcy9yYXRpbmctc2VsZWN0LmpzIiwic3JjL2pzL3Jlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN1bHQiLCJlcnJvciIsInJlcXVlc3QiLCJhcmdzIiwicmVqZWN0IiwicCIsInByb3AiLCJ2YWwiLCJhcmd1bWVudHMiLCJpbmRleCIsImN1cnNvciIsInN0b3JlIiwiaWRiVHJhbnNhY3Rpb24iLCJyZXNvbHZlIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJ0aGlzIiwiX3JlcXVlc3QiLCJhcnIiLCJfaW5kZXgiLCJ2YWx1ZSIsImNvbnRpbnVlIiwiaXRlbXMiLCJ2ZXJzaW9uIiwibmFtZSIsImV4cCIsImV4cG9ydHMiLCJpZGIiLCJyZXF1aXJlIiwiREJfUkVTVEFVUkFOVFNfVEFCTEUiLCJEQkhlbHBlciIsIl90aGlzIiwiREFUQUJBU0VfVVJMIiwidGhlbiIsImRhdGEiLCJqc29uIiwicmVzdGF1cmFudHMiLCJwdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIiLCJjYXRjaCIsImVyciIsImZldGNoUmVzdGF1cmFudHNGcm9tSW5kZXhlZERiIiwibGVuZ3RoIiwiRXJyb3IiLCJpZCIsIl90aGlzMiIsImFsbCIsImZldGNoUmVzdGF1cmFudCIsImZldGNoUmVzdGF1cmFudFJldmlld3MiLCJfcmVmIiwiX3JlZjIiLCJfc2xpY2VkVG9BcnJheSIsInJlc3RhdXJhbnQiLCJyZXZpZXdzIiwicHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIiLCJmZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiIiwicmVzdGF1cmFudElkIiwib3BlbkRhdGFiYXNlIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJnZXQiLCJjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIiLCJ0eCIsImZvckVhY2giLCJwdXQiLCJjb21wbGV0ZSIsImNsZWFyIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MiLCJjdWlzaW5lIiwiY2FsbGJhY2siLCJmZXRjaFJlc3RhdXJhbnRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsInJlc3VsdHMiLCJyZXZpZXciLCJmZXRjaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJsb2ciLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJjdWlzaW5lcyIsImluZGV4T2YiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsImxhdGxuZyIsInVybEZvclJlc3RhdXJhbnQiLCJBbmltYXRpb24iLCJEUk9QIiwibW9kdWxlIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwiUmF0aW5nU2VsZWN0Iiwic2VsZWN0b3IiLCJvcHRpb25zIiwibWF4IiwicmF0aW5nIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3Rhckxpc3QiLCJzZXRBdHRyaWJ1dGUiLCJsYWJlbCIsImNsYXNzTmFtZSIsInN0YXIiLCJjcmVhdGVFbGVtZW50IiwicHVzaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvblJhdGluZ0VsZW1lbnRDbGljayIsImJpbmQiLCJhcHBlbmQiLCJoYW5kbGVLZXlEb3duIiwiYWN0aXZlSXRlbUlkeCIsInJhdGluZ0lucHV0IiwiaW5wdXROYW1lIiwicHJvdG90eXBlIiwiZSIsImNsaWNrZWRTdGFySW5kZXgiLCJ0YXJnZXQiLCJlbCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImdldEF0dHJpYnV0ZSIsIlZLX0VOVEVSIiwiVktfRVNDIiwiVktfU1BBQ0UiLCJWS19MRUZUIiwiVktfVVAiLCJWS19SSUdIVCIsIlZLX0RPV04iLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJuZXh0QWN0aXZlTGlzdEl0ZW0iLCJwcmV2aW91c0FjdGl2ZUxpc3RJdGVtIiwiZm9jdXMiLCJuZXh0RWxlbWVudEluZGV4IiwicHJldkVsZW1lbnRJbmRleCIsInByb2Nlc3MiLCJmb3JtIiwiZ2V0RWxlbWVudEJ5SWQiLCJvbnN1Ym1pdCIsIl9lJHRhcmdldCRlbGVtZW50cyIsImVsZW1lbnRzIiwiY29tbWVudHMiLCJyZXN0YXVyYW50X2lkIiwic2VsZiIsInNhdmVSZXZpZXciLCJyYXRpbmdGb3JtIiwid2luZG93IiwiaW5pdE1hcCIsInVybCIsImxvY2F0aW9uIiwiaHJlZiIsInJlcGxhY2UiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsInVuZGVmaW5lZCIsImlubmVySFRNTCIsImFkZHJlc3MiLCJpbWFnZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsIm9wZXJhdGluZ19ob3VycyIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImNvbnRhaW5lciIsIm5vUmV2aWV3cyIsInVsIiwibGkiLCJyZXZpZXdlckluZm9CbG9jayIsInJldmlld2VyTmFtZURhdGUiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvRGF0ZVN0cmluZyIsInJhdGluZ1ZhbHVlIiwic3BhbiIsInJhdGluZ1N0YXJzIiwicmVwZWF0IiwicmF0aW5nU3RhcnNFbGVtZW50IiwiY3JlYXRlUmF0aW5nU3RhcnNCbG9jayIsImNyZWF0ZVJldmlld0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJNYXAiLCJicmVhZGNydW1iIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50Il0sIm1hcHBpbmdzIjoib3NDQUFBLDJHQ1dBQSxrQ0FJ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LENBQWZ0SCxRQUVGbUcsWUFBQUssR0F4Q0RlLEdBOURHQyxRQUFBbEgsSUFBQSxJQUFlTSxPQUFBQyxLQUFKNEcsSUFBb0IvRixTQUFBeUMsZUFBcEIsT0FBQSxNQUFvRCxVQUVyRGhHLEVBRnFENEMsb0JBQS9ELElBK0tKLFdBQW9ELElBQTVCNUMsRUFBQSxFQUFBNUMsVUFBQWtDLGFBQUE4SCxJQUFBaEssVUFBQSxHQUFBQSxVQUFBLEdBQVdrSixLQUFuQ3RHLFdBQ1F1SixFQUFhaEcsU0FBQXlDLGVBQW5CLGNBQ01zQyxFQUFLL0UsU0FBQU8sY0FBWCxRQUNBdUQsVUFBZXJILEVBQWYzQixPQUNBMkosWUFBQU0sR0E1S0VrQixLQUFBQyx1QkFBZ0NuRCxLQUFoQ3RHLFdBQWlEc0csS0FBakRuRSxPQVpGaEQsTUFjUyxTQUFBQyxXQUNQdkMsTUFBQXVDIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cbiAgZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0oKSk7XG4iLCJjb25zdCBpZGIgPSByZXF1aXJlKCdpZGInKTtcclxuY29uc3QgQVBQX0RCX05BTUUgPSAncmVzdGF1cmFudHMtZGInO1xyXG5jb25zdCBEQl9SRVNUQVVSQU5UU19UQUJMRSA9ICdyZXN0YXVyYW50cyc7XHJcbmNvbnN0IEFQUF9EQl9WRVIgPSAxO1xyXG5cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cygpIHtcclxuICAgIHJldHVybiBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAnL3Jlc3RhdXJhbnRzJylcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYihyZXN0YXVyYW50cykudGhlbigoKSA9PiByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYigpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgICAgaWYgKCFyZXN0YXVyYW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGZXRjaCBlcnJvcicpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50IGJ5IGlkIHdpdGggcmV2aWV3cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MoaWQpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbXHJcbiAgICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50KGlkKSxcclxuICAgICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRSZXZpZXdzKGlkKVxyXG4gICAgXSkudGhlbigoW3Jlc3RhdXJhbnQsIHJldmlld3NdKSA9PiB7XHJcbiAgICAgIHJlc3RhdXJhbnQucmV2aWV3cyA9IHJldmlld3M7XHJcbiAgICAgIHJldHVybiB0aGlzLnB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnQpLnRoZW4oKCkgPT4gcmVzdGF1cmFudCk7XHJcbiAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYihpZCkudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmV0Y2ggZXJyb3InKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudChpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmVzdGF1cmFudHMvJHtpZH1gKVxyXG4gICAgICAudGhlbihkYXRhID0+IGRhdGEuanNvbigpKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRSZXZpZXdzKHJlc3RhdXJhbnRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH0vcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0ke3Jlc3RhdXJhbnRJZH1gKVxyXG4gICAgICAudGhlbihkYXRhID0+IGRhdGEuanNvbigpKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYigpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKVxyXG4gICAgICAudGhlbihkYiA9PiBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSkub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLmdldEFsbCgpKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiKGlkKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PlxyXG4gICAgICBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSkub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLmdldCgraWQpKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIocmVzdGF1cmFudHMpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5jbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIoKS50aGVuKCgpID0+IERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4gdHgub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLnB1dChyZXN0YXVyYW50KSk7XHJcbiAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwdXRSZXN0YXVyYW50SW50b0luZGV4ZWREYihyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihkYiA9PiB7XHJcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgdHgub2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUpLnB1dChyZXN0YXVyYW50KTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiKCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgIHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5jbGVhcigpO1xyXG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBvcGVuRGF0YWJhc2UoKSB7XHJcbiAgICByZXR1cm4gaWRiLm9wZW4oQVBQX0RCX05BTUUsIEFQUF9EQl9WRVIsICh1cGdyYWRlRGIpID0+IHtcclxuICAgICAgc3dpdGNoICh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xyXG4gICAgICAgIGNhc2UgMCA6XHJcbiAgICAgICAgICBjb25zdCByZXN0YXVyYW50U3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoREJfUkVTVEFVUkFOVFNfVEFCTEUsIHtrZXlQYXRoOiAnaWQnfSk7XHJcbiAgICAgICAgICByZXN0YXVyYW50U3RvcmUuY3JlYXRlSW5kZXgoJ3N0YXR1cycsICdzdGF0dXMnKTtcclxuICAgICAgICAvLyBicmVhayBvbWl0dGVkXHJcbiAgICAgICAgZGVmYXVsdCA6XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQpIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRXaXRoUmV2aWV3cyhpZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIHJldHVybiByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuXHJcbiAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHNhdmVSZXZpZXcocmV2aWV3KSB7XHJcblxyXG4gICAgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXZpZXdzL2AsIHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KSxcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgICAudGhlbihkYXRhID0+IGRhdGEuanNvbigpKVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnZXJycicpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5laWdoYm9yaG9vZHM6IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSksXHJcbiAgICAgICAgY3Vpc2luZXM6IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKSxcclxuICAgICAgICByZXN0YXVyYW50cyxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgL2ltZy8ke3Jlc3RhdXJhbnQuaWR9X3NtYWxsLmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VTcmNTZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IERCSGVscGVyOyIsIi8qIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyIHdpdGggZXZlbnRzICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpIHtcclxuXHJcbiAgcmV0dXJuO1xyXG5cclxuICBpZiAoISdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignc2VydmljZVdvcmtlciBub3QgcmVnaXN0ZXInKTtcclxuICB9XHJcblxyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uIChyZWcpIHtcclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAocmVnLmFjdGl2ZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnVGhlcmUgaXMgYW4gYW4gYWN0aXZlIHNlcnZpY2Ugd29ya2VyJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZy53YWl0aW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCd3YWl0aW5nIDonLCByZWcud2FpdGluZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBpcyB3YWl0aW5nJyk7XHJcbiAgICAgIHVwZGF0ZVNlcnZpY2VXb3JrZXIocmVnLndhaXRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWcuaW5zdGFsbGluZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnaW5zdGFsbGluZyA6ICcsIHJlZyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciBzdGF0dXMgaXMgaW5zdGFsbGluZycpO1xyXG4gICAgICB0cmFja0luc3RhbGxpbmcocmVnLmluc3RhbGxpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHVwZGF0ZSBmb3VuZCcsIHJlZyk7XHJcbiAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgcmVmcmVzaGluZztcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlmIChyZWZyZXNoaW5nKSByZXR1cm47XHJcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICByZWZyZXNoaW5nID0gdHJ1ZTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZygnUmVnaXN0cmF0aW9uIGZhaWxlZCB3aXRoICcgKyBlcnJvcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyYWNrSW5zdGFsbGluZyhpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgaWYgKCFpbnN0YWxsaW5nV29ya2VyKSB7XHJcbiAgICBjb25zb2xlLmxvZygnV29ya2VyIG5vdCBkZWZpbmVkIScpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBpbnN0YWxsaW5nV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgc3RhdGUgd2FzIGNoYW5nZWQgdG8gJyArIGluc3RhbGxpbmdXb3JrZXIuc3RhdGUpO1xyXG4gICAgaWYgKGluc3RhbGxpbmdXb3JrZXIuc3RhdGUgPT09ICdpbnN0YWxsZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlIHdvcmtlciBpbnN0YWxsZWQgYW5kIHdhaXRpbmcgZm9yIGFjdGl2YXRpb24nLCBpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgICAgdXBkYXRlU2VydmljZVdvcmtlcihpbnN0YWxsaW5nV29ya2VyKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU2VydmljZVdvcmtlcih3b3JrZXIpIHtcclxuICBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcih7YWN0aW9uOiAnc2tpcFdhaXRpbmcnfSwgd29ya2VyKVxyXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlRnJvbVN3KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlRnJvbVN3KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZW5kTWVzc2FnZVRvU2VydmljZVdvcmtlcihtc2csIHdvcmtlcikge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB2YXIgbXNnQ2hhbiA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG5cclxuICAgIC8vIEhhbmRsZXIgZm9yIHJlY2lldmluZyBtZXNzYWdlIHJlcGx5IGZyb20gc2VydmljZSB3b3JrZXJcclxuICAgIG1zZ0NoYW4ucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGlmIChldmVudC5kYXRhLmVycm9yKSB7XHJcbiAgICAgICAgcmVqZWN0KGV2ZW50LmRhdGEuZXJyb3IpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc29sdmUoZXZlbnQuZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gc2VydmljZSB3b3JrZXIgYWxvbmcgd2l0aCBwb3J0IGZvciByZXBseVxyXG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKG1zZywgW21zZ0NoYW4ucG9ydDJdKTtcclxuICB9KTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyLFxyXG59OyIsIlxuZnVuY3Rpb24gUmF0aW5nU2VsZWN0KHNlbGVjdG9yLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBvcHRpb25zLm1heCA9IG9wdGlvbnMubWF4IHx8IDU7XG5cbiAgdGhpcy5yYXRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgdGhpcy5zdGFyTGlzdCA9IFtdO1xuXG4gIGlmICghdGhpcy5yYXRpbmcpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBvcHRpb25zLmxhYmVsKTtcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgncm9sZScsICdyYWRpb2dyb3VwJyk7XG4gIHRoaXMucmF0aW5nLnNldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW5vdycsIDApO1xuICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWVtaW4nLCAwKTtcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbWF4Jywgb3B0aW9ucy5tYXgpO1xuICB0aGlzLnJhdGluZy5jbGFzc05hbWUgPSAncmF0aW5nLXNlbGVjdCc7XG5cbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gb3B0aW9ucy5tYXg7IGkrKykge1xuICAgIGNvbnN0IHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzdGFyLmNsYXNzTmFtZSA9ICdyYXRpbmctc2VsZWN0X19pdGVtJztcbiAgICBzdGFyLnNldEF0dHJpYnV0ZSgncm9sZScsICdyYWRpbycpO1xuICAgIHN0YXIuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCBpKTtcbiAgICB0aGlzLnN0YXJMaXN0LnB1c2goc3Rhcik7XG4gICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25SYXRpbmdFbGVtZW50Q2xpY2suYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yYXRpbmcuYXBwZW5kKHN0YXIpO1xuICB9XG5cbiAgdGhpcy5yYXRpbmcuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpKTtcbiAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gMDtcblxuICB0aGlzLnJhdGluZ0lucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgMCk7XG4gIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgb3B0aW9ucy5pbnB1dE5hbWUgfHwgJ3JhdGluZycpO1xuICB0aGlzLnJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBvcHRpb25zLmlucHV0TmFtZSB8fCAncmF0aW5nJyk7XG4gIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpO1xuICB0aGlzLnJhdGluZy5hcHBlbmQodGhpcy5yYXRpbmdJbnB1dCk7XG59XG5cblJhdGluZ1NlbGVjdC5wcm90b3R5cGUgPSB7XG5cbiAgb25SYXRpbmdFbGVtZW50Q2xpY2soZSkge1xuICAgIGNvbnN0IGNsaWNrZWRTdGFySW5kZXggPSB0aGlzLnN0YXJMaXN0LmluZGV4T2YoZS50YXJnZXQpO1xuXG4gICAgaWYgKCFjbGlja2VkU3RhckluZGV4ID09PSAtMSkgcmV0dXJuO1xuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IGNsaWNrZWRTdGFySW5kZXg7XG5cbiAgICB0aGlzLnN0YXJMaXN0Lm1hcCgoZWwsIGkpID0+IHtcbiAgICAgIGVsLmNsYXNzTGlzdC50b2dnbGUoJ3JhdGluZy1zZWxlY3RfX2l0ZW0tLWNoZWNrZWQnLCBpIDw9IGNsaWNrZWRTdGFySW5kZXgpO1xuICAgICAgaWYgKGkgPT09IGNsaWNrZWRTdGFySW5kZXgpIHtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCB0cnVlKTtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAtMSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29uc3QgdmFsID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7XG4gICAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgdmFsKTtcbiAgICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWVub3cnLCB2YWwpO1xuICAgIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIHZhbCk7XG5cbiAgfSxcblxuICBoYW5kbGVLZXlEb3duKGUpIHtcbiAgICAvLyBEZWZpbmUgdmFsdWVzIGZvciBrZXljb2Rlc1xuICAgIGNvbnN0IFZLX0VOVEVSID0gMTM7XG4gICAgY29uc3QgVktfRVNDID0gMjc7XG4gICAgY29uc3QgVktfU1BBQ0UgPSAzMjtcbiAgICBjb25zdCBWS19MRUZUID0gMzc7XG4gICAgY29uc3QgVktfVVAgPSAzODtcbiAgICBjb25zdCBWS19SSUdIVCA9IDM5O1xuICAgIGNvbnN0IFZLX0RPV04gPSA0MDtcblxuICAgIGlmIChbVktfRE9XTiwgVktfVVAsIFZLX1NQQUNFLCBWS19FTlRFUiwgVktfTEVGVCwgVktfUklHSFQsIFZLX0VTQ10uaW5kZXhPZihlLmtleUNvZGUpID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgIGNhc2UgVktfRE9XTjpcbiAgICAgIGNhc2UgVktfUklHSFQ6XG4gICAgICAgIHRoaXMubmV4dEFjdGl2ZUxpc3RJdGVtKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19VUDpcbiAgICAgIGNhc2UgVktfTEVGVDpcbiAgICAgICAgdGhpcy5wcmV2aW91c0FjdGl2ZUxpc3RJdGVtKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBWS19TUEFDRTpcbiAgICAgICAgdGhpcy5vblJhdGluZ0VsZW1lbnRDbGljayhlKTtcbiAgICAgICAgdGhpcy5yYXRpbmcuZm9jdXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFZLX0VOVEVSOlxuICAgICAgICB0aGlzLm9uUmF0aW5nRWxlbWVudENsaWNrKGUpO1xuICAgICAgICB0aGlzLnJhdGluZy5mb2N1cygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVktfRVNDOlxuICAgICAgICB0aGlzLnJhdGluZy5mb2N1cygpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm47XG4gIH0sXG5cbiAgbmV4dEFjdGl2ZUxpc3RJdGVtKCkge1xuICAgIGNvbnN0IG5leHRFbGVtZW50SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSWR4ID49IHRoaXMuc3Rhckxpc3QubGVuZ3RoIC0gMSkgPyAwIDogKHRoaXMuYWN0aXZlSXRlbUlkeCArIDEpO1xuICAgIHRoaXMuc3Rhckxpc3RbbmV4dEVsZW1lbnRJbmRleF0uZm9jdXMoKTtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSBuZXh0RWxlbWVudEluZGV4O1xuICB9LFxuXG4gIHByZXZpb3VzQWN0aXZlTGlzdEl0ZW0oKSB7XG4gICAgY29uc3QgcHJldkVsZW1lbnRJbmRleCA9ICh0aGlzLmFjdGl2ZUl0ZW1JZHggPT09IDApID8gdGhpcy5zdGFyTGlzdC5sZW5ndGggLSAxIDogKHRoaXMuYWN0aXZlSXRlbUlkeCAtIDEpO1xuICAgIHRoaXMuc3Rhckxpc3RbcHJldkVsZW1lbnRJbmRleF0uZm9jdXMoKTtcbiAgICB0aGlzLmFjdGl2ZUl0ZW1JZHggPSBwcmV2RWxlbWVudEluZGV4O1xuICB9LFxuXG59XG5cbm1vZHVsZS5leHBvcnRzID0gUmF0aW5nU2VsZWN0OyIsImNvbnN0IERCSGVscGVyID0gcmVxdWlyZSgnLi9kYmhlbHBlcicpO1xuY29uc3QgcHJvY2VzcyA9IHJlcXVpcmUoJy4vcHJvY2VzcycpO1xuY29uc3QgUmF0aW5nU2VsZWN0ID0gcmVxdWlyZSgnLi9yYXRpbmctc2VsZWN0Jyk7XG5cbmxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuY3JlYXRlUmF0aW5nU2VsZWN0KCk7XG5yYXRpbmdGb3JtKCk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgcHJvY2Vzcy5yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpLnRoZW4ocmVzdGF1cmFudCA9PiB7XG4gICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblxuICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuXG4gICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgem9vbTogMTYsXG4gICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgfSk7XG5cbiAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cbiAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKSB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgcmV0dXJuIHNlbGYucmVzdGF1cmFudDtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQpLnRoZW4oKHJlc3RhdXJhbnQpID0+IHtcblxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gcmVzdGF1cmFudCcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdGF1cmFudDtcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGBBbiBpbWFnZSBmcm9tIHRoZSByZXN0YXVyYW50ICR7cmVzdGF1cmFudC5uYW1lfWApO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5mdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHRpbWUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgb3BlcmF0aW5nSG91cnNba2V5XSArICcsJyk7IC8vIGZvciBzY3JlZW4gcmVhZGVyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZnVuY3Rpb24gZmlsbFJldmlld3NIVE1MKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykge1xuXG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpIHtcblxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBsaS5jbGFzc05hbWUgPSAncmV2aWV3cy1saXN0LWl0ZW0nO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAncmV2aWV3Jyk7XG5cbiAgY29uc3QgcmV2aWV3ZXJJbmZvQmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgcmV2aWV3ZXJJbmZvQmxvY2suY2xhc3NOYW1lID0gJ3Jldmlld2VyLWluZm8nO1xuXG4gIGNvbnN0IHJldmlld2VyTmFtZURhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgcmV2aWV3ZXJOYW1lRGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3ZXItaW5mb19fbmFtZS1kYXRlJztcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCByZXZpZXcubmFtZSk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RhdGUnKTtcbiAgZGF0ZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KS50b0RhdGVTdHJpbmcoKTtcblxuICByZXZpZXdlck5hbWVEYXRlLmFwcGVuZENoaWxkKG5hbWUpO1xuICByZXZpZXdlck5hbWVEYXRlLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gIHJldmlld2VySW5mb0Jsb2NrLmFwcGVuZENoaWxkKHJldmlld2VyTmFtZURhdGUpO1xuXG4gIHJldmlld2VySW5mb0Jsb2NrLmFwcGVuZENoaWxkKGNyZWF0ZVJhdGluZ1N0YXJzQmxvY2socmV2aWV3LnJhdGluZykpO1xuXG4gIGxpLmFwcGVuZENoaWxkKHJldmlld2VySW5mb0Jsb2NrKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIGNvbW1lbnRzLmNsYXNzTmFtZSA9ICdyZXZpZXdlci1jb21tZW50JztcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVSYXRpbmdTdGFyc0Jsb2NrKHJhdGluZ1ZhbHVlKSB7XG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcblxuICByYXRpbmcuYXBwZW5kQ2hpbGQoKCgpID0+IHtcbiAgICBsZXQgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBzcGFuLmNsYXNzTmFtZSA9ICdyYXRpbmctbnVtYmVyJztcbiAgICBzcGFuLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICAgIHNwYW4uaW5uZXJIVE1MID0gJ1JhdGluZyA6ICcgKyByYXRpbmdWYWx1ZTtcbiAgICByZXR1cm4gc3BhbjtcbiAgfSkoKSk7XG5cbiAgbGV0IHJhdGluZ1N0YXJzID0gJ+KYhScucmVwZWF0KCtyYXRpbmdWYWx1ZSk7XG5cbiAgaWYgKCtyYXRpbmdWYWx1ZSA8IDUpIHtcbiAgICByYXRpbmdTdGFycyA9IHJhdGluZ1N0YXJzICsgJ+KYhicucmVwZWF0KDUgLSArcmF0aW5nVmFsdWUpO1xuICB9XG4gIGNvbnN0IHJhdGluZ1N0YXJzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgcmF0aW5nU3RhcnNFbGVtZW50LmNsYXNzTmFtZSA9ICdyYXRpbmctc3RhcnMnO1xuICByYXRpbmdTdGFyc0VsZW1lbnQuaW5uZXJIVE1MID0gcmF0aW5nU3RhcnM7XG4gIHJhdGluZy5hcHBlbmRDaGlsZChyYXRpbmdTdGFyc0VsZW1lbnQpO1xuXG4gIHJldHVybiByYXRpbmc7XG59XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuZnVuY3Rpb24gZmlsbEJyZWFkY3J1bWIocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpIHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmF0aW5nU2VsZWN0KCkge1xuICBjb25zdCBzZWxlY3QgPSBuZXcgUmF0aW5nU2VsZWN0KCcjcmF0aW5nLXNlbGVjdCcsIHtcbiAgICBsYWJlbDogJ1JhdGluZycsXG4gICAgbWF4OiA1LFxuICB9KTtcbn1cblxuZnVuY3Rpb24gcmF0aW5nRm9ybSgpIHtcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZW5kLXJhdGluZy1mb3JtJyk7XG4gIGlmICghZm9ybSkge1xuICAgIHJldHVybjtcbiAgfVxuICBmb3JtLm9uc3VibWl0ID0gZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB7XG4gICAgICBuYW1lOiB7IHZhbHVlIDogbmFtZSB9LFxuICAgICAgcmF0aW5nOiB7IHZhbHVlIDogcmF0aW5nIH0sXG4gICAgICBjb21tZW50czogeyB2YWx1ZSA6IGNvbW1lbnRzIH1cbiAgICB9ID0gZS50YXJnZXQuZWxlbWVudHM7XG5cbiAgICBjb25zdCByZXZpZXcgPSB7IHJlc3RhdXJhbnRfaWQ6IHNlbGYucmVzdGF1cmFudC5pZCwgbmFtZSwgcmF0aW5nLCBjb21tZW50cyB9O1xuICAgIERCSGVscGVyLnNhdmVSZXZpZXcocmV2aWV3KTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmZ1bmN0aW9uIGdldFBhcmFtZXRlckJ5TmFtZSAobmFtZSwgdXJsKSB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKCFyZXN1bHRzWzJdKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cbiJdfQ==
