"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function a(o,s,u){function c(t,e){if(!s[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};o[t][0].call(i.exports,function(e){return c(o[t][1][e]||e)},i,i.exports,a,o,s,u)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,h,t){!function(){function o(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,i){var a,e=new Promise(function(e,t){o(a=n[r].apply(n,i)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new s(e,t.request)});var e,t})})}function i(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function d(e){this._db=e}e(i,"_index",["name","keyPath","multiEntry","unique"]),t(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(s,"_cursor",["direction","key","primaryKey","value"]),t(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(s.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),o(t._request).then(function(e){if(e)return new s(e,t._request)})})})}),u.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(u,"_store",["name","keyPath","indexNames","autoIncrement"]),t(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},e(c,"_tx",["objectStoreNames","mode"]),n(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},e(d,"_db",["name","version","objectStoreNames"]),n(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[u,i].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[a].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[i,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});var f={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new l(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new d(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};void 0!==h?(h.exports=f,h.exports.default=h.exports):self.idb=f}()},{}],2:[function(e,t,n){var r=e("idb"),i="restaurants",a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(){var t=this;return fetch(a.DATABASE_URL+"/restaurants").then(function(e){return e.json()}).then(function(e){return t.putRestaurantsIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return a.fetchRestaurantsFromIndexedDb().then(function(e){if(e.length)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurantWithReviews",value:function(t){var i=this;return Promise.all([this.fetchRestaurant(t),this.fetchRestaurantReviews(t)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return n.reviews=r,i.putRestaurantIntoIndexedDb(n).then(function(){return n})}).catch(function(e){return a.fetchRestaurantFromIndexedDb(t).then(function(e){if(e)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(e){return fetch(a.DATABASE_URL+"/restaurants/"+e).then(function(e){return e.json()})}},{key:"fetchRestaurantReviews",value:function(e){return fetch(a.DATABASE_URL+"/reviews/?restaurant_id="+e).then(function(e){return e.json()})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return a.openDatabase().then(function(e){return e.transaction(i).objectStore(i).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(t){return a.openDatabase().then(function(e){return e.transaction(i).objectStore(i).get(+t)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return a.clearRestaurantsInIndexedDb().then(function(){return a.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return n.forEach(function(e){return t.objectStore(i).put(e)}),t.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return a.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return t.objectStore(i).put(n),t.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return a.openDatabase().then(function(e){var t=e.transaction(i,"readwrite");return t.objectStore(i).clear(),t.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore(i,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(e){return a.fetchRestaurantWithReviews(e)}},{key:"fetchRestaurantByCuisine",value:function(t,e){a.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return a.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoodsAndCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood}),i=n.map(function(e,t){return n[t].cuisine_type});return{neighborhoods:r.filter(function(e,t){return r.indexOf(e)==t}),cuisines:i.filter(function(e,t){return i.indexOf(e)==t}),restaurants:n}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"small";return"/img/"+e.id+"_"+t+".jpg"}},{key:"imageSrcSetForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:a.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}();t.exports=a},{idb:1}],3:[function(e,t,n){function r(e){e?e.addEventListener("statechange",function(){console.log("ServiceWorker state was changed to "+e.state),"installed"===e.state&&(console.log("Service worker installed and waiting for activation",e),i(e))}):console.log("Worker not defined!")}function i(e){var r,i;(r={action:"skipWaiting"},i=e,new Promise(function(t,n){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?n(e.data.error):t(e.data)},i.postMessage(r,[e.port2])})).then(function(e){console.log(e)})}t.exports={registerServiceWorker:function(){if(!1 in navigator)throw new Error("serviceWorker not register");navigator.serviceWorker.register("/sw.js").then(function(e){var t;navigator.serviceWorker.controller&&(e.active&&console.log("There is an active service worker"),e.waiting&&(console.log("waiting :",e.waiting),console.log("service worker is waiting"),i(e.waiting)),e.installing&&(console.log("installing : ",e),console.log("service worker status is installing"),r(e.installing)),e.addEventListener("updatefound",function(){console.log("service worker update found",e),r(e.installing)}),navigator.serviceWorker.addEventListener("controllerchange",function(){t||setTimeout(function(){window.location.reload(),t=!0},1e3)}))}).catch(function(e){console.log("Registration failed with "+e)})}}},{}],4:[function(e,t,n){function r(e,t){if((t=t||{}).max=t.max||5,this.rating=document.querySelector(e),this.starList=[],this.rating){this.rating.setAttribute("aria-label",t.label),this.rating.setAttribute("tabindex","0"),this.rating.setAttribute("role","radiogroup"),this.rating.className="rating-select";for(var n=1;n<=t.max;n++){var r=document.createElement("div");r.className="rating-select__item",r.setAttribute("role","radio"),r.setAttribute("aria-checked",!1),r.setAttribute("tabindex",0),r.setAttribute("data-value",n),this.starList.push(r),r.addEventListener("click",this.onRatingElementClick.bind(this)),this.rating.append(r)}this.rating.addEventListener("keydown",this.handleKeyDown.bind(this)),this.activeItemIdx=0,this.ratingInput=document.createElement("input"),this.ratingInput.setAttribute("value",0),this.ratingInput.setAttribute("name",t.inputName||"rating"),this.ratingInput.setAttribute("id",t.inputName||"rating"),this.ratingInput.setAttribute("type","hidden"),this.rating.append(this.ratingInput)}}r.prototype={reset:function(){this.rating.setAttribute("aria-valuenow",0),this.ratingInput.setAttribute("value",0),this.activeItemIdx=0,this.starList.forEach(function(e){e.classList.remove("rating-select__item--checked"),e.setAttribute("aria-checked",!1),e.setAttribute("tabindex",-1)}),this.starList[0].setAttribute("tabindex",0)},onRatingElementClick:function(e){var n=this.starList.indexOf(e.target);if(-1!==!n){this.activeItemIdx=n,this.starList.map(function(e,t){e.classList.toggle("rating-select__item--checked",t<=n),t===n?(e.setAttribute("aria-checked",!0),e.setAttribute("tabindex",0)):(e.setAttribute("aria-checked",!1),e.setAttribute("tabindex",-1))});var t=e.target.getAttribute("data-value");this.rating.setAttribute("data-value",t),this.rating.setAttribute("aria-valuenow",t),this.ratingInput.setAttribute("value",t)}},handleKeyDown:function(e){var t=13,n=27,r=32,i=37,a=38,o=39,s=40;if(-1!==[s,a,r,t,i,o,n].indexOf(e.keyCode))switch(e.preventDefault(),e.keyCode){case s:case o:this.nextActiveListItem();break;case a:case i:this.previousActiveListItem();break;case r:case t:this.onRatingElementClick(e),this.rating.focus();break;case n:this.rating.focus()}},nextActiveListItem:function(){var e=this.activeItemIdx>=this.starList.length-1?0:this.activeItemIdx+1;this.starList[e].focus(),this.activeItemIdx=e},previousActiveListItem:function(){var e=0===this.activeItemIdx?this.starList.length-1:this.activeItemIdx-1;this.starList[e].focus(),this.activeItemIdx=e}},t.exports=r},{}],5:[function(e,t,n){var r,i=e("./dbhelper"),a=e("./task-service"),o=e("./process"),s=e("./rating-select"),m=new a,u=document.getElementById("server-status-bar");function g(){if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0])&&self.restaurant)return self.restaurant;var e=function(e,t){t||(t=window.location.href);e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))}("id");if(e)return i.fetchRestaurantById(e).then(function(e){if(!e)throw new Error("No restaurant");return e});throw new Error("No restaurant id in URL")}function b(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");if(!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}e.forEach(function(e){n.appendChild(y(e))})}function y(e){var t=document.createElement("li");t.setAttribute("tabindex","0"),t.className="reviews-list-item",t.setAttribute("aria-label","review");var n=document.createElement("div");n.className="reviewer-info";var r=document.createElement("div");r.className="reviewer-info__name-date";var i=document.createElement("h3");i.setAttribute("tabindex","0"),i.setAttribute("aria-label",e.name),i.innerHTML=e.name;var a=document.createElement("date");a.setAttribute("tabindex","0"),a.innerHTML=new Date(e.updatedAt).toDateString(),r.appendChild(i),r.appendChild(a),n.appendChild(r),n.appendChild(function(e){var t=document.createElement("p");t.appendChild((n=document.createElement("span"),n.className="rating-number",n.setAttribute("tabindex","0"),n.innerHTML="Rating : "+e,n));var n;var r="★".repeat(+e);+e<5&&(r+="☆".repeat(5-+e));var i=document.createElement("span");return i.className="rating-stars",i.innerHTML=r,t.appendChild(i),t}(e.rating)),t.appendChild(n);var o=document.createElement("p");return o.setAttribute("tabindex","0"),o.className="reviewer-comment",o.innerHTML=e.comments,t.appendChild(o),t}o.registerServiceWorker(),document.addEventListener("serverstatus",function(e){u.classList.toggle("-online",e.detail.online)},!1),function(){var p=document.getElementById("send-rating-form");if(!p)return;var v=new s("#rating-select",{label:"Rating",max:5});p.onsubmit=function(e){e.preventDefault();var t=e.target.elements,n=t.name.value,r=t.rating.value,i=t.comments.value;Array.prototype.map.call(document.querySelectorAll("#send-rating-form .form-group"),function(e){return e.classList.remove("has-error")});var a=!0;if(!n.trim()){var o=document.querySelector('[data-field="name"]');o.parentElement.classList.add("has-error"),o.innerHTML="Enter your name",a=!1}if(r<=0){var s=document.querySelector('[data-field="rating"]');s.parentElement.classList.add("has-error"),s.innerHTML="Set rating",a=!1}if(!i.trim()){var u=document.querySelector('[data-field="comments"]');u.parentElement.classList.add("has-error"),u.innerHTML="Enter comment",a=!1}if(a){var c,l,d,f=(new Date).getTime(),h={restaurant_id:self.restaurant.id,name:n,rating:r,comments:i,createdAt:f,updatedAt:f};c=h,l=document.getElementById("reviews-list"),(d=y(c)).classList.add("-added"),l.appendChild(d),m.saveReview(c,function(){g(!0).then(function(e){self.restaurant=e,Array.prototype.forEach.call(document.querySelectorAll(".reviews-list-item"),function(e){return e.remove()}),b()})}),p.reset(),v.reset()}}}(),window.initMap=function(){console.log("initMap"),setTimeout(function(){r=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1})},200)},g().then(function(t){if(console.log("restaurant -> ",t),void 0===t.is_favorite)try{t.is_favorite=JSON.parse(t.is_favorite)}catch(e){t.is_favorite=!1}self.restaurant=t,function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name,t.setAttribute("tabindex","0"),document.getElementById("restaurant-address").innerHTML=e.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.setAttribute("alt","An image from the restaurant "+e.name),n.src=i.imageUrlForRestaurant(e);var r=document.getElementById("restaurant-cuisine");r.setAttribute("tabindex","0"),r.innerHTML=e.cuisine_type,e.operating_hours&&function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),i=document.createElement("td");i.innerHTML=n,r.appendChild(i);var a=document.createElement("td");a.innerHTML=e[n],a.setAttribute("aria-label",e[n]+","),r.appendChild(a),t.appendChild(r)}}();b()}(),function(){var e=document.getElementById("restaurant-like");console.log("addFavoriteButton--:",self.restaurant.is_favorite),self.restaurant.is_favorite&&e.classList.add("card-like--liked");e.onclick=function(){var e=this;this.setAttribute("disabled","disabled"),console.log(self.restaurant.is_favorite),this.classList.toggle("card-like--liked"),m.toggleFavorite(self.restaurant,function(){e.removeAttribute("disabled"),g(!0)})}}(),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}(),i.mapMarkerForRestaurant(self.restaurant,r)}).catch(function(e){console.error(e)})},{"./dbhelper":2,"./process":3,"./rating-select":4,"./task-service":6}],6:[function(e,t,n){e("./dbhelper");function r(){var s=this;this.worker=new Worker("task-worker.js"),this.jobId=0,this.worker.onmessage=function(e){var t=e.data,n=t.id,r=void 0===n?0:n,i=t.action,a=t.result;switch(i){case"offline":case"online":var o=new CustomEvent("serverstatus",{detail:{online:"online"===i}});document.dispatchEvent(o);break;default:s.workerCallbacks[r]&&(s.workerCallbacks[r](a),delete s.workerCallbacks[r])}},this.workerCallbacks={onReviewSave:[]}}r.prototype={beforeTaskAdd:function(){this.jobId=this.jobId+1},addCallback:function(e){"function"==typeof e&&(this.workerCallbacks[this.jobId]=e)},saveReview:function(e,t){this.beforeTaskAdd(),this.worker.postMessage({id:this.jobId,action:"save_review",payload:e}),this.addCallback(t)},toggleFavorite:function(e,t){this.beforeTaskAdd(),this.worker.postMessage({id:this.jobId,action:"set_favorite",payload:{id:this.jobId,restaurantId:e.id,isFavorite:!JSON.parse(self.restaurant.is_favorite)}}),this.addCallback(t)}},t.exports=r},{"./dbhelper":2}]},{},[5]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvcHJvY2Vzcy5qcyIsInNyYy9qcy9yYXRpbmctc2VsZWN0LmpzIiwic3JjL2pzL3Jlc3RhdXJhbnRfaW5mby5qcyIsInNyYy9qcy90YXNrLXNlcnZpY2UuanMiXSwibmFtZXMiOlsicmVzdWx0IiwiZXJyb3IiLCJyZXF1ZXN0IiwiYXJncyIsInJlamVjdCIsInAiLCJwcm9wIiwidmFsIiwiYXJndW1lbnRzIiwiaW5kZXgiLCJjdXJzb3IiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwicmVzb2x2ZSIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwidGhpcyIsIl9yZXF1ZXN0IiwiYXJyIiwiX2luZGV4IiwidmFsdWUiLCJjb250aW51ZSIsIml0ZW1zIiwidmVyc2lvbiIsIm5hbWUiLCJleHAiLCJleHBvcnRzIiwiaWRiIiwicmVxdWlyZSIsIkRCX1JFU1RBVVJBTlRTX1RBQkxFIiwiREJIZWxwZXIiLCJfdGhpcyIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJkYXRhIiwianNvbiIsInJlc3RhdXJhbnRzIiwicHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiIiwiY2F0Y2giLCJlcnIiLCJmZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYiIsImxlbmd0aCIsIkVycm9yIiwiaWQiLCJfdGhpczIiLCJhbGwiLCJmZXRjaFJlc3RhdXJhbnQiLCJmZXRjaFJlc3RhdXJhbnRSZXZpZXdzIiwiX3JlZiIsIl9yZWYyIiwiX3NsaWNlZFRvQXJyYXkiLCJyZXN0YXVyYW50IiwicmV2aWV3cyIsInB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiIiwiZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYiIsInJlc3RhdXJhbnRJZCIsIm9wZW5EYXRhYmFzZSIsIm9iamVjdFN0b3JlIiwiZ2V0QWxsIiwiZ2V0IiwiY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiIiwidHgiLCJmb3JFYWNoIiwicHV0IiwiY29tcGxldGUiLCJjbGVhciIsIm9wZW4iLCJ1cGdyYWRlRGIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXdzIiwiY3Vpc2luZSIsImNhbGxiYWNrIiwiZmV0Y2hSZXN0YXVyYW50cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJyZXN1bHRzIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiY3Vpc2luZXMiLCJpbmRleE9mIiwic2l6ZSIsInVuZGVmaW5lZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwibGF0bG5nIiwidXJsRm9yUmVzdGF1cmFudCIsIkFuaW1hdGlvbiIsIkRST1AiLCJtb2R1bGUiLCJ0cmFja0luc3RhbGxpbmciLCJpbnN0YWxsaW5nV29ya2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImxvZyIsInN0YXRlIiwidXBkYXRlU2VydmljZVdvcmtlciIsIndvcmtlciIsIm1zZyIsImFjdGlvbiIsIlByb21pc2UiLCJtc2dDaGFuIiwiTWVzc2FnZUNoYW5uZWwiLCJwb3J0MSIsIm9ubWVzc2FnZSIsImV2ZW50IiwicG9zdE1lc3NhZ2UiLCJwb3J0MiIsInJlc3BvbnNlRnJvbVN3IiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwicmVnIiwicmVmcmVzaGluZyIsImNvbnRyb2xsZXIiLCJhY3RpdmUiLCJ3YWl0aW5nIiwiaW5zdGFsbGluZyIsImxvY2F0aW9uIiwicmVsb2FkIiwiUmF0aW5nU2VsZWN0Iiwic2VsZWN0b3IiLCJvcHRpb25zIiwibWF4IiwicmF0aW5nIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3Rhckxpc3QiLCJzZXRBdHRyaWJ1dGUiLCJsYWJlbCIsImNsYXNzTmFtZSIsInN0YXIiLCJjcmVhdGVFbGVtZW50IiwicHVzaCIsIm9uUmF0aW5nRWxlbWVudENsaWNrIiwiYmluZCIsImFwcGVuZCIsImhhbmRsZUtleURvd24iLCJhY3RpdmVJdGVtSWR4IiwicmF0aW5nSW5wdXQiLCJpbnB1dE5hbWUiLCJwcm90b3R5cGUiLCJlbCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImUiLCJjbGlja2VkU3RhckluZGV4IiwidGFyZ2V0IiwidG9nZ2xlIiwiZ2V0QXR0cmlidXRlIiwiVktfRU5URVIiLCJWS19FU0MiLCJWS19TUEFDRSIsIlZLX0xFRlQiLCJWS19VUCIsIlZLX1JJR0hUIiwiVktfRE9XTiIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsIm5leHRBY3RpdmVMaXN0SXRlbSIsInByZXZpb3VzQWN0aXZlTGlzdEl0ZW0iLCJmb2N1cyIsIm5leHRFbGVtZW50SW5kZXgiLCJwcmV2RWxlbWVudEluZGV4IiwiVGFza1NlcnZpY2UiLCJwcm9jZXNzIiwidGFza1NlcnZpY2UiLCJzdGF0dXNCYXIiLCJnZXRFbGVtZW50QnlJZCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJzZWxmIiwidXJsIiwid2luZG93IiwiaHJlZiIsInJlcGxhY2UiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZpbGxSZXZpZXdzSFRNTCIsImNvbnRhaW5lciIsInVsIiwibm9SZXZpZXdzIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwibGkiLCJyZXZpZXdlckluZm9CbG9jayIsInJldmlld2VyTmFtZURhdGUiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvRGF0ZVN0cmluZyIsInJhdGluZ1ZhbHVlIiwic3BhbiIsInJhdGluZ1N0YXJzIiwicmVwZWF0IiwicmF0aW5nU3RhcnNFbGVtZW50IiwiY3JlYXRlUmF0aW5nU3RhcnNCbG9jayIsImNvbW1lbnRzIiwiZGV0YWlsIiwib25saW5lIiwiZm9ybSIsInNlbGVjdCIsIm9uc3VibWl0IiwiX2UkdGFyZ2V0JGVsZW1lbnRzIiwiZWxlbWVudHMiLCJjYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsInZhbGlkIiwidHJpbSIsImZpZWxkIiwicGFyZW50RWxlbWVudCIsImFkZCIsIl9maWVsZCIsIl9maWVsZDIiLCJjdXJEYXRlIiwiZ2V0VGltZSIsInNhdmVSZXZpZXciLCJyZXNldCIsInJhdGluZ0Zvcm0iLCJpbml0TWFwIiwiTWFwIiwiaXNfZmF2b3JpdGUiLCJKU09OIiwicGFyc2UiLCJhZGRyZXNzIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJvcGVyYXRpbmdfaG91cnMiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5IiwidGltZSIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiYnV0dG9uIiwib25jbGljayIsIl90aGlzMyIsInRvZ2dsZUZhdm9yaXRlIiwicmVtb3ZlQXR0cmlidXRlIiwiYWRkRmF2b3JpdGVCdXR0b24iLCJicmVhZGNydW1iIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiX3RoaXM0IiwiV29ya2VyIiwiam9iSWQiLCJfcmVmMyIsIl9yZWYzJGRhdGEiLCJfcmVmMyRkYXRhJGlkIiwic3RhdHVzRXZlbnQiLCJDdXN0b21FdmVudCIsImRpc3BhdGNoRXZlbnQiLCJ3b3JrZXJDYWxsYmFja3MiLCJiZWZvcmVUYXNrQWRkIiwiYWRkQ2FsbGJhY2siXSwibWFwcGluZ3MiOiJvc0NBQUEsMkdDV0FBLGtDQUlBQyxnQ0FNQUMsK0NBRUFDLFdBQ0FDLHNCQUdBRixFQUNBRyw2R0FlQUMsK0JBR0FDLGlIQVVBQyxzSUFTQUEsZ0lBU0FBLG1EQXZDQU4saURBNkNBTywrQkF3QkFDLGdCQUNBUiw0QkFnQ0FTLHlCQXdDQUMs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UC9OLFdBS1IrTixnQkFBQSxjQUFBLElBTUYvRixFQUFBdkIsVUFBQSwrQkFHSStHLE1BQWFuUCxLQUFBbVAsTUFBYix3QkFHRjFMLEdBQ0UsbUJBQUlBLFNBQ0ZpTSxnQkFBcUIxUCxLQUFyQm1QLE9BQUExTCx3QkFJSndILEVBQUF4SCxRQUNFa00scUJBR0FwSyxPQUFBUyxZQUFBLElBQ01oRyxLQURrQm1QLGFBQUEsc0JBQXhCbEUsU0FNQTJFLFlBQUFuTSw0QkFHRnRCLEVBQUFzQixRQUNFa00scUJBR0FwSyxPQUFBUyxZQUFBLElBQ01oRyxLQURrQm1QLGFBQUEsMkJBSWhCblAsS0FER21QLG1CQUVPaE4sRUFGUFIsZUFHTThMLEtBQUFDLE1BQVd6RCxLQUFBOUgsV0FONUJxTCxxQkFVQW9DLFlBQUFuTSxLQUtKdUIsRUFBQXRFLFFBQUFpSiIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cbiAgICAgIGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIiwiY29uc3QgaWRiID0gcmVxdWlyZSgnaWRiJyk7XHJcbmNvbnN0IEFQUF9EQl9OQU1FID0gJ3Jlc3RhdXJhbnRzLWRiJztcclxuY29uc3QgREJfUkVTVEFVUkFOVFNfVEFCTEUgPSAncmVzdGF1cmFudHMnO1xyXG5jb25zdCBBUFBfREJfVkVSID0gMTtcclxuXHJcbi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICsgJy9yZXN0YXVyYW50cycpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50c0ludG9JbmRleGVkRGIocmVzdGF1cmFudHMpLnRoZW4oKCkgPT4gcmVzdGF1cmFudHMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICAgIGlmICghcmVzdGF1cmFudHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmV0Y2ggZXJyb3InKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudCBieSBpZCB3aXRoIHJldmlld3MuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXdzKGlkKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xyXG4gICAgICB0aGlzLmZldGNoUmVzdGF1cmFudChpZCksXHJcbiAgICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50UmV2aWV3cyhpZClcclxuICAgIF0pLnRoZW4oKFtyZXN0YXVyYW50LCByZXZpZXdzXSkgPT4ge1xyXG4gICAgICByZXN0YXVyYW50LnJldmlld3MgPSByZXZpZXdzO1xyXG4gICAgICByZXR1cm4gdGhpcy5wdXRSZXN0YXVyYW50SW50b0luZGV4ZWREYihyZXN0YXVyYW50KS50aGVuKCgpID0+IHJlc3RhdXJhbnQpO1xyXG4gICAgfSkuY2F0Y2goZXJyID0+IHtcclxuICAgICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEZyb21JbmRleGVkRGIoaWQpLnRoZW4ocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZldGNoIGVycm9yJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiByZXN0YXVyYW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jlc3RhdXJhbnRzLyR7aWR9YClcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50UmV2aWV3cyhyZXN0YXVyYW50SWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JHtyZXN0YXVyYW50SWR9YClcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKClcclxuICAgICAgLnRoZW4oZGIgPT4gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXRBbGwoKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYihpZCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT5cclxuICAgICAgZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXQoK2lkKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnRzKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIuY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiKCkudGhlbigoKSA9PiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCkpO1xyXG4gICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgIHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuY2xlYXIoKTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgb3BlbkRhdGFiYXNlKCkge1xyXG4gICAgcmV0dXJuIGlkYi5vcGVuKEFQUF9EQl9OQU1FLCBBUFBfREJfVkVSLCAodXBncmFkZURiKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcclxuICAgICAgICBjYXNlIDAgOlxyXG4gICAgICAgICAgY29uc3QgcmVzdGF1cmFudFN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFLCB7a2V5UGF0aDogJ2lkJ30pO1xyXG4gICAgICAgICAgcmVzdGF1cmFudFN0b3JlLmNyZWF0ZUluZGV4KCdzdGF0dXMnLCAnc3RhdHVzJyk7XHJcbiAgICAgICAgLy8gYnJlYWsgb21pdHRlZFxyXG4gICAgICAgIGRlZmF1bHQgOlxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlld3MoaWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcblxyXG4gICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHNBbmRDdWlzaW5lcygpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5laWdoYm9yaG9vZHM6IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSksXHJcbiAgICAgICAgY3Vpc2luZXM6IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKSxcclxuICAgICAgICByZXN0YXVyYW50cyxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNpemUgPSAnc21hbGwnKSB7XHJcbiAgICByZXR1cm4gYC9pbWcvJHtyZXN0YXVyYW50LmlkfV8ke3NpemV9LmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VTcmNTZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IERCSGVscGVyOyIsIi8qIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyIHdpdGggZXZlbnRzICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpIHtcclxuXHJcbiAgaWYgKCEnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3NlcnZpY2VXb3JrZXIgbm90IHJlZ2lzdGVyJyk7XHJcbiAgfVxyXG5cclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykudGhlbihmdW5jdGlvbiAocmVnKSB7XHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlZy5hY3RpdmUpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1RoZXJlIGlzIGFuIGFjdGl2ZSBzZXJ2aWNlIHdvcmtlcicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZWcud2FpdGluZykge1xyXG4gICAgICBjb25zb2xlLmxvZygnd2FpdGluZyA6JywgcmVnLndhaXRpbmcpO1xyXG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgaXMgd2FpdGluZycpO1xyXG4gICAgICB1cGRhdGVTZXJ2aWNlV29ya2VyKHJlZy53YWl0aW5nKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVnLmluc3RhbGxpbmcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ2luc3RhbGxpbmcgOiAnLCByZWcpO1xyXG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgc3RhdHVzIGlzIGluc3RhbGxpbmcnKTtcclxuICAgICAgdHJhY2tJbnN0YWxsaW5nKHJlZy5pbnN0YWxsaW5nKTtcclxuICAgIH1cclxuXHJcbiAgICByZWcuYWRkRXZlbnRMaXN0ZW5lcigndXBkYXRlZm91bmQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciB1cGRhdGUgZm91bmQnLCByZWcpO1xyXG4gICAgICB0cmFja0luc3RhbGxpbmcocmVnLmluc3RhbGxpbmcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIHJlZnJlc2hpbmc7XHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBpZiAocmVmcmVzaGluZykgcmV0dXJuO1xyXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgcmVmcmVzaGluZyA9IHRydWU7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgfSk7XHJcblxyXG4gIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coJ1JlZ2lzdHJhdGlvbiBmYWlsZWQgd2l0aCAnICsgZXJyb3IpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0cmFja0luc3RhbGxpbmcoaW5zdGFsbGluZ1dvcmtlcikge1xyXG4gIGlmICghaW5zdGFsbGluZ1dvcmtlcikge1xyXG4gICAgY29uc29sZS5sb2coJ1dvcmtlciBub3QgZGVmaW5lZCEnKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgaW5zdGFsbGluZ1dvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIHN0YXRlIHdhcyBjaGFuZ2VkIHRvICcgKyBpbnN0YWxsaW5nV29ya2VyLnN0YXRlKTtcclxuICAgIGlmIChpbnN0YWxsaW5nV29ya2VyLnN0YXRlID09PSAnaW5zdGFsbGVkJykge1xyXG4gICAgICBjb25zb2xlLmxvZygnU2VydmljZSB3b3JrZXIgaW5zdGFsbGVkIGFuZCB3YWl0aW5nIGZvciBhY3RpdmF0aW9uJywgaW5zdGFsbGluZ1dvcmtlcik7XHJcbiAgICAgIHVwZGF0ZVNlcnZpY2VXb3JrZXIoaW5zdGFsbGluZ1dvcmtlcik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVNlcnZpY2VXb3JrZXIod29ya2VyKSB7XHJcbiAgc2VuZE1lc3NhZ2VUb1NlcnZpY2VXb3JrZXIoe2FjdGlvbjogJ3NraXBXYWl0aW5nJ30sIHdvcmtlcilcclxuICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZUZyb21Tdykge1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXNwb25zZUZyb21Tdyk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb1NlcnZpY2VXb3JrZXIobXNnLCB3b3JrZXIpIHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgdmFyIG1zZ0NoYW4gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcclxuXHJcbiAgICAvLyBIYW5kbGVyIGZvciByZWNlaXZpbmcgbWVzc2FnZSByZXBseSBmcm9tIHNlcnZpY2Ugd29ya2VyXHJcbiAgICBtc2dDaGFuLnBvcnQxLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICBpZiAoZXZlbnQuZGF0YS5lcnJvcikge1xyXG4gICAgICAgIHJlamVjdChldmVudC5kYXRhLmVycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNvbHZlKGV2ZW50LmRhdGEpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8gU2VuZCBtZXNzYWdlIHRvIHNlcnZpY2Ugd29ya2VyIGFsb25nIHdpdGggcG9ydCBmb3IgcmVwbHlcclxuICAgIHdvcmtlci5wb3N0TWVzc2FnZShtc2csIFttc2dDaGFuLnBvcnQyXSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHJlZ2lzdGVyU2VydmljZVdvcmtlcixcclxufTsiLCJmdW5jdGlvbiBSYXRpbmdTZWxlY3Qoc2VsZWN0b3IsIG9wdGlvbnMpIHtcclxuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICBvcHRpb25zLm1heCA9IG9wdGlvbnMubWF4IHx8IDU7XHJcblxyXG4gIHRoaXMucmF0aW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XHJcblxyXG4gIHRoaXMuc3Rhckxpc3QgPSBbXTtcclxuXHJcbiAgaWYgKCF0aGlzLnJhdGluZykge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgb3B0aW9ucy5sYWJlbCk7XHJcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3JhZGlvZ3JvdXAnKTtcclxuICB0aGlzLnJhdGluZy5jbGFzc05hbWUgPSAncmF0aW5nLXNlbGVjdCc7XHJcblxyXG4gIGZvciAobGV0IGkgPSAxOyBpIDw9IG9wdGlvbnMubWF4OyBpKyspIHtcclxuICAgIGNvbnN0IHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHN0YXIuY2xhc3NOYW1lID0gJ3JhdGluZy1zZWxlY3RfX2l0ZW0nO1xyXG4gICAgc3Rhci5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAncmFkaW8nKTtcclxuICAgIHN0YXIuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XHJcbiAgICBzdGFyLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcclxuICAgIHN0YXIuc2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJywgaSk7XHJcbiAgICB0aGlzLnN0YXJMaXN0LnB1c2goc3Rhcik7XHJcbiAgICBzdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblJhdGluZ0VsZW1lbnRDbGljay5iaW5kKHRoaXMpKTtcclxuICAgIHRoaXMucmF0aW5nLmFwcGVuZChzdGFyKTtcclxuICB9XHJcblxyXG4gIHRoaXMucmF0aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmhhbmRsZUtleURvd24uYmluZCh0aGlzKSk7XHJcbiAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gMDtcclxuXHJcbiAgdGhpcy5yYXRpbmdJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgMCk7XHJcbiAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBvcHRpb25zLmlucHV0TmFtZSB8fCAncmF0aW5nJyk7XHJcbiAgdGhpcy5yYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ2lkJywgb3B0aW9ucy5pbnB1dE5hbWUgfHwgJ3JhdGluZycpO1xyXG4gIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpO1xyXG4gIHRoaXMucmF0aW5nLmFwcGVuZCh0aGlzLnJhdGluZ0lucHV0KTtcclxufVxyXG5cclxuUmF0aW5nU2VsZWN0LnByb3RvdHlwZSA9IHtcclxuXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWVub3cnLCAwKTtcclxuICAgIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIDApO1xyXG4gICAgdGhpcy5hY3RpdmVJdGVtSWR4ID0gMDtcclxuICAgIHRoaXMuc3Rhckxpc3QuZm9yRWFjaChlbCA9PiB7XHJcbiAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ3JhdGluZy1zZWxlY3RfX2l0ZW0tLWNoZWNrZWQnKTtcclxuICAgICAgZWwuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBmYWxzZSk7XHJcbiAgICAgIGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAtMSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc3Rhckxpc3RbMF0uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xyXG4gIH0sXHJcblxyXG4gIG9uUmF0aW5nRWxlbWVudENsaWNrKGUpIHtcclxuICAgIGNvbnN0IGNsaWNrZWRTdGFySW5kZXggPSB0aGlzLnN0YXJMaXN0LmluZGV4T2YoZS50YXJnZXQpO1xyXG5cclxuICAgIGlmICghY2xpY2tlZFN0YXJJbmRleCA9PT0gLTEpIHJldHVybjtcclxuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IGNsaWNrZWRTdGFySW5kZXg7XHJcblxyXG4gICAgdGhpcy5zdGFyTGlzdC5tYXAoKGVsLCBpKSA9PiB7XHJcbiAgICAgIGVsLmNsYXNzTGlzdC50b2dnbGUoJ3JhdGluZy1zZWxlY3RfX2l0ZW0tLWNoZWNrZWQnLCBpIDw9IGNsaWNrZWRTdGFySW5kZXgpO1xyXG4gICAgICBpZiAoaSA9PT0gY2xpY2tlZFN0YXJJbmRleCkge1xyXG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgdHJ1ZSk7XHJcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgZmFsc2UpO1xyXG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAtMSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgdmFsID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7XHJcbiAgICB0aGlzLnJhdGluZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnLCB2YWwpO1xyXG4gICAgdGhpcy5yYXRpbmcuc2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbm93JywgdmFsKTtcclxuICAgIHRoaXMucmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIHZhbCk7XHJcblxyXG4gIH0sXHJcblxyXG4gIGhhbmRsZUtleURvd24oZSkge1xyXG4gICAgLy8gRGVmaW5lIHZhbHVlcyBmb3Iga2V5Y29kZXNcclxuICAgIGNvbnN0IFZLX0VOVEVSID0gMTM7XHJcbiAgICBjb25zdCBWS19FU0MgPSAyNztcclxuICAgIGNvbnN0IFZLX1NQQUNFID0gMzI7XHJcbiAgICBjb25zdCBWS19MRUZUID0gMzc7XHJcbiAgICBjb25zdCBWS19VUCA9IDM4O1xyXG4gICAgY29uc3QgVktfUklHSFQgPSAzOTtcclxuICAgIGNvbnN0IFZLX0RPV04gPSA0MDtcclxuXHJcbiAgICBpZiAoW1ZLX0RPV04sIFZLX1VQLCBWS19TUEFDRSwgVktfRU5URVIsIFZLX0xFRlQsIFZLX1JJR0hULCBWS19FU0NdLmluZGV4T2YoZS5rZXlDb2RlKSA9PT0gLTEpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgY2FzZSBWS19ET1dOOlxyXG4gICAgICBjYXNlIFZLX1JJR0hUOlxyXG4gICAgICAgIHRoaXMubmV4dEFjdGl2ZUxpc3RJdGVtKCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgVktfVVA6XHJcbiAgICAgIGNhc2UgVktfTEVGVDpcclxuICAgICAgICB0aGlzLnByZXZpb3VzQWN0aXZlTGlzdEl0ZW0oKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBWS19TUEFDRTpcclxuICAgICAgICB0aGlzLm9uUmF0aW5nRWxlbWVudENsaWNrKGUpO1xyXG4gICAgICAgIHRoaXMucmF0aW5nLmZvY3VzKCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgVktfRU5URVI6XHJcbiAgICAgICAgdGhpcy5vblJhdGluZ0VsZW1lbnRDbGljayhlKTtcclxuICAgICAgICB0aGlzLnJhdGluZy5mb2N1cygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFZLX0VTQzpcclxuICAgICAgICB0aGlzLnJhdGluZy5mb2N1cygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybjtcclxuICB9LFxyXG5cclxuICBuZXh0QWN0aXZlTGlzdEl0ZW0oKSB7XHJcbiAgICBjb25zdCBuZXh0RWxlbWVudEluZGV4ID0gKHRoaXMuYWN0aXZlSXRlbUlkeCA+PSB0aGlzLnN0YXJMaXN0Lmxlbmd0aCAtIDEpID8gMCA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggKyAxKTtcclxuICAgIHRoaXMuc3Rhckxpc3RbbmV4dEVsZW1lbnRJbmRleF0uZm9jdXMoKTtcclxuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IG5leHRFbGVtZW50SW5kZXg7XHJcbiAgfSxcclxuXHJcbiAgcHJldmlvdXNBY3RpdmVMaXN0SXRlbSgpIHtcclxuICAgIGNvbnN0IHByZXZFbGVtZW50SW5kZXggPSAodGhpcy5hY3RpdmVJdGVtSWR4ID09PSAwKSA/IHRoaXMuc3Rhckxpc3QubGVuZ3RoIC0gMSA6ICh0aGlzLmFjdGl2ZUl0ZW1JZHggLSAxKTtcclxuICAgIHRoaXMuc3Rhckxpc3RbcHJldkVsZW1lbnRJbmRleF0uZm9jdXMoKTtcclxuICAgIHRoaXMuYWN0aXZlSXRlbUlkeCA9IHByZXZFbGVtZW50SW5kZXg7XHJcbiAgfSxcclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUmF0aW5nU2VsZWN0OyIsImNvbnN0IERCSGVscGVyID0gcmVxdWlyZSgnLi9kYmhlbHBlcicpO1xyXG5jb25zdCBUYXNrU2VydmljZSA9IHJlcXVpcmUoJy4vdGFzay1zZXJ2aWNlJyk7XHJcbmNvbnN0IHByb2Nlc3MgPSByZXF1aXJlKCcuL3Byb2Nlc3MnKTtcclxuY29uc3QgUmF0aW5nU2VsZWN0ID0gcmVxdWlyZSgnLi9yYXRpbmctc2VsZWN0Jyk7XHJcblxyXG5sZXQgcmVzdGF1cmFudDtcclxudmFyIG1hcDtcclxuY29uc3QgdGFza1NlcnZpY2UgPSBuZXcgVGFza1NlcnZpY2UoKTtcclxuY29uc3Qgc3RhdHVzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcnZlci1zdGF0dXMtYmFyJyk7XHJcblxyXG5wcm9jZXNzLnJlZ2lzdGVyU2VydmljZVdvcmtlcigpO1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VydmVyc3RhdHVzJywgZnVuY3Rpb24gKGUpIHtcclxuICBzdGF0dXNCYXIuY2xhc3NMaXN0LnRvZ2dsZSgnLW9ubGluZScsIGUuZGV0YWlsLm9ubGluZSk7XHJcbn0sIGZhbHNlKTtcclxuXHJcbnJhdGluZ0Zvcm0oKTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBjb25zb2xlLmxvZygnaW5pdE1hcCcpO1xyXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgICAgem9vbTogMTYsXHJcbiAgICAgIGNlbnRlcjogc2VsZi5yZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICB9KTtcclxuICB9LCAyMDApO1xyXG59O1xyXG5cclxuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpLnRoZW4ocmVzdGF1cmFudCA9PiB7XHJcbiAgY29uc29sZS5sb2coJ3Jlc3RhdXJhbnQgLT4gJywgcmVzdGF1cmFudCk7XHJcbiAgaWYgKHR5cGVvZiByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IEpTT04ucGFyc2UocmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcclxuICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuICBhZGRGYXZvcml0ZUJ1dHRvbigpO1xyXG5cclxuICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBtYXApO1xyXG5cclxufSkuY2F0Y2goZXJyID0+IHtcclxuICBjb25zb2xlLmVycm9yKGVycik7XHJcbn0pO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5mdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKGZvcmNlID0gZmFsc2UpIHtcclxuICBpZiAoIWZvcmNlICYmIHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuICAgIHJldHVybiBzZWxmLnJlc3RhdXJhbnQ7XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkKS50aGVuKChyZXN0YXVyYW50KSA9PiB7XHJcblxyXG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3RhdXJhbnQnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnQ7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcclxuICovXHJcbmZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSB7XHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBuYW1lLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBgQW4gaW1hZ2UgZnJvbSB0aGUgcmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX1gKTtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgY3Vpc2luZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcclxuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xyXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuICB9XHJcbiAgLy8gZmlsbCByZXZpZXdzXHJcbiAgZmlsbFJldmlld3NIVE1MKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgdGltZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBvcGVyYXRpbmdIb3Vyc1trZXldICsgJywnKTsgLy8gZm9yIHNjcmVlbiByZWFkZXJcclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZ1bmN0aW9uIGZpbGxSZXZpZXdzSFRNTChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpIHtcclxuXHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XHJcblxyXG4gIGlmICghcmV2aWV3cykge1xyXG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFyUmV2aWV3c0h0bWwoKSB7XHJcbiAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZXZpZXdzLWxpc3QtaXRlbScpLFxyXG4gICAgbGkgPT4gbGkucmVtb3ZlKClcclxuICApO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVSZXZpZXdIVE1MKHJldmlldykge1xyXG5cclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgbGkuY2xhc3NOYW1lID0gJ3Jldmlld3MtbGlzdC1pdGVtJztcclxuICBsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAncmV2aWV3Jyk7XHJcblxyXG4gIGNvbnN0IHJldmlld2VySW5mb0Jsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgcmV2aWV3ZXJJbmZvQmxvY2suY2xhc3NOYW1lID0gJ3Jldmlld2VyLWluZm8nO1xyXG5cclxuICBjb25zdCByZXZpZXdlck5hbWVEYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgcmV2aWV3ZXJOYW1lRGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3ZXItaW5mb19fbmFtZS1kYXRlJztcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XHJcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcclxuICBuYW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJldmlldy5uYW1lKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGF0ZScpO1xyXG4gIGRhdGUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KS50b0RhdGVTdHJpbmcoKTtcclxuXHJcbiAgcmV2aWV3ZXJOYW1lRGF0ZS5hcHBlbmRDaGlsZChuYW1lKTtcclxuICByZXZpZXdlck5hbWVEYXRlLmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuICByZXZpZXdlckluZm9CbG9jay5hcHBlbmRDaGlsZChyZXZpZXdlck5hbWVEYXRlKTtcclxuXHJcbiAgcmV2aWV3ZXJJbmZvQmxvY2suYXBwZW5kQ2hpbGQoY3JlYXRlUmF0aW5nU3RhcnNCbG9jayhyZXZpZXcucmF0aW5nKSk7XHJcblxyXG4gIGxpLmFwcGVuZENoaWxkKHJldmlld2VySW5mb0Jsb2NrKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgY29tbWVudHMuY2xhc3NOYW1lID0gJ3Jldmlld2VyLWNvbW1lbnQnO1xyXG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcclxuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUmF0aW5nU3RhcnNCbG9jayhyYXRpbmdWYWx1ZSkge1xyXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuXHJcbiAgcmF0aW5nLmFwcGVuZENoaWxkKCgoKSA9PiB7XHJcbiAgICBsZXQgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgIHNwYW4uY2xhc3NOYW1lID0gJ3JhdGluZy1udW1iZXInO1xyXG4gICAgc3Bhbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcclxuICAgIHNwYW4uaW5uZXJIVE1MID0gJ1JhdGluZyA6ICcgKyByYXRpbmdWYWx1ZTtcclxuICAgIHJldHVybiBzcGFuO1xyXG4gIH0pKCkpO1xyXG5cclxuICBsZXQgcmF0aW5nU3RhcnMgPSAn4piFJy5yZXBlYXQoK3JhdGluZ1ZhbHVlKTtcclxuXHJcbiAgaWYgKCtyYXRpbmdWYWx1ZSA8IDUpIHtcclxuICAgIHJhdGluZ1N0YXJzID0gcmF0aW5nU3RhcnMgKyAn4piGJy5yZXBlYXQoNSAtICtyYXRpbmdWYWx1ZSk7XHJcbiAgfVxyXG4gIGNvbnN0IHJhdGluZ1N0YXJzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICByYXRpbmdTdGFyc0VsZW1lbnQuY2xhc3NOYW1lID0gJ3JhdGluZy1zdGFycyc7XHJcbiAgcmF0aW5nU3RhcnNFbGVtZW50LmlubmVySFRNTCA9IHJhdGluZ1N0YXJzO1xyXG4gIHJhdGluZy5hcHBlbmRDaGlsZChyYXRpbmdTdGFyc0VsZW1lbnQpO1xyXG5cclxuICByZXR1cm4gcmF0aW5nO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpIHtcclxuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVSYXRpbmdTZWxlY3QoKSB7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiByYXRpbmdGb3JtKCkge1xyXG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VuZC1yYXRpbmctZm9ybScpO1xyXG4gIGlmICghZm9ybSkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgc2VsZWN0ID0gbmV3IFJhdGluZ1NlbGVjdCgnI3JhdGluZy1zZWxlY3QnLCB7XHJcbiAgICBsYWJlbDogJ1JhdGluZycsXHJcbiAgICBtYXg6IDUsXHJcbiAgfSk7XHJcblxyXG4gIGZvcm0ub25zdWJtaXQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBuYW1lOiB7dmFsdWU6IG5hbWV9LFxyXG4gICAgICByYXRpbmc6IHt2YWx1ZTogcmF0aW5nfSxcclxuICAgICAgY29tbWVudHM6IHt2YWx1ZTogY29tbWVudHN9XHJcbiAgICB9ID0gZS50YXJnZXQuZWxlbWVudHM7XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKFxyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjc2VuZC1yYXRpbmctZm9ybSAuZm9ybS1ncm91cCcpLFxyXG4gICAgICBlbCA9PiBlbC5jbGFzc0xpc3QucmVtb3ZlKCdoYXMtZXJyb3InKVxyXG4gICAgKTtcclxuXHJcbiAgICBsZXQgdmFsaWQgPSB0cnVlO1xyXG5cclxuICAgIGlmICghbmFtZS50cmltKCkpIHtcclxuICAgICAgY29uc3QgZmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1maWVsZD1cIm5hbWVcIl0nKTtcclxuICAgICAgZmllbGQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoYXMtZXJyb3InKTtcclxuICAgICAgZmllbGQuaW5uZXJIVE1MID0gJ0VudGVyIHlvdXIgbmFtZSc7XHJcbiAgICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAocmF0aW5nIDw9IDApIHtcclxuICAgICAgY29uc3QgZmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1maWVsZD1cInJhdGluZ1wiXScpO1xyXG4gICAgICBmaWVsZC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hhcy1lcnJvcicpO1xyXG4gICAgICBmaWVsZC5pbm5lckhUTUwgPSAnU2V0IHJhdGluZyc7XHJcbiAgICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIWNvbW1lbnRzLnRyaW0oKSkge1xyXG4gICAgICBjb25zdCBmaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWZpZWxkPVwiY29tbWVudHNcIl0nKTtcclxuICAgICAgZmllbGQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoYXMtZXJyb3InKTtcclxuICAgICAgZmllbGQuaW5uZXJIVE1MID0gJ0VudGVyIGNvbW1lbnQnO1xyXG4gICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdmFsaWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGN1ckRhdGUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xyXG5cclxuICAgIGNvbnN0IHJldmlldyA9IHtcclxuICAgICAgcmVzdGF1cmFudF9pZDogc2VsZi5yZXN0YXVyYW50LmlkLFxyXG4gICAgICBuYW1lLFxyXG4gICAgICByYXRpbmcsXHJcbiAgICAgIGNvbW1lbnRzLFxyXG4gICAgICBjcmVhdGVkQXQ6IGN1ckRhdGUsXHJcbiAgICAgIHVwZGF0ZWRBdDogY3VyRGF0ZSxcclxuICAgIH07XHJcblxyXG4gICAgYWRkUmV2aWV3Q29tbWVudChyZXZpZXcpO1xyXG4gICAgZm9ybS5yZXNldCgpO1xyXG4gICAgc2VsZWN0LnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRSZXZpZXdDb21tZW50KHJldmlldykge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIGNvbnN0IGxpID0gY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpO1xyXG4gIGxpLmNsYXNzTGlzdC5hZGQoJy1hZGRlZCcpO1xyXG4gIHVsLmFwcGVuZENoaWxkKGxpKTtcclxuICB0YXNrU2VydmljZS5zYXZlUmV2aWV3KHJldmlldywgKCkgPT4ge1xyXG4gICAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCh0cnVlKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xyXG4gICAgICBjbGVhclJldmlld3NIdG1sKCk7XHJcbiAgICAgIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkZEZhdm9yaXRlQnV0dG9uKCkge1xyXG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWxpa2UnKTtcclxuICBjb25zb2xlLmxvZygnYWRkRmF2b3JpdGVCdXR0b24tLTonLCBzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpO1xyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpIHtcclxuICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkLWxpa2UtLWxpa2VkJyk7XHJcbiAgfVxyXG5cclxuICBidXR0b24ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XHJcblxyXG4gICAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKCdjYXJkLWxpa2UtLWxpa2VkJyk7XHJcblxyXG4gICAgdGFza1NlcnZpY2UudG9nZ2xlRmF2b3JpdGUoXHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCxcclxuICAgICAgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xyXG4gICAgICAgIGZldGNoUmVzdGF1cmFudEZyb21VUkwodHJ1ZSk7IC8vIHVwZGF0ZSBpbiBpbmRleGVkRGJcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xyXG4gIGlmICghdXJsKVxyXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XHJcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xyXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxyXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcclxuICBpZiAoIXJlc3VsdHMpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFyZXN1bHRzWzJdKSB7XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xyXG59XHJcbiIsImNvbnN0IERCSGVscGVyID0gcmVxdWlyZSgnLi9kYmhlbHBlcicpO1xyXG5cclxuZnVuY3Rpb24gVGFza1NlcnZpY2UoKSB7XHJcbiAgdGhpcy53b3JrZXIgPSBuZXcgV29ya2VyKCd0YXNrLXdvcmtlci5qcycpO1xyXG4gIHRoaXMuam9iSWQgPSAwO1xyXG4gIHRoaXMud29ya2VyLm9ubWVzc2FnZSA9ICh7IGRhdGE6IHsgaWQgPSAwLCBhY3Rpb24sIHJlc3VsdCB9IH0pID0+IHtcclxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ29mZmxpbmUnOlxyXG4gICAgICBjYXNlICdvbmxpbmUnOlxyXG4gICAgICAgIGNvbnN0IHN0YXR1c0V2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdzZXJ2ZXJzdGF0dXMnLCB7IGRldGFpbDogeyBvbmxpbmU6IGFjdGlvbiA9PT0gJ29ubGluZScgfSB9KTtcclxuICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KHN0YXR1c0V2ZW50KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICBpZiAodGhpcy53b3JrZXJDYWxsYmFja3NbaWRdKSB7XHJcbiAgICAgICAgICB0aGlzLndvcmtlckNhbGxiYWNrc1tpZF0ocmVzdWx0KTtcclxuICAgICAgICAgIGRlbGV0ZSB0aGlzLndvcmtlckNhbGxiYWNrc1tpZF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdGhpcy53b3JrZXJDYWxsYmFja3MgPSB7XHJcbiAgICBvblJldmlld1NhdmU6IFtdLFxyXG4gIH07XHJcblxyXG59XHJcblxyXG5UYXNrU2VydmljZS5wcm90b3R5cGUgPSB7XHJcblxyXG4gIGJlZm9yZVRhc2tBZGQoKSB7XHJcbiAgICB0aGlzLmpvYklkID0gdGhpcy5qb2JJZCArIDE7XHJcbiAgfSxcclxuXHJcbiAgYWRkQ2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy53b3JrZXJDYWxsYmFja3NbdGhpcy5qb2JJZF0gPSBjYWxsYmFjaztcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBzYXZlUmV2aWV3KHJldmlldywgY2FsbGJhY2spIHtcclxuICAgIHRoaXMuYmVmb3JlVGFza0FkZCgpO1xyXG5cclxuICAgIC8vIHRoZW4gc2VuZCBkYXRhIHRvIEFQSVxyXG4gICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICBpZDogdGhpcy5qb2JJZCxcclxuICAgICAgYWN0aW9uOiAnc2F2ZV9yZXZpZXcnLFxyXG4gICAgICBwYXlsb2FkOiByZXZpZXdcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuYWRkQ2FsbGJhY2soY2FsbGJhY2spO1xyXG4gIH0sXHJcblxyXG4gIHRvZ2dsZUZhdm9yaXRlKHJlc3RhdXJhbnQsIGNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLmJlZm9yZVRhc2tBZGQoKTtcclxuXHJcbiAgICAvLyB0aGVuIHNlbmQgZGF0YSB0byBBUElcclxuICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHtcclxuICAgICAgaWQ6IHRoaXMuam9iSWQsXHJcbiAgICAgIGFjdGlvbjogJ3NldF9mYXZvcml0ZScsXHJcbiAgICAgIHBheWxvYWQ6IHtcclxuICAgICAgICBpZDogdGhpcy5qb2JJZCxcclxuICAgICAgICByZXN0YXVyYW50SWQ6IHJlc3RhdXJhbnQuaWQsXHJcbiAgICAgICAgaXNGYXZvcml0ZTogIUpTT04ucGFyc2Uoc2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSxcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5hZGRDYWxsYmFjayhjYWxsYmFjayk7XHJcbiAgfSxcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tTZXJ2aWNlOyJdfQ==
