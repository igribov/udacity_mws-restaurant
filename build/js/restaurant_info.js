"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function a(i,u,c){function s(t,e){if(!u[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[t]={exports:{}};i[t][0].call(o.exports,function(e){return s(i[t][1][e]||e)},o,o.exports,a,i,u,c)}return u[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({1:[function(e,p,t){!function(){function i(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function a(n,r,o){var a,e=new Promise(function(e,t){i(a=n[r].apply(n,o)).then(e,t)});return e.request=a,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return a(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=a(e,n,arguments)).then(function(e){if(e)return new u(e,t.request)});var e,t})})}function o(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function s(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new s(n)}function f(e){this._db=e}e(o,"_index",["name","keyPath","multiEntry","unique"]),t(o,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(o,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(u,"_cursor",["direction","key","primaryKey","value"]),t(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(u.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),i(t._request).then(function(e){if(e)return new u(e,t._request)})})})}),c.prototype.createIndex=function(){return new o(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new o(this._store.index.apply(this._store,arguments))},e(c,"_store",["name","keyPath","indexNames","autoIncrement"]),t(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(c,"_store",IDBObjectStore,["deleteIndex"]),s.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},e(s,"_tx",["objectStoreNames","mode"]),n(s,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new s(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[c,o].forEach(function(e){a in e.prototype&&(e.prototype[a.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,o=r[a].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}})})}),[o,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});var d={open:function(e,t,n){var r=a(indexedDB,"open",[e,t]),o=r.request;return o.onupgradeneeded=function(e){n&&n(new l(o.result,e.oldVersion,o.transaction))},r.then(function(e){return new f(e)})},delete:function(e){return a(indexedDB,"deleteDatabase",[e])}};void 0!==p?(p.exports=d,p.exports.default=p.exports):self.idb=d}()},{}],2:[function(e,t,n){var r=e("idb"),a="restaurants",o=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(){var t=this;return fetch(o.DATABASE_URL+"/restaurants").then(function(e){return e.json()}).then(function(e){return t.putRestaurantsIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return o.fetchRestaurantsFromIndexedDb().then(function(e){if(e.length)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurant",value:function(t){var n=this;return fetch(o.DATABASE_URL+"/restaurants/"+t).then(function(e){return e.json()}).then(function(e){return n.putRestaurantIntoIndexedDb(e).then(function(){return e})}).catch(function(e){return o.fetchRestaurantFromIndexedDb(t).then(function(e){if(e)return e;throw new Error("Fetch error")})})}},{key:"fetchRestaurantsFromIndexedDb",value:function(){return o.openDatabase().then(function(e){return e.transaction(a).objectStore(a).getAll()})}},{key:"fetchRestaurantFromIndexedDb",value:function(t){return o.openDatabase().then(function(e){return e.transaction(a).objectStore(a).get(+t)})}},{key:"putRestaurantsIntoIndexedDb",value:function(n){return o.clearRestaurantsInIndexedDb().then(function(){return o.openDatabase().then(function(e){var t=e.transaction(a,"readwrite");return n.forEach(function(e){return t.objectStore(a).put(e)}),t.complete})})}},{key:"putRestaurantIntoIndexedDb",value:function(n){return o.openDatabase().then(function(e){var t=e.transaction(a,"readwrite");return t.objectStore(a).put(n),t.complete})}},{key:"clearRestaurantsInIndexedDb",value:function(){return o.openDatabase().then(function(e){var t=e.transaction(a,"readwrite");return t.objectStore(a).clear(),t.complete})}},{key:"openDatabase",value:function(){return r.open("restaurants-db",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore(a,{keyPath:"id"}).createIndex("status","status")}})}},{key:"fetchRestaurantById",value:function(e){return o.fetchRestaurant(e).then(function(e){return e})}},{key:"fetchRestaurantByCuisine",value:function(t,e){o.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return o.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return o.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoods",value:function(){return o.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"fetchCuisines",value:function(){return o.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].cuisine_type});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.id+"_medium.jpg"}},{key:"imageSrcSetForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),o}();t.exports=o},{idb:1}],3:[function(e,t,n){function r(e){e?e.addEventListener("statechange",function(){console.log("ServiceWorker state was changed to "+e.state),"installed"===e.state&&(console.log("Service worker installed and waiting for activation",e),o(e))}):console.log("Worker not defined!")}function o(e){var r,o;(r={action:"skipWaiting"},o=e,new Promise(function(t,n){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?n(e.data.error):t(e.data)},o.postMessage(r,[e.port2])})).then(function(e){console.log(e)})}t.exports={registerServiceWorker:function(){if(!1 in navigator)throw new Error("serviceWorker not register");navigator.serviceWorker.register("/sw.js").then(function(e){var t;navigator.serviceWorker.controller&&(e.active&&console.log("There is an an active service worker"),e.waiting&&(console.log("waiting :",e.waiting),console.log("service worker is waiting"),o(e.waiting)),e.installing&&(console.log("installing : ",e),console.log("service worker status is installing"),r(e.installing)),e.addEventListener("updatefound",function(){console.log("service worker update found",e),r(e.installing)}),navigator.serviceWorker.addEventListener("controllerchange",function(){t||setTimeout(function(){window.location.reload(),t=!0},1e3)}))}).catch(function(e){console.log("Registration failed with "+e)})}}},{}],4:[function(e,t,n){var o=e("./dbhelper"),r=e("./process");window.initMap=function(){r.registerServiceWorker(),function(){if(self.restaurant)return self.restaurant;var e=function(e,t){t||(t=window.location.href);e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))}("id");{if(e)return o.fetchRestaurantById(e).then(function(e){if(!(self.restaurant=e))throw new Error("No restaurant");return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name,t.setAttribute("tabindex","0"),document.getElementById("restaurant-address").innerHTML=e.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.setAttribute("alt","An image from the restaurant "+e.name),n.src=o.imageUrlForRestaurant(e);var r=document.getElementById("restaurant-cuisine");r.setAttribute("tabindex","0"),r.innerHTML=e.cuisine_type,e.operating_hours&&function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),o=document.createElement("td");o.innerHTML=n,r.appendChild(o);var a=document.createElement("td");a.innerHTML=e[n],a.setAttribute("aria-label",e[n]+","),r.appendChild(a),t.appendChild(r)}}();!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container");if(!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",t.appendChild(n)}var r=document.getElementById("reviews-list");e.forEach(function(e){r.appendChild(function(e){var t=document.createElement("li");t.setAttribute("tabindex","0"),t.className="reviews-list-item",t.setAttribute("aria-label","review");var n=document.createElement("div");n.className="reviewer-info";var r=document.createElement("div");r.className="reviewer-info__name-date";var o=document.createElement("h3");o.setAttribute("tabindex","0"),o.setAttribute("aria-label",e.name),o.innerHTML=e.name;var a=document.createElement("date");a.setAttribute("tabindex","0"),a.innerHTML=e.date,r.appendChild(o),r.appendChild(a),n.appendChild(r),n.appendChild(function(e){var t=document.createElement("p");t.appendChild((n=document.createElement("span"),n.className="rating-number",n.setAttribute("tabindex","0"),n.innerHTML="Rating : "+e,n));var n;var r="★".repeat(+e);+e<5&&(r+="☆".repeat(5-+e));var o=document.createElement("span");return o.className="rating-stars",o.innerHTML=r,t.appendChild(o),t}(e.rating)),t.appendChild(n);var i=document.createElement("p");return i.setAttribute("tabindex","0"),i.className="reviewer-comment",i.innerHTML=e.comments,t.appendChild(i),t}(e))}),t.appendChild(r)}()}(),e});throw new Error("No restaurant id in URL")}}().then(function(e){self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}(),o.mapMarkerForRestaurant(self.restaurant,self.map)}).catch(function(e){console.error(e)})}},{"./dbhelper":2,"./process":3}]},{},[4]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzcmMvanMvZGJoZWxwZXIuanMiLCJzcmMvanMvcHJvY2Vzcy5qcyIsInNyYy9qcy9yZXN0YXVyYW50X2luZm8uanMiXSwibmFtZXMiOlsicmVzdWx0IiwiZXJyb3IiLCJyZXF1ZXN0IiwiYXJncyIsInJlamVjdCIsInAiLCJwcm9wIiwidmFsIiwiYXJndW1lbnRzIiwiaW5kZXgiLCJjdXJzb3IiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwicmVzb2x2ZSIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwidGhpcyIsIl9yZXF1ZXN0IiwiYXJyIiwiX2luZGV4IiwidmFsdWUiLCJjb250aW51ZSIsIml0ZW1zIiwidmVyc2lvbiIsIm5hbWUiLCJleHAiLCJleHBvcnRzIiwiaWRiIiwicmVxdWlyZSIsIkRCX1JFU1RBVVJBTlRTX1RBQkxFIiwiREJIZWxwZXIiLCJfdGhpcyIsIkRBVEFCQVNFX1VSTCIsInRoZW4iLCJkYXRhIiwianNvbiIsInJlc3RhdXJhbnRzIiwicHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiIiwiY2F0Y2giLCJlcnIiLCJmZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYiIsImxlbmd0aCIsIkVycm9yIiwiaWQiLCJfdGhpczIiLCJyZXN0YXVyYW50IiwicHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIiLCJmZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiIiwib3BlbkRhdGFiYXNlIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJnZXQiLCJjbGVhclJlc3RhdXJhbnRzSW5JbmRleGVkRGIiLCJ0eCIsImZvckVhY2giLCJwdXQiLCJjb21wbGV0ZSIsImNsZWFyIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiZmV0Y2hSZXN0YXVyYW50IiwiY3Vpc2luZSIsImNhbGxiYWNrIiwiZmV0Y2hSZXN0YXVyYW50cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJyZXN1bHRzIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJsYXRsbmciLCJ1cmxGb3JSZXN0YXVyYW50IiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1vZHVsZSIsInRyYWNrSW5zdGFsbGluZyIsImluc3RhbGxpbmdXb3JrZXIiLCJhZGRFdmVudExpc3RlbmVyIiwibG9nIiwic3RhdGUiLCJ1cGRhdGVTZXJ2aWNlV29ya2VyIiwid29ya2VyIiwibXNnIiwiYWN0aW9uIiwiUHJvbWlzZSIsIm1zZ0NoYW4iLCJNZXNzYWdlQ2hhbm5lbCIsInBvcnQxIiwib25tZXNzYWdlIiwiZXZlbnQiLCJwb3N0TWVzc2FnZSIsInBvcnQyIiwicmVzcG9uc2VGcm9tU3ciLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWciLCJyZWZyZXNoaW5nIiwiY29udHJvbGxlciIsImFjdGl2ZSIsIndhaXRpbmciLCJpbnN0YWxsaW5nIiwibG9jYXRpb24iLCJyZWxvYWQiLCJwcm9jZXNzIiwid2luZG93IiwiaW5pdE1hcCIsInNlbGYiLCJ1cmwiLCJocmVmIiwicmVwbGFjZSIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwidW5kZWZpbmVkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsInNldEF0dHJpYnV0ZSIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsIm9wZXJhdGluZ19ob3VycyIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwidWwiLCJyZXZpZXciLCJsaSIsInJldmlld2VySW5mb0Jsb2NrIiwicmV2aWV3ZXJOYW1lRGF0ZSIsImRhdGUiLCJyYXRpbmdWYWx1ZSIsInJhdGluZyIsInNwYW4iLCJyYXRpbmdTdGFycyIsInJlcGVhdCIsInJhdGluZ1N0YXJzRWxlbWVudCIsImNyZWF0ZVJhdGluZ1N0YXJzQmxvY2siLCJjb21tZW50cyIsImNyZWF0ZVJldmlld0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJNYXAiLCJicmVhZGNydW1iIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50Il0sIm1hcHBpbmdzIjoieXlCQUFBLDJHQ1dBQSxrQ0FJQUMsZ0NBTUFDLCtDQUVBQyxXQUNBQyxzQkFHQUYsRUFDQUcsNkdBZUFDLCtCQUdBQyxpSEFVQUMsc0lBU0FBLGdJQVNBQSxtREF2Q0FOLGlEQTZDQU8sK0JBd0JBQyxnQkFDQVIsNEJBZ0NBUyx5QkF3Q0FDLGtFQUdBQyw4QkFHQVosaUNBR0FBLHFDQW1CQWEsa0JBQ0FDLHlCQUNBQywwQkFtQkFGLGVBL0lBLENBQ0EsT0FDQSxVQUNBLGFBQ0EsaUNBR0EsQ0FDQSxNQUNBLFNBQ0EsU0FDQSxhQUNBLGdDQUdBLENBQ0EsYUFDQSxnQ0FRQSxDQUNBLFlBQ0EsTUFDQSxhQUNBLGtDQUdBLENBQ0EsU0FDQSxzSUFPQUcsT0FDQVQsdUZBRUFMLHdEQUdBZSw0R0FXQVYsMkZBSUFBLDBCQUdBLENBQ0EsT0FDQSxVQUNBLGFBQ0EsOENBR0EsQ0FDQSxNQUNBLE1BQ0EsU0FDQSxRQUNBLE1BQ0EsU0FDQSxTQUNBLGFBQ0Esc0NBR0EsQ0FDQSxhQUNBLDhDQUdBLENBQ0Esb0dBbUJBQSx1QkFH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NkgsRUFBYXhDLFNBQUFDLGVBQW5CLGNBQ011QixFQUFLeEIsU0FBQWMsY0FBWCxRQUNBWixVQUFldkYsRUFBZnJCLE9BQ0EwSCxZQUFBUSxHQTdLRWlCLEtBQUFDLHVCQUFnQ3BELEtBQWhDM0UsV0FBaUQyRSxLQUFqRC9DLE9BUEZuQyxNQVNTLFNBQUFDLFdBQ1B2QyxNQUFBdUMiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsImNvbnN0IGlkYiAgPSByZXF1aXJlKCdpZGInKTtcclxuY29uc3QgQVBQX0RCX05BTUUgPSAncmVzdGF1cmFudHMtZGInO1xyXG5jb25zdCBEQl9SRVNUQVVSQU5UU19UQUJMRSA9ICdyZXN0YXVyYW50cyc7XHJcbmNvbnN0IEFQUF9EQl9WRVIgPSAxO1xyXG5cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cygpIHtcclxuICAgIHJldHVybiBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwgKyAnL3Jlc3RhdXJhbnRzJylcclxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnB1dFJlc3RhdXJhbnRzSW50b0luZGV4ZWREYihyZXN0YXVyYW50cykudGhlbigoKSA9PiByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREYigpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgICAgaWYgKCFyZXN0YXVyYW50cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGZXRjaCBlcnJvcicpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50KGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfS9yZXN0YXVyYW50cy8ke2lkfWApXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gZGF0YS5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnB1dFJlc3RhdXJhbnRJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnQpLnRoZW4oKCkgPT4gcmVzdGF1cmFudCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIHJldHVybiBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRGcm9tSW5kZXhlZERiKGlkKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmV0Y2ggZXJyb3InKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50c0Zyb21JbmRleGVkRGIoKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKClcclxuICAgICAgLnRoZW4oZGIgPT4gZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXRBbGwoKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50RnJvbUluZGV4ZWREYihpZCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT5cclxuICAgICAgZGIudHJhbnNhY3Rpb24oREJfUkVTVEFVUkFOVFNfVEFCTEUpLm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5nZXQoK2lkKSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudHNJbnRvSW5kZXhlZERiKHJlc3RhdXJhbnRzKSB7XHJcbiAgICByZXR1cm4gREJIZWxwZXIuY2xlYXJSZXN0YXVyYW50c0luSW5kZXhlZERiKCkudGhlbigoKSA9PiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCkpO1xyXG4gICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHV0UmVzdGF1cmFudEludG9JbmRleGVkRGIocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKERCX1JFU1RBVVJBTlRTX1RBQkxFLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgIHR4Lm9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFKS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNsZWFyUmVzdGF1cmFudHNJbkluZGV4ZWREYigpIHtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihEQl9SRVNUQVVSQU5UU19UQUJMRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICB0eC5vYmplY3RTdG9yZShEQl9SRVNUQVVSQU5UU19UQUJMRSkuY2xlYXIoKTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgb3BlbkRhdGFiYXNlKCkge1xyXG4gICAgcmV0dXJuIGlkYi5vcGVuKEFQUF9EQl9OQU1FLCBBUFBfREJfVkVSLCAodXBncmFkZURiKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcclxuICAgICAgICBjYXNlIDAgOlxyXG4gICAgICAgICAgY29uc3QgcmVzdGF1cmFudFN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKERCX1JFU1RBVVJBTlRTX1RBQkxFLCB7a2V5UGF0aDogJ2lkJ30pO1xyXG4gICAgICAgICAgcmVzdGF1cmFudFN0b3JlLmNyZWF0ZUluZGV4KCdzdGF0dXMnLCAnc3RhdHVzJyk7XHJcbiAgICAgICAgLy8gYnJlYWsgb21pdHRlZFxyXG4gICAgICAgIGRlZmF1bHQgOlxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50KGlkKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIHJldHVybiByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QpIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpIHtcclxuXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG5cclxuICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKCkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICByZXR1cm4gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKCkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgcmV0dXJuIGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAvaW1nLyR7cmVzdGF1cmFudC5pZH1fbWVkaXVtLmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VTcmNTZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBEQkhlbHBlcjsiLCIvKiBSZWdpc3RlciBzZXJ2aWNlIHdvcmtlciB3aXRoIGV2ZW50cyAqL1xyXG5mdW5jdGlvbiByZWdpc3RlclNlcnZpY2VXb3JrZXIoKSB7XHJcblxyXG4gIGlmICghJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXJ2aWNlV29ya2VyIG5vdCByZWdpc3RlcicpO1xyXG4gIH1cclxuXHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24gKHJlZykge1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChyZWcuYWN0aXZlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdUaGVyZSBpcyBhbiBhbiBhY3RpdmUgc2VydmljZSB3b3JrZXInKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVnLndhaXRpbmcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3dhaXRpbmcgOicsIHJlZy53YWl0aW5nKTtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIGlzIHdhaXRpbmcnKTtcclxuICAgICAgdXBkYXRlU2VydmljZVdvcmtlcihyZWcud2FpdGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZy5pbnN0YWxsaW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdpbnN0YWxsaW5nIDogJywgcmVnKTtcclxuICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHN0YXR1cyBpcyBpbnN0YWxsaW5nJyk7XHJcbiAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVnLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgdXBkYXRlIGZvdW5kJywgcmVnKTtcclxuICAgICAgdHJhY2tJbnN0YWxsaW5nKHJlZy5pbnN0YWxsaW5nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHZhciByZWZyZXNoaW5nO1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKHJlZnJlc2hpbmcpIHJldHVybjtcclxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIHJlZnJlc2hpbmcgPSB0cnVlO1xyXG4gICAgICB9LCAxMDAwKTtcclxuICAgIH0pO1xyXG5cclxuICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKCdSZWdpc3RyYXRpb24gZmFpbGVkIHdpdGggJyArIGVycm9yKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdHJhY2tJbnN0YWxsaW5nKGluc3RhbGxpbmdXb3JrZXIpIHtcclxuICBpZiAoIWluc3RhbGxpbmdXb3JrZXIpIHtcclxuICAgIGNvbnNvbGUubG9nKCdXb3JrZXIgbm90IGRlZmluZWQhJyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGluc3RhbGxpbmdXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignc3RhdGVjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBzdGF0ZSB3YXMgY2hhbmdlZCB0byAnICsgaW5zdGFsbGluZ1dvcmtlci5zdGF0ZSk7XHJcbiAgICBpZiAoaW5zdGFsbGluZ1dvcmtlci5zdGF0ZSA9PT0gJ2luc3RhbGxlZCcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2Ugd29ya2VyIGluc3RhbGxlZCBhbmQgd2FpdGluZyBmb3IgYWN0aXZhdGlvbicsIGluc3RhbGxpbmdXb3JrZXIpO1xyXG4gICAgICB1cGRhdGVTZXJ2aWNlV29ya2VyKGluc3RhbGxpbmdXb3JrZXIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVTZXJ2aWNlV29ya2VyKHdvcmtlcikge1xyXG4gIHNlbmRNZXNzYWdlVG9TZXJ2aWNlV29ya2VyKHthY3Rpb246ICdza2lwV2FpdGluZyd9LCB3b3JrZXIpXHJcbiAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2VGcm9tU3cpIHtcclxuICAgICAgY29uc29sZS5sb2cocmVzcG9uc2VGcm9tU3cpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbmRNZXNzYWdlVG9TZXJ2aWNlV29ya2VyKG1zZywgd29ya2VyKSB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIHZhciBtc2dDaGFuID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XHJcblxyXG4gICAgLy8gSGFuZGxlciBmb3IgcmVjaWV2aW5nIG1lc3NhZ2UgcmVwbHkgZnJvbSBzZXJ2aWNlIHdvcmtlclxyXG4gICAgbXNnQ2hhbi5wb3J0MS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgaWYgKGV2ZW50LmRhdGEuZXJyb3IpIHtcclxuICAgICAgICByZWplY3QoZXZlbnQuZGF0YS5lcnJvcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzb2x2ZShldmVudC5kYXRhKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vIFNlbmQgbWVzc2FnZSB0byBzZXJ2aWNlIHdvcmtlciBhbG9uZyB3aXRoIHBvcnQgZm9yIHJlcGx5XHJcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2UobXNnLCBbbXNnQ2hhbi5wb3J0Ml0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIsXHJcbn07IiwiY29uc3QgREJIZWxwZXIgPSByZXF1aXJlKCcuL2RiaGVscGVyJyk7XG5jb25zdCBwcm9jZXNzID0gcmVxdWlyZSgnLi9wcm9jZXNzJyk7XG5cbmxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBwcm9jZXNzLnJlZ2lzdGVyU2VydmljZVdvcmtlcigpO1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKCkudGhlbihyZXN0YXVyYW50ID0+IHtcbiAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgICB6b29tOiAxNixcbiAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICB9KTtcbiAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG5cbiAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKSB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgcmV0dXJuIHNlbGYucmVzdGF1cmFudDtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQpLnRoZW4oKHJlc3RhdXJhbnQpID0+IHtcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyByZXN0YXVyYW50Jyk7XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIHJldHVybiByZXN0YXVyYW50O1xuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBuYW1lLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnYWx0JywgYEFuIGltYWdlIGZyb20gdGhlIHJlc3RhdXJhbnQgJHtyZXN0YXVyYW50Lm5hbWV9YCk7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgdGltZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBvcGVyYXRpbmdIb3Vyc1trZXldICsgJywnKTsgLy8gZm9yIHNjcmVlbiByZWFkZXJcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5mdW5jdGlvbiBmaWxsUmV2aWV3c0hUTUwocmV2aWV3cyA9IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzKSB7XG5cbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG5cbiAgaWYgKCFyZXZpZXdzKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5mdW5jdGlvbiBjcmVhdGVSZXZpZXdIVE1MKHJldmlldykge1xuXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gIGxpLmNsYXNzTmFtZSA9ICdyZXZpZXdzLWxpc3QtaXRlbSc7XG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdyZXZpZXcnKTtcblxuICBjb25zdCByZXZpZXdlckluZm9CbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICByZXZpZXdlckluZm9CbG9jay5jbGFzc05hbWUgPSAncmV2aWV3ZXItaW5mbyc7XG5cbiAgY29uc3QgcmV2aWV3ZXJOYW1lRGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICByZXZpZXdlck5hbWVEYXRlLmNsYXNzTmFtZSA9ICdyZXZpZXdlci1pbmZvX19uYW1lLWRhdGUnO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICBuYW1lLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBuYW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJldmlldy5uYW1lKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGF0ZScpO1xuICBkYXRlLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xuXG4gIHJldmlld2VyTmFtZURhdGUuYXBwZW5kQ2hpbGQobmFtZSk7XG4gIHJldmlld2VyTmFtZURhdGUuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgcmV2aWV3ZXJJbmZvQmxvY2suYXBwZW5kQ2hpbGQocmV2aWV3ZXJOYW1lRGF0ZSk7XG5cbiAgcmV2aWV3ZXJJbmZvQmxvY2suYXBwZW5kQ2hpbGQoY3JlYXRlUmF0aW5nU3RhcnNCbG9jayhyZXZpZXcucmF0aW5nKSk7XG5cbiAgbGkuYXBwZW5kQ2hpbGQocmV2aWV3ZXJJbmZvQmxvY2spO1xuXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50cy5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgY29tbWVudHMuY2xhc3NOYW1lID0gJ3Jldmlld2VyLWNvbW1lbnQnO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJhdGluZ1N0YXJzQmxvY2socmF0aW5nVmFsdWUpIHtcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXG4gIHJhdGluZy5hcHBlbmRDaGlsZCgoKCkgPT4ge1xuICAgIGxldCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIHNwYW4uY2xhc3NOYW1lID0gJ3JhdGluZy1udW1iZXInO1xuICAgIHNwYW4uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG4gICAgc3Bhbi5pbm5lckhUTUwgPSAnUmF0aW5nIDogJyArIHJhdGluZ1ZhbHVlO1xuICAgIHJldHVybiBzcGFuO1xuICB9KSgpKTtcblxuICBsZXQgcmF0aW5nU3RhcnMgPSAn4piFJy5yZXBlYXQoK3JhdGluZ1ZhbHVlKTtcblxuICBpZiAoK3JhdGluZ1ZhbHVlIDwgNSkge1xuICAgIHJhdGluZ1N0YXJzID0gcmF0aW5nU3RhcnMgKyAn4piGJy5yZXBlYXQoNSAtICtyYXRpbmdWYWx1ZSk7XG4gIH1cbiAgY29uc3QgcmF0aW5nU3RhcnNFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICByYXRpbmdTdGFyc0VsZW1lbnQuY2xhc3NOYW1lID0gJ3JhdGluZy1zdGFycyc7XG4gIHJhdGluZ1N0YXJzRWxlbWVudC5pbm5lckhUTUwgPSByYXRpbmdTdGFycztcblxuICByYXRpbmcuYXBwZW5kQ2hpbGQocmF0aW5nU3RhcnNFbGVtZW50KTtcblxuICByZXR1cm4gcmF0aW5nO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmZ1bmN0aW9uIGdldFBhcmFtZXRlckJ5TmFtZSAobmFtZSwgdXJsKSB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKCFyZXN1bHRzWzJdKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cbiJdfQ==
